/*! For license information please see vendors~auth-msal-browser.js.LICENSE.txt */
"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([["vendors~auth-msal-browser"],{12338:(e,t,r)=>{r.d(t,{S:()=>u});var i=r(912397),o=r(593744),n=r(466538),a=r(556012),s=r(585020),c=r(279676);function l(){let e;try{e=window[s.Al.SessionStorage];const t=e?.getItem(s.Fi);if(1===Number(t))return Promise.resolve().then(r.bind(r,296413))}catch(e){}}function h(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now}function d(e){if(e&&h())return Math.round(window.performance.now()-e)}class u extends i.cm{constructor(e,t,r){super(e.auth.clientId,e.auth.authority||`${o.YM.DEFAULT_AUTHORITY}`,new n.V(e.system?.loggerOptions||{},a.U,a.r),a.U,a.r,e.telemetry?.application||{appName:"",appVersion:""},t,r)}generateId(){return(0,c.Oy)()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){l()?.then((t=>{const r=this.eventsByCorrelationId.get(e.event.correlationId),i=r&&r.eventId===e.event.eventId,o=[];i&&r?.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach((e=>{o.push({...e})})),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,o)}))}startMeasurement(e,t){const r=this.getPageVisibility(),i=super.startMeasurement(e,t),o=h()?window.performance.now():void 0,n=l()?.then((t=>new t.BrowserPerformanceMeasurement(e,i.event.correlationId)));return n?.then((e=>e.startMeasurement())),{...i,end:(e,t)=>{const a=i.end({...e,startPageVisibility:r,endPageVisibility:this.getPageVisibility(),durationMs:d(o)},t);return n?.then((e=>e.endMeasurement())),this.deleteIncompleteSubMeasurements(i),a},discard:()=>{i.discard(),n?.then((e=>e.flushMeasurement())),this.deleteIncompleteSubMeasurements(i)}}}setPreQueueTime(e,t){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);const r=this.preQueueTimeByCorrelationId.get(t);r&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${r.name} found`,t),this.addQueueMeasurement(r.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,r,i){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);const o=super.getPreQueueTime(e,t);if(!o)return;const n=window.performance.now(),a=r||super.calculateQueuedTime(o,n);return super.addQueueMeasurement(e,t,a,i)}}},13943:(e,t,r)=>{if(r.d(t,{Ji:()=>l,q8:()=>h,vq:()=>c}),"cloudFilePickerDialog"!=r.j)var i=r(360871);if("cloudFilePickerDialog"!=r.j)var o=r(941504);if("cloudFilePickerDialog"!=r.j)var n=r(34467);if("cloudFilePickerDialog"!=r.j)var a=r(284613);if("cloudFilePickerDialog"!=r.j)var s=r(732316);class c{static async createPublicClientApplication(e){const t=await(0,i.K)(e);return new c(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new o.i(new n.A(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}async function l(e){const t=new s.R(e);if(await t.initialize(),t.isAvailable()){const r=new a.l(t),i=new c(e,r);return await i.initialize(),i}return h(e)}async function h(e){const t=new c(e);return await t.initialize(),t}},31085:(e,t,r)=>{r.r(t),r.d(t,{AccountEntity:()=>mr.d,ApiId:()=>Be,AuthError:()=>c.lR,AuthErrorCodes:()=>ni,AuthErrorMessage:()=>c.ej,AuthenticationHeaderParser:()=>no.H,AuthenticationScheme:()=>ce.IO,AzureCloudInstance:()=>Mt._,BrowserAuthError:()=>ae,BrowserAuthErrorCodes:()=>i,BrowserAuthErrorMessage:()=>ne,BrowserCacheLocation:()=>ve,BrowserConfigurationAuthError:()=>dt,BrowserConfigurationAuthErrorCodes:()=>o,BrowserConfigurationAuthErrorMessage:()=>ht,BrowserPerformanceClient:()=>io,BrowserPerformanceMeasurement:()=>oo.BrowserPerformanceMeasurement,BrowserStorage:()=>Vi,BrowserUtils:()=>n,CacheLookupPolicy:()=>je,ClientAuthError:()=>gr.eB,ClientAuthErrorCodes:()=>pr,ClientAuthErrorMessage:()=>gr.NE,ClientConfigurationError:()=>Ot.q5,ClientConfigurationErrorCodes:()=>Bt,ClientConfigurationErrorMessage:()=>Ot.P7,DEFAULT_IFRAME_TIMEOUT_MS:()=>xt,EventHandler:()=>Lr,EventMessageUtils:()=>Yi,EventType:()=>Hr,InteractionRequiredAuthError:()=>ur.CB,InteractionRequiredAuthErrorCodes:()=>vr,InteractionRequiredAuthErrorMessage:()=>ur.$D,InteractionStatus:()=>Ue,InteractionType:()=>De,JsonWebTokenTypes:()=>ce.Lz,LocalStorage:()=>br,LogLevel:()=>Et.$,Logger:()=>Et.V,MemoryStorage:()=>ar,NavigationClient:()=>Dt,OIDC_DEFAULT_SCOPES:()=>ce.aZ,PerformanceEvents:()=>ze.MX,PromptValue:()=>ce._M,ProtocolMode:()=>Rt.e,PublicClientApplication:()=>Ki,PublicClientNext:()=>Qi,ServerError:()=>mi.g,ServerResponseType:()=>ce.zL,SessionStorage:()=>Sr,SignedHttpRequest:()=>Ji,StringUtils:()=>kr.$,StubPerformanceClient:()=>qt.a,UrlString:()=>a.H,WrapperSKU:()=>He,createNestablePublicClientApplication:()=>zi,createStandardPublicClientApplication:()=>Xi,stubbedPublicClientApplication:()=>Wi,version:()=>Kt});var i={};r.r(i),r.d(i,{authCodeOrNativeAccountIdRequired:()=>z,authCodeRequired:()=>K,authRequestNotSetError:()=>q,blockIframeReload:()=>A,blockNestedPopups:()=>b,cryptoKeyNotFound:()=>j,cryptoNonExistent:()=>h,databaseNotOpen:()=>D,databaseUnavailable:()=>$,emptyNavigateUri:()=>d,emptyWindowError:()=>w,failedToBuildHeaders:()=>te,failedToParseHeaders:()=>re,failedToParseResponse:()=>L,getRequestFailed:()=>H,hashDoesNotContainKnownProperties:()=>p,hashEmptyError:()=>u,iframeClosedPrematurely:()=>S,interactionInProgress:()=>v,invalidBase64String:()=>Z,invalidCacheType:()=>O,invalidPopTokenRequest:()=>ee,monitorPopupTimeout:()=>k,monitorWindowTimeout:()=>I,nativeConnectionNotEstablished:()=>V,nativeExtensionNotInstalled:()=>W,nativeHandshakeTimeout:()=>Q,nativePromptNotSupported:()=>J,noAccountError:()=>E,noCachedAuthorityError:()=>_,noNetworkConnectivity:()=>U,noStateInHash:()=>g,noTokenRequestCacheError:()=>M,nonBrowserEnvironment:()=>B,pkceNotCreated:()=>l,popupWindowError:()=>C,postRequestFailed:()=>F,redirectInIframe:()=>T,silentLogoutUnsupported:()=>P,silentPromptValueError:()=>R,spaCodeAndNativeAccountIdPresent:()=>X,stateInteractionTypeMismatch:()=>f,unableToAcquireTokenFromNativePlatform:()=>G,unableToLoadToken:()=>x,unableToParseState:()=>m,unableToParseTokenRequestCacheError:()=>N,uninitializedPublicClientApplication:()=>Y,userCancelled:()=>y});var o={};r.r(o),r.d(o,{inMemRedirectUnavailable:()=>ct,storageNotSupported:()=>at,stubbedPublicClientApplicationCalled:()=>st});var n={};r.r(n),r.d(n,{blockAPICallsBeforeInitialize:()=>Tt,blockAcquireTokenInPopups:()=>kt,blockNonBrowserEnvironment:()=>It,blockRedirectInIframe:()=>yt,blockReloadInHiddenIframes:()=>wt,clearHash:()=>gt,createGuid:()=>Pt,getCurrentUri:()=>vt,getHomepage:()=>Ct,invoke:()=>s.l,invokeAsync:()=>s.T,isInIframe:()=>mt,isInPopup:()=>ft,preconnect:()=>St,preflightCheck:()=>At,redirectPreflightCheck:()=>bt,replaceHash:()=>pt});var a=r(705900),s=r(377272),c=r(769029);const l="pkce_not_created",h="crypto_nonexistent",d="empty_navigate_uri",u="hash_empty_error",g="no_state_in_hash",p="hash_does_not_contain_known_properties",m="unable_to_parse_state",f="state_interaction_type_mismatch",v="interaction_in_progress",C="popup_window_error",w="empty_window_error",y="user_cancelled",k="monitor_popup_timeout",I="monitor_window_timeout",T="redirect_in_iframe",A="block_iframe_reload",b="block_nested_popups",S="iframe_closed_prematurely",P="silent_logout_unsupported",E="no_account_error",R="silent_prompt_value_error",M="no_token_request_cache_error",N="unable_to_parse_token_request_cache_error",_="no_cached_authority_error",q="auth_request_not_set_error",O="invalid_cache_type",B="non_browser_environment",D="database_not_open",U="no_network_connectivity",F="post_request_failed",H="get_request_failed",L="failed_to_parse_response",x="unable_to_load_token",j="crypto_key_not_found",K="auth_code_required",z="auth_code_or_nativeAccountId_required",X="spa_code_and_nativeAccountId_present",$="database_unavailable",G="unable_to_acquire_token_from_native_platform",Q="native_handshake_timeout",W="native_extension_not_installed",V="native_connection_not_established",Y="uninitialized_public_client_application",J="native_prompt_not_supported",Z="invalid_base64_string",ee="invalid_pop_token_request",te="failed_to_build_headers",re="failed_to_parse_headers",ie="For more visit: aka.ms/msaljs/browser-errors",oe={[l]:"The PKCE code challenge and verifier could not be generated.",[h]:"The crypto object or function is not available.",[d]:"Navigation URI is empty. Please check stack trace for more info.",[u]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${ie}`,[g]:"Hash does not contain state. Please verify that the request originated from msal.",[p]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${ie}`,[m]:"Unable to parse state. Please verify that the request originated from msal.",[f]:"Hash contains state but the interaction type does not match the caller.",[v]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${ie}`,[C]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[w]:"window.open returned null or undefined window object.",[y]:"User cancelled the flow.",[k]:`Token acquisition in popup failed due to timeout.  ${ie}`,[I]:`Token acquisition in iframe failed due to timeout.  ${ie}`,[T]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[A]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${ie}`,[b]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[S]:"The iframe being monitored was closed prematurely.",[P]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[E]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[R]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[M]:"No token request found in cache.",[N]:"The cached token request could not be parsed.",[_]:"No cached authority found.",[q]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[O]:"Invalid cache type",[B]:"Login and token requests are not supported in non-browser environments.",[D]:"Database is not open!",[U]:"No network connectivity. Check your internet connection.",[F]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[H]:"Network request failed. Please check the network trace to determine root cause.",[L]:"Failed to parse network response. Check network trace.",[x]:"Error loading token to cache.",[j]:"Cryptographic Key or Keypair not found in browser storage.",[K]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[z]:"An authorization code or nativeAccountId must be provided to this flow.",[X]:"Request cannot contain both spa code and native account id.",[$]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[G]:`Unable to acquire token from native platform.  ${ie}`,[Q]:"Timed out while attempting to establish connection to browser extension",[W]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[V]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${ie}`,[Y]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${ie}`,[J]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Z]:"Invalid base64 encoded string.",[ee]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[te]:"Failed to build request headers object.",[re]:"Failed to parse response headers"},ne={pkceNotGenerated:{code:l,desc:oe[l]},cryptoDoesNotExist:{code:h,desc:oe[h]},emptyNavigateUriError:{code:d,desc:oe[d]},hashEmptyError:{code:u,desc:oe[u]},hashDoesNotContainStateError:{code:g,desc:oe[g]},hashDoesNotContainKnownPropertiesError:{code:p,desc:oe[p]},unableToParseStateError:{code:m,desc:oe[m]},stateInteractionTypeMismatchError:{code:f,desc:oe[f]},interactionInProgress:{code:v,desc:oe[v]},popupWindowError:{code:C,desc:oe[C]},emptyWindowError:{code:w,desc:oe[w]},userCancelledError:{code:y,desc:oe[y]},monitorPopupTimeoutError:{code:k,desc:oe[k]},monitorIframeTimeoutError:{code:I,desc:oe[I]},redirectInIframeError:{code:T,desc:oe[T]},blockTokenRequestsInHiddenIframeError:{code:A,desc:oe[A]},blockAcquireTokenInPopupsError:{code:b,desc:oe[b]},iframeClosedPrematurelyError:{code:S,desc:oe[S]},silentLogoutUnsupportedError:{code:P,desc:oe[P]},noAccountError:{code:E,desc:oe[E]},silentPromptValueError:{code:R,desc:oe[R]},noTokenRequestCacheError:{code:M,desc:oe[M]},unableToParseTokenRequestCacheError:{code:N,desc:oe[N]},noCachedAuthorityError:{code:_,desc:oe[_]},authRequestNotSet:{code:q,desc:oe[q]},invalidCacheType:{code:O,desc:oe[O]},notInBrowserEnvironment:{code:B,desc:oe[B]},databaseNotOpen:{code:D,desc:oe[D]},noNetworkConnectivity:{code:U,desc:oe[U]},postRequestFailed:{code:F,desc:oe[F]},getRequestFailed:{code:H,desc:oe[H]},failedToParseNetworkResponse:{code:L,desc:oe[L]},unableToLoadTokenError:{code:x,desc:oe[x]},signingKeyNotFoundInStorage:{code:j,desc:oe[j]},authCodeRequired:{code:K,desc:oe[K]},authCodeOrNativeAccountRequired:{code:z,desc:oe[z]},spaCodeAndNativeAccountPresent:{code:X,desc:oe[X]},databaseUnavailable:{code:$,desc:oe[$]},unableToAcquireTokenFromNativePlatform:{code:G,desc:oe[G]},nativeHandshakeTimeout:{code:Q,desc:oe[Q]},nativeExtensionNotInstalled:{code:W,desc:oe[W]},nativeConnectionNotEstablished:{code:V,desc:oe[V]},uninitializedPublicClientApplication:{code:Y,desc:oe[Y]},nativePromptNotSupported:{code:J,desc:oe[J]},invalidBase64StringError:{code:Z,desc:oe[Z]},invalidPopTokenRequest:{code:ee,desc:oe[ee]}};class ae extends c.lR{constructor(e,t){super(e,oe[e],t),Object.setPrototypeOf(this,ae.prototype),this.name="BrowserAuthError"}}function se(e,t){return new ae(e,t)}var ce=r(123187);const le={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},he="53ee284d-920a-4b59-9d30-a60315b26836",de="ppnbnpeolgkicgegkbkbjmhlideopiji",ue="MATS",ge="Handshake",pe="HandshakeResponse",me="GetToken",fe="Response",ve={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Ce="GET",we="POST",ye="authority",ke="request.state",Ie="nonce.id_token",Te="request.origin",Ae="urlHash",be="request.params",Se="interaction.status",Pe="ccs.credential",Ee="request.correlationId",Re="request.native",Me="msal.account.keys",Ne="msal.token.keys",_e="msal.version",qe="wrapper.sku",Oe="wrapper.version",Be={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var De;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(De||(De={}));const Ue={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Fe={scopes:ce.aZ},He={React:"@azure/msal-react",Angular:"@azure/msal-angular"},Le="msal.db",xe=`${Le}.keys`,je={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Ke=[je.Default,je.Skip,je.RefreshTokenAndNetwork];var ze=r(821857);function Xe(e){return encodeURIComponent(Ge(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function $e(e){return Qe(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ge(e){return Qe((new TextEncoder).encode(e))}function Qe(e){const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return btoa(t)}const We="SHA-256",Ve=new Uint8Array([1,0,1]),Ye="0123456789abcdef",Je=new Uint32Array(1),Ze={name:"RSASSA-PKCS1-v1_5",hash:We,modulusLength:2048,publicExponent:Ve};async function et(e,t,r){t?.addQueueMeasurement(ze.MX.Sha256Digest,r);const i=(new TextEncoder).encode(e);return window.crypto.subtle.digest(We,i)}function tt(e){return window.crypto.getRandomValues(e)}function rt(){return window.crypto.getRandomValues(Je),Je[0]}function it(){const e=Date.now(),t=1024*rt()+(1023&rt()),r=new Uint8Array(16),i=Math.trunc(t/2**30),o=t&2**30-1,n=rt();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|i>>>8,r[7]=i,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=n>>>24,r[13]=n>>>16,r[14]=n>>>8,r[15]=n;let a="";for(let e=0;e<r.length;e++)a+=Ye.charAt(r[e]>>>4),a+=Ye.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(a+="-");return a}async function ot(e){return window.crypto.subtle.exportKey("jwk",e)}async function nt(e){const t=await et(e);return $e(new Uint8Array(t))}const at="storage_not_supported",st="stubbed_public_client_application_called",ct="in_mem_redirect_unavailable",lt={[at]:"Given storage configuration option was not supported.",[st]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ct]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},ht={storageNotSupportedError:{code:at,desc:lt[at]},stubPcaInstanceCalled:{code:st,desc:lt[st]},inMemRedirectUnavailable:{code:ct,desc:lt[ct]}};class dt extends c.lR{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,dt.prototype)}}function ut(e){return new dt(e,lt[e])}function gt(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function pt(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function mt(){return window.parent!==window}function ft(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${le.POPUP_NAME_PREFIX}.`)}function vt(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Ct(){const e=new a.H(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function wt(){if(a.H.hashContainsKnownProperties(window.location.hash)&&mt())throw se(A)}function yt(e){if(mt()&&!e)throw se(T)}function kt(){if(ft())throw se(b)}function It(){if("undefined"==typeof window)throw se(B)}function Tt(e){if(!e)throw se(Y)}function At(e){It(),wt(),kt(),Tt(e)}function bt(e,t){if(At(e),yt(t.system.allowRedirectInIframe),t.cache.cacheLocation===ve.MemoryStorage&&!t.cache.storeAuthStateInCookie)throw ut(ct)}function St(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout((()=>{try{document.head.removeChild(t)}catch{}}),1e4)}function Pt(){return it()}var Et=r(922205),Rt=r(357561),Mt=r(500223),Nt=r(485908),_t=r(623426),qt=r(691710),Ot=r(355726),Bt=r(148256);class Dt{navigateInternal(e,t){return Dt.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Dt.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e=>{setTimeout((()=>{e(!0)}),t.timeout)}))}}var Ut=r(698927);class Ft{async sendGetRequestAsync(e,t){let r,i={},o=0;const n=Ht(t);try{r=await fetch(e,{method:Ce,headers:n})}catch(e){throw se(window.navigator.onLine?H:U)}i=Lt(r.headers);try{return o=r.status,{headers:i,body:await r.json(),status:o}}catch(e){throw(0,Ut.t)(se(L),o,i)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",i=Ht(t);let o,n=0,a={};try{o=await fetch(e,{method:we,headers:i,body:r})}catch(e){throw se(window.navigator.onLine?F:U)}a=Lt(o.headers);try{return n=o.status,{headers:a,body:await o.json(),status:n}}catch(e){throw(0,Ut.t)(se(L),n,a)}}}function Ht(e){try{const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.entries(r).forEach((([e,r])=>{t.append(e,r)})),t}catch(e){throw se(te)}}function Lt(e){try{const t={};return e.forEach(((e,r)=>{t[r]=e})),t}catch(e){throw se(re)}}const xt=1e4;const jt="@azure/msal-browser",Kt="3.30.0";var zt=r(758651);class Xt{static loggerCallback(e,t){switch(e){case Et.$.Error:return void zt.error(t);case Et.$.Info:return void zt.info(t);case Et.$.Verbose:return void zt.debug(t);case Et.$.Warning:return void zt.warn(t);default:return void zt.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=function({auth:e,cache:t,system:r,telemetry:i},o){const n={clientId:ce.YM.EMPTY_STRING,authority:`${ce.YM.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:ce.YM.EMPTY_STRING,authorityMetadata:ce.YM.EMPTY_STRING,redirectUri:"undefined"!=typeof window?vt():"",postLogoutRedirectUri:ce.YM.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Rt.e.AAD,OIDCOptions:{serverResponseType:ce.zL.FRAGMENT,defaultScopes:[ce.YM.OPENID_SCOPE,ce.YM.PROFILE_SCOPE,ce.YM.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Mt._.None,tenant:ce.YM.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},a={cacheLocation:ve.SessionStorage,temporaryCacheLocation:ve.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!t||t.cacheLocation!==ve.LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:Et.$.Info,piiLoggingEnabled:!1},c={...{...Nt.J1,loggerOptions:s,networkClient:o?new Ft:_t.A,navigationClient:new Dt,loadFrameTimeout:0,windowHashTimeout:r?.loadFrameTimeout||6e4,iframeHashTimeout:r?.loadFrameTimeout||xt,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:le.DEFAULT_POLL_INTERVAL_MS},...r,loggerOptions:r?.loggerOptions||s},l={application:{appName:ce.YM.EMPTY_STRING,appVersion:ce.YM.EMPTY_STRING},client:new qt.a};e?.protocolMode!==Rt.e.OIDC&&e?.OIDCOptions&&new Et.V(c.loggerOptions).warning(JSON.stringify((0,Ot.aD)(Bt.cannotSetOIDCOptions)));if(e?.protocolMode&&e.protocolMode!==Rt.e.AAD&&c?.allowNativeBroker)throw(0,Ot.aD)(Bt.cannotAllowNativeBroker);return{auth:{...n,...e,OIDCOptions:{...n.OIDCOptions,...e?.OIDCOptions}},cache:{...a,...t},system:c,telemetry:{...l,...i}}}(e,this.browserEnvironment);try{t=window[ve.SessionStorage]}catch(e){}const r=t?.getItem("msal.browser.log.level"),i=t?.getItem("msal.browser.log.pii")?.toLowerCase(),o="true"===i||"false"!==i&&void 0,n={...this.config.system.loggerOptions},a=r&&Object.keys(Et.$).includes(r)?Et.$[r]:void 0;a&&(n.loggerCallback=Xt.loggerCallback,n.logLevel=a),void 0!==o&&(n.piiLoggingEnabled=o),this.logger=new Et.V(n,jt,Kt),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}const $t="USER_INTERACTION_REQUIRED",Gt="USER_CANCEL",Qt="NO_NETWORK",Wt="TRANSIENT_ERROR",Vt="PERSISTENT_ERROR",Yt="DISABLED",Jt="ACCOUNT_UNAVAILABLE",Zt="NESTED_APP_AUTH_UNAVAILABLE";class er{static async initializeNestedAppAuthBridge(){if(void 0===window)throw new Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",(e=>{const t="string"==typeof e?e:e.data,r=JSON.parse(t),i=er.bridgeRequests.find((e=>e.requestId===r.requestId));void 0!==i&&(er.bridgeRequests.splice(er.bridgeRequests.indexOf(i),1),r.success?i.resolve(r):i.reject(r.error))}));const e=await new Promise(((e,t)=>{const r=er.buildRequest("GetInitContext"),i={requestId:r.requestId,method:r.method,resolve:e,reject:t};er.bridgeRequests.push(i),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}));return er.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){const r=await this.sendRequest(e,{tokenParams:t});return{token:er.validateBridgeResultOrThrow(r.token),account:er.validateBridgeResultOrThrow(r.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:it(),sendTime:Date.now(),clientLibrary:le.MSAL_SKU,clientLibraryVersion:Kt,...t}}sendRequest(e,t){const r=er.buildRequest(e,t);return new Promise(((e,t)=>{const i={requestId:r.requestId,method:r.method,resolve:e,reject:t};er.bridgeRequests.push(i),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}))}static validateBridgeResultOrThrow(e){if(void 0===e){throw{status:Zt}}return e}constructor(e,t,r,i){this.sdkName=e,this.sdkVersion=t,this.accountContext=r,this.capabilities=i}static async create(){const e=await er.initializeNestedAppAuthBridge();return new er(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}er.bridgeRequests=[];class tr extends Xt{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return tr.MODULE_NAME}getId(){return tr.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();const e=await er.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(e){this.logger.infoPii(`Could not initialize Nested App Auth bridge (${e})`)}return this.logger.info(`Nested App Auth Bridge available: ${this.available}`),this.available}}tr.MODULE_NAME="",tr.ID="NestedAppOperatingContext";class rr extends Xt{getModuleName(){return rr.MODULE_NAME}getId(){return rr.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}rr.MODULE_NAME="",rr.ID="StandardOperatingContext";var ir=r(136524);function or(e){return(new TextDecoder).decode(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw se(Z)}const r=atob(t);return Uint8Array.from(r,(e=>e.codePointAt(0)||0))}(e))}class nr{constructor(){this.dbName=Le,this.version=1,this.tableName=xe,this.dbOpen=!1}async open(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(this.tableName)})),r.addEventListener("success",(t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()})),r.addEventListener("error",(()=>t(se($))))}))}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(se(D));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);i.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(r.target.result)})),i.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async setItem(e,t){return await this.validateDbIsOpen(),new Promise(((r,i)=>{if(!this.db)return i(se(D));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);o.addEventListener("success",(()=>{this.closeConnection(),r()})),o.addEventListener("error",(e=>{this.closeConnection(),i(e)}))}))}async removeItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(se(D));const i=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);i.addEventListener("success",(()=>{this.closeConnection(),t()})),i.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async getKeys(){return await this.validateDbIsOpen(),new Promise(((e,t)=>{if(!this.db)return t(se(D));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",(t=>{const r=t;this.closeConnection(),e(r.target.result)})),r.addEventListener("error",(e=>{this.closeConnection(),t(e)}))}))}async containsKey(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(se(D));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);i.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(1===r.target.result)})),i.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise(((e,t)=>{const r=window.indexedDB.deleteDatabase(Le),i=setTimeout((()=>t(!1)),200);r.addEventListener("success",(()=>(clearTimeout(i),e(!0)))),r.addEventListener("blocked",(()=>(clearTimeout(i),e(!0)))),r.addEventListener("error",(()=>(clearTimeout(i),t(!1))))}))}}class ar{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach(((t,r)=>{e.push(r)})),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}class sr{constructor(e){this.inMemoryCache=new ar,this.indexedDBCache=new nr,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof ae&&e.errorCode===$))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class cr{constructor(e,t,r){this.logger=e,function(e){if(!window)throw se(B);if(!window.crypto)throw se(h);if(!e&&!window.crypto.subtle)throw se(h,"crypto_subtle_undefined")}(r??!1),this.cache=new sr(this.logger),this.performanceClient=t}createNewGuid(){return it()}base64Encode(e){return Ge(e)}base64Decode(e){return or(e)}base64UrlEncode(e){return Xe(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(ze.MX.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await async function(e,t){return window.crypto.subtle.generateKey(Ze,e,t)}(cr.EXTRACTABLE,cr.POP_KEY_USAGES),i=await ot(r.publicKey),o=lr({e:i.e,kty:i.kty,n:i.n}),n=await this.hashString(o),a=await ot(r.privateKey),s=await async function(e,t,r){return window.crypto.subtle.importKey("jwk",e,Ze,t,r)}(a,!1,["sign"]);return await this.cache.setItem(n,{privateKey:s,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),n}async removeTokenBindingKey(e){await this.cache.removeItem(e);return!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){const o=this.performanceClient?.startMeasurement(ze.MX.CryptoOptsSignJwt,i),n=await this.cache.getItem(t);if(!n)throw se(j);const a=await ot(n.publicKey),s=lr(a),c=Xe(JSON.stringify({kid:t})),l=Xe(ir.p.getShrHeaderString({...r?.header,alg:a.alg,kid:c}));e.cnf={jwk:JSON.parse(s)};const h=`${l}.${Xe(JSON.stringify(e))}`,d=(new TextEncoder).encode(h),u=await async function(e,t){return window.crypto.subtle.sign(Ze,e,t)}(n.privateKey,d),g=`${h}.${$e(new Uint8Array(u))}`;return o&&o.end({success:!0}),g}async hashString(e){return nt(e)}}function lr(e){return JSON.stringify(e,Object.keys(e).sort())}cr.POP_KEY_USAGES=["sign","verify"],cr.EXTRACTABLE=!0;var hr=r(469738),dr=r(23859),ur=r(889410),gr=r(943218),pr=r(461732),mr=r(818951),fr=r(743024),vr=r(468532),Cr=r(873752),wr=r(380059),yr=r(310819),kr=r(155470),Ir=r(124287),Tr=r(786116),Ar=r(431199);class br{constructor(){if(!window.localStorage)throw ut(at)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class Sr{constructor(){if(!window.sessionStorage)throw ut(at)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function Pr(e,t){if(!t)return null;try{return Ir.W.parseRequestState(e,t).libraryState.meta}catch(e){throw(0,gr.SB)(pr.invalidState)}}const Er=864e5;class Rr{getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){const i=r[e],[o,...n]=decodeURIComponent(i).trim().split("="),a=n.join("=");if(o===t)return a}return""}setItem(e,t,r,i=!0){let o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){const e=function(e){const t=new Date,r=new Date(t.getTime()+e*Er);return r.toUTCString()}(r);o+=`expires=${e};`}i&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach((e=>{const r=decodeURIComponent(e).trim().split("=");t.push(r[0])})),t}containsKey(e){return this.getKeys().includes(e)}}class Mr extends fr.G{constructor(e,t,r,i,o,n){super(e,r,i,o),this.cacheConfig=t,this.logger=i,this.internalStorage=new ar,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new Rr,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=n}setupBrowserStorage(e){try{switch(e){case ve.LocalStorage:return new br;case ve.SessionStorage:return new Sr;case ve.MemoryStorage:}}catch(e){this.logger.error(e)}return this.cacheConfig.cacheLocation=ve.MemoryStorage,new ar}migrateCacheEntries(){const e=this.browserStorage.getItem(_e);e&&this.logger.info(`MSAL.js was last initialized with version ${e}`),e!==Kt&&this.browserStorage.setItem(_e,Kt);const t=`${ce.YM.CACHE_PREFIX}.${ce.Gd.ID_TOKEN}`,r=`${ce.YM.CACHE_PREFIX}.${ce.Gd.CLIENT_INFO}`,i=`${ce.YM.CACHE_PREFIX}.${ce.Gd.ERROR}`,o=`${ce.YM.CACHE_PREFIX}.${ce.Gd.ERROR_DESC}`,n=[this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(i),this.browserStorage.getItem(o)];[ce.Gd.ID_TOKEN,ce.Gd.CLIENT_INFO,ce.Gd.ERROR,ce.Gd.ERROR_DESC].forEach(((e,t)=>{const r=n[t];r&&this.setTemporaryCache(e,r,!0)}))}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.cryptoImpl.createNewGuid(),t=this.getItem(Me),r=this.getItem(`${Ne}.${this.clientId}`);if(t&&r)return void this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");this.browserStorage.getKeys().forEach((t=>{if(this.isCredentialKey(t)){const r=this.getItem(t);if(r){const i=this.validateAndParseJson(r);if(i&&i.hasOwnProperty("credentialType"))switch(i.credentialType){case ce.aG.ID_TOKEN:if(Cr.Kx(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${t} found, saving key to token key map`);const r=i,o=this.updateCredentialCacheKey(t,r,e);return void this.addTokenKey(o,ce.aG.ID_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${t}`);break;case ce.aG.ACCESS_TOKEN:case ce.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Cr.dj(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${t} found, saving key to token key map`);const r=i,o=this.updateCredentialCacheKey(t,r,e);return void this.addTokenKey(o,ce.aG.ACCESS_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${t}`);break;case ce.aG.REFRESH_TOKEN:if(Cr.WB(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${t} found, saving key to token key map`);const r=i,o=this.updateCredentialCacheKey(t,r,e);return void this.addTokenKey(o,ce.aG.REFRESH_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${t}`)}}}if(this.isAccountKey(t)){const r=this.getItem(t);if(r){const i=this.validateAndParseJson(r);i&&mr.d.isAccountEntity(i)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${t} found, saving key to account key map`),this.addAccountKeyToMap(t,e))}}}))}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t,r){let i=[];for(let o=0;o<=20;o++)try{this.browserStorage.setItem(e,t),o>0&&this.removeAccessTokenKeys(i.slice(0,o),r);break}catch(n){const a=(0,wr.du)(n);if(!(a.errorCode===yr.O&&o<20))throw a;if(i.length||(i=e===`${Ne}.${this.clientId}`?JSON.parse(t).accessToken:this.getTokenKeys().accessToken),i.length<=o)throw a;this.removeAccessToken(i[o],r,!1)}}getAccount(e,t,r){this.logger.trace("BrowserCacheManager.getAccount called");const i=this.getCachedAccountEntity(e,t);return this.updateOutdatedCachedAccount(e,i,t,r)}getCachedAccountEntity(e,t){const r=this.getItem(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const i=this.validateAndParseJson(r);return i&&mr.d.isAccountEntity(i)?fr.G.toObject(new mr.d,i):null}setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const r=e.generateAccountKey();e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addAccountKeyToMap(r,t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(Me);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const r=this.getAccountKeys();-1===r.indexOf(e)?(r.push(e),this.setItem(Me,JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const r=this.getAccountKeys(),i=r.indexOf(e);if(i>-1){if(r.splice(i,1),0===r.length)return void this.removeItem(Me);this.setItem(Me,JSON.stringify(r),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e,t){super.removeAccount(e,t),this.removeAccountKeyFromMap(e,t)}removeOutdatedAccount(e,t){this.removeItem(e),this.removeAccountKeyFromMap(e,t)}removeIdToken(e,t){super.removeIdToken(e,t),this.removeTokenKey(e,ce.aG.ID_TOKEN,t)}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),this.performanceClient?.incrementFields({accessTokensRemoved:1},t),r&&this.removeTokenKey(e,ce.aG.ACCESS_TOKEN,t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");const r=this.getTokenKeys();let i=0;if(e.forEach((e=>{const t=r.accessToken.indexOf(e);t>-1&&(r.accessToken.splice(t,1),i++)})),i>0)return this.logger.info(`removed ${i} accessToken keys from tokenKeys map`),void this.setTokenKeys(r,t)}removeRefreshToken(e,t){super.removeRefreshToken(e,t),this.removeTokenKey(e,ce.aG.REFRESH_TOKEN,t)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${Ne}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}setTokenKeys(e,t){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(`${Ne}.${this.clientId}`,JSON.stringify(e),t):this.removeItem(`${Ne}.${this.clientId}`)}addTokenKey(e,t,r){this.logger.trace("BrowserCacheManager addTokenKey called");const i=this.getTokenKeys();switch(t){case ce.aG.ID_TOKEN:-1===i.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(e));break;case ce.aG.ACCESS_TOKEN:const r=i.accessToken.indexOf(e);-1!==r&&i.accessToken.splice(r,1),this.logger.trace(`access token ${-1===r?"added to":"updated in"} map`),i.accessToken.push(e);break;case ce.aG.REFRESH_TOKEN:-1===i.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,gr.SB)(pr.unexpectedCredentialType)}this.setTokenKeys(i,r)}removeTokenKey(e,t,r,i=this.getTokenKeys()){switch(this.logger.trace("BrowserCacheManager removeTokenKey called"),t){case ce.aG.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const r=i.idToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),i.idToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case ce.aG.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const o=i.accessToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),i.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case ce.aG.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const n=i.refreshToken.indexOf(e);n>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),i.refreshToken.splice(n,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,gr.SB)(pr.unexpectedCredentialType)}this.setTokenKeys(i,r)}getIdTokenCredential(e,t){const r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const i=this.validateAndParseJson(r);return i&&Cr.Kx(i)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=Cr.og(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,ce.aG.ID_TOKEN,t)}getAccessTokenCredential(e,t){const r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,ce.aG.ACCESS_TOKEN,t),null;const i=this.validateAndParseJson(r);return i&&Cr.dj(i)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=Cr.og(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,ce.aG.ACCESS_TOKEN,t)}getRefreshTokenCredential(e,t){const r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,ce.aG.REFRESH_TOKEN,t),null;const i=this.validateAndParseJson(r);return i&&Cr.WB(i)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=Cr.og(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,ce.aG.REFRESH_TOKEN,t)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&Cr.ki(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const r=Cr.JP(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&Cr.ur(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&Cr.ey(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter((e=>this.isAuthorityMetadata(e)))}setWrapperMetadata(e,t){this.internalStorage.setItem(qe,e),this.internalStorage.setItem(Oe,t)}getWrapperMetadata(){return[this.internalStorage.getItem(qe)||ce.YM.EMPTY_STRING,this.internalStorage.getItem(Oe)||ce.YM.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(ce.Gd.ACTIVE_ACCOUNT_FILTERS),r=this.getItem(t);if(!r){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const t=this.generateCacheKey(ce.Gd.ACTIVE_ACCOUNT),r=this.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const i=this.getAccountInfoFilteredBy({localAccountId:r},e);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i,e),i):null}const i=this.validateAndParseJson(r);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,tenantId:i.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const r=this.generateCacheKey(ce.Gd.ACTIVE_ACCOUNT_FILTERS),i=this.generateCacheKey(ce.Gd.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Date.now().toString()};this.setItem(r,JSON.stringify(o),t),this.setItem(i,e.localAccountId,t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r),this.browserStorage.removeItem(i)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&Cr.r1(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.cookieStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===ve.LocalStorage){const e=this.browserStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}async clear(e){await this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach((e=>{-1===e.indexOf(ce.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)})),this.browserStorage.getKeys().forEach((e=>{-1===e.indexOf(ce.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)})),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(ze.MX.ClearTokensAndKeysWithClaims,t);const r=this.getTokenKeys();let i=0;r.accessToken.forEach((e=>{const r=this.getAccessTokenCredential(e,t);r?.requestedClaimsHash&&e.includes(r.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(e,t),i++)})),i>0&&this.logger.warning(`${i} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):kr.$.startsWith(e,ce.YM.CACHE_PREFIX)||kr.$.startsWith(e,ce.Gd.ADAL_ID_TOKEN)?e:`${ce.YM.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=Ir.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${ye}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=Ir.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Ie}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=Ir.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${ke}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;const i=this.generateAuthorityKey(r);return this.getTemporaryCache(i)}updateCacheEntries(e,t,r,i,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const n=this.generateStateKey(e);this.setTemporaryCache(n,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,r,!1),o){const e={credential:o.homeAccountId,type:Tr.X.HOME_ACCOUNT_ID};this.setTemporaryCache(Pe,JSON.stringify(e),!0)}else if(i){const e={credential:i,type:Tr.X.UPN};this.setTemporaryCache(Pe,JSON.stringify(e),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach((t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)})),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(be)),this.removeTemporaryItem(this.generateCacheKey(Te)),this.removeTemporaryItem(this.generateCacheKey(Ae)),this.removeTemporaryItem(this.generateCacheKey(Ee)),this.removeTemporaryItem(this.generateCacheKey(Pe)),this.removeTemporaryItem(this.generateCacheKey(Re)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||ce.YM.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach((t=>{if(-1===t.indexOf(ke))return;const r=this.temporaryCacheStorage.getItem(t);if(!r)return;const i=Pr(this.cryptoImpl,r);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))})),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=Ge(JSON.stringify(e));this.setTemporaryCache(be,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(be,!0);if(!t)throw se(M);let r;try{r=JSON.parse(or(t))}catch(e){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${e}`),se(N)}if(this.removeTemporaryItem(this.generateCacheKey(be)),!r.authority){const t=this.generateAuthorityKey(e),i=this.getTemporaryCache(t);if(!i)throw se(_);r.authority=i}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Re,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${ce.YM.CACHE_PREFIX}.${Se}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${ce.YM.CACHE_PREFIX}.${Se}`;if(e){if(this.getInteractionInProgress())throw se(v);this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(ce.Gd.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(ce.Gd.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(ce.Gd.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(ce.Gd.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const r=t||e;if(r){const e=Ar.My(r,or);if(e.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),e.preferred_username;if(e.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),e.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t,r){const i=Cr.og(t);if(e!==i){const o=this.getItem(e);if(o)return this.browserStorage.removeItem(e),this.setItem(i,o,r),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),i;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){const r=Cr.c_(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const o={idToken:r,accessToken:Cr.Np(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,or,void 0,e.tokenType,void 0,t.sshKid,t.claims,i)};return this.saveCacheRecord(o,e.correlationId)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(e){if(e instanceof wr.xA&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}const Nr=(e,t)=>{const r={cacheLocation:ve.MemoryStorage,temporaryCacheLocation:ve.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Mr(e,r,hr.j,t)};function _r(e,t,r,i,o){return e.verbose("getAllAccounts called"),r?t.getAllAccounts(i,o):[]}function qr(e,t,r,i){if(t.trace("getAccount called"),0===Object.keys(e).length)return t.warning("getAccount: No accountFilter provided"),null;const o=r.getAccountInfoFilteredBy(e,i);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}function Or(e,t,r,i){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;const o=r.getAccountInfoFilteredBy({username:e},i);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}function Br(e,t,r,i){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=r.getAccountInfoFilteredBy({homeAccountId:e},i);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function Dr(e,t,r,i){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;const o=r.getAccountInfoFilteredBy({localAccountId:e},i);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Ur(e,t,r){t.setActiveAccount(e,r)}function Fr(e,t){return e.getActiveAccount(t)}const Hr={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};class Lr{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Et.V({})}addEventCallback(e,t,r){if("undefined"!=typeof window){const i=r||Pt();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){if("undefined"!=typeof window){const o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};this.eventCallbacks.forEach((([t,r],i)=>{(0===r.length||r.includes(e))&&(this.logger.verbose(`Emitting event to callback ${i}: ${e}`),t.apply(null,[o]))}))}}}var xr=r(156213),jr=r(282203),Kr=r(575357),zr=r(17615);class Xr{constructor(e,t,r,i,o,n,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=n,this.nativeMessageHandler=s,this.correlationId=c||it(),this.logger=i.clone(le.MSAL_SKU,Kt,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){mr.d.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(this.correlationId),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null,this.correlationId));try{await this.browserStorage.removeAccount(mr.d.generateAccountCacheKey(e),this.correlationId),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(this.correlationId),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return a.H.getAbsoluteUrl(t,vt())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Kr.e(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(ze.MX.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,n=r?.length?"true"===r:this.config.auth.instanceAware,c=t&&n?this.config.auth.authority.replace(a.H.getDomainFromUrl(o),t.environment):o,l=dr.s4.generateAuthority(c,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),h=await(0,s.T)(zr.Y,ze.MX.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!h.isAlias(t.environment))throw(0,Ot.aD)(Bt.authorityMismatch);return h}}async function $r(e,t,r){e.addQueueMeasurement(ze.MX.GeneratePkceCodes,r);const i=(0,s.l)(Gr,ze.MX.GenerateCodeVerifier,t,e,r)(e,t,r);return{verifier:i,challenge:await(0,s.T)(Qr,ze.MX.GenerateCodeChallengeFromVerifier,t,e,r)(i,e,t,r)}}function Gr(e,t,r){try{const i=new Uint8Array(32);(0,s.l)(tt,ze.MX.GetRandomValues,t,e,r)(i);return $e(i)}catch(e){throw se(l)}}async function Qr(e,t,r,i){t.addQueueMeasurement(ze.MX.GenerateCodeChallengeFromVerifier,i);try{const o=await(0,s.T)(et,ze.MX.Sha256Digest,r,t,i)(e,t,i);return $e(new Uint8Array(o))}catch(e){throw se(l)}}async function Wr(e,t,r,i){r.addQueueMeasurement(ze.MX.InitializeBaseRequest,e.correlationId);const o=e.authority||t.auth.authority,n=[...e&&e.scopes||[]],a={...e,correlationId:e.correlationId,authority:o,scopes:n};if(a.authenticationScheme){if(a.authenticationScheme===ce.IO.SSH){if(!e.sshJwk)throw(0,Ot.aD)(Bt.missingSshJwk);if(!e.sshKid)throw(0,Ot.aD)(Bt.missingSshKid)}i.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}else a.authenticationScheme=ce.IO.BEARER,i.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!kr.$.isEmptyObj(e.claims)&&(a.requestedClaimsHash=await nt(e.claims)),a}async function Vr(e,t,r,i,o){i.addQueueMeasurement(ze.MX.InitializeSilentRequest,e.correlationId);const n=await(0,s.T)(Wr,ze.MX.InitializeBaseRequest,o,i,e.correlationId)(e,r,i,o);return{...e,...n,account:t,forceRefresh:e.forceRefresh||!1}}class Yr extends Xr{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(ze.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await(0,s.T)($r,ze.MX.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:ce.YM.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=ce.YM.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||it(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=a.H.getAbsoluteUrl(e.postLogoutRedirectUri,vt())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=a.H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,vt())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=a.H.getAbsoluteUrl(vt(),vt())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(ze.MX.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await(0,s.T)(this.getClientConfiguration.bind(this),ze.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new jr.m(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:n}=e;this.performanceClient.addQueueMeasurement(ze.MX.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=await(0,s.T)(this.getDiscoveredAuthority.bind(this),ze.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:n}),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:le.MSAL_SKU,version:Kt,cpu:ce.YM.EMPTY_STRING,os:ce.YM.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},o=Ir.W.setRequestState(this.browserCrypto,e&&e.state||ce.YM.EMPTY_STRING,i),n={...await(0,s.T)(Wr,ze.MX.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:o,nonce:e.nonce||it(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return n;const a=e.account||this.browserStorage.getActiveAccount(this.correlationId);if(a&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${a.homeAccountId}`,this.correlationId),n.account=a),!n.loginHint&&!a){const e=this.browserStorage.getLegacyLoginHint();e&&(n.loginHint=e)}return n}}var Jr=r(697090),Zr=r(66214),ei=r(939116),ti=r(403712),ri=r(472195),ii=r(994551),oi=r(102895),ni=r(16517);const ai="user_switch",si={[ai]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class ci extends c.lR{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,ci.prototype),this.name="NativeAuthError",this.ext=r}}function li(e){return!(!e.ext||!e.ext.status||"PERSISTENT_ERROR"!==e.ext.status&&"DISABLED"!==e.ext.status)||(!(!e.ext||!e.ext.error||-2147186943!==e.ext.error)||"ContentError"===e.errorCode)}function hi(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return(0,ur.IE)(vr.nativeAccountUnavailable);case"USER_INTERACTION_REQUIRED":return new ur.CB(e,t);case"USER_CANCEL":return se(y);case"NO_NETWORK":return se(U)}return new ci(e,si[e]||t,r)}var di=r(943200);class ui extends Yr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ze.MX.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Be.acquireTokenSilent_silentFlow),r=await(0,s.T)(this.getClientConfiguration.bind(this),ze.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new di.t(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const t=(await(0,s.T)(i.acquireCachedToken.bind(i),ze.MX.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof ae&&e.errorCode===j&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}class gi extends Xr{constructor(e,t,r,i,o,n,a,s,c,l,h,d){super(e,t,r,i,o,n,s,c,d),this.apiId=a,this.accountId=l,this.nativeMessageHandler=c,this.nativeStorageManager=h,this.silentCacheClient=new ui(e,this.nativeStorageManager,r,i,o,n,s,c,d),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const u=this.nativeMessageHandler.getExtensionId()===de?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=Kr.e.makeExtraSkuString({libraryName:le.MSAL_SKU,libraryVersion:Kt,extensionName:u,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Jr.YB]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(ze.MX.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(ze.MX.NativeInteractionClientAcquireToken,e.correlationId),r=Zr._C();try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...o}=i,n={method:me,request:o},a=await this.nativeMessageHandler.sendMessage(n),s=this.validateNativeResponse(a);return await this.handleNativeResponse(s,i,r).then((e=>(t.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),e))).catch((e=>{throw t.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e}))}catch(e){throw e instanceof ci&&this.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ei.l.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,gr.SB)(pr.noAccountFound);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw(0,gr.SB)(pr.noAccountFound);try{const e=this.createSilentCacheRequest(t,r),i=await this.silentCacheClient.acquireToken(e),o={...r,idTokenClaims:i?.idTokenClaims,idToken:i?.idToken};return{...i,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r),o={method:me,request:i};try{const e=await this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(e)}catch(e){if(e instanceof ci&&(this.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),li(e)))throw e}this.browserStorage.setTemporaryCache(Re,JSON.stringify(i),!0);const n={apiId:Be.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,n)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:i,...o}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Re));const n={method:me,request:o},a=Zr._C();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const e=await this.nativeMessageHandler.sendMessage(n);this.validateNativeResponse(e);const t=this.handleNativeResponse(e,o,a);this.browserStorage.setInteractionInProgress(!1);const r=await t;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),r}catch(e){throw this.browserStorage.setInteractionInProgress(!1),e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=Ar.My(e.id_token,or),o=this.createHomeAccountIdentifier(e,i),n=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(o!==n&&e.account.id!==t.accountId)throw hi(ai);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),s=(0,ti.J)(this.browserStorage,a,o,or,this.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,i,s,a.canonicalAuthority,r);return this.cacheAccount(s),this.cacheNativeTokens(e,t,o,i,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return mr.d.generateHomeAccountId(e.client_info||ce.YM.EMPTY_STRING,ri.I.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?ei.l.fromString(e.scope):ei.l.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===ce.IO.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new ii.Q(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,gr.SB)(pr.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,i)}return e.access_token}async generateAuthenticationResult(e,t,r,i,o,n){const a=this.addTelemetryFromNativeResponse(e),s=e.scope?ei.l.fromString(e.scope):ei.l.fromString(t.scope),c=e.account.properties||{},l=c.UID||r.oid||r.sub||ce.YM.EMPTY_STRING,h=c.TenantId||r.tid||ce.YM.EMPTY_STRING,d=(0,oi.o9)(i.getAccountInfo(),void 0,r,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const u=await this.generatePopAccessToken(e,t),g=t.tokenType===ce.IO.POP?ce.IO.POP:ce.IO.BEARER;return{authority:o,uniqueId:l,tenantId:h,scopes:s.asArray(),account:d,idToken:e.id_token,idTokenClaims:r,accessToken:u,fromCache:!!a&&this.isResponseFromCache(a),expiresOn:new Date(1e3*Number(n+e.expires_in)),tokenType:g,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,this.correlationId).catch((e=>{this.logger.error(`Error occurred while removing account context from browser storage. ${e}`)}))}cacheNativeTokens(e,t,r,i,o,n,a){const s=Cr.c_(r,t.authority,e.id_token||"",t.clientId,i.tid||""),c=a+(t.tokenType===ce.IO.POP?ce.YM.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),h={idToken:s,accessToken:Cr.Np(r,t.authority,o,t.clientId,i.tid||n,l.printScopes(),c,0,or,void 0,t.tokenType,void 0,t.keyId)};this.nativeStorageManager.saveCacheRecord(h,t.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,c.pz)(ni.unexpectedError,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new a.H(t);r.validateAsUri();const{scopes:i,...o}=e,n=new ei.l(i||[]);n.appendScopes(ce.aZ);const c={...o,accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:n.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:(()=>{switch(this.apiId){case Be.ssoSilent:case Be.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),ce._M.NONE}if(e.prompt)switch(e.prompt){case ce._M.NONE:case ce._M.CONSENT:case ce._M.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),se(J)}else this.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(c.signPopToken&&e.popKid)throw se(ee);if(this.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry=ue,e.authenticationScheme===ce.IO.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},r=new ii.Q(this.browserCrypto);let i;if(c.keyId)i=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{const o=await(0,s.T)(r.generateCnf.bind(r),ze.MX.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(t,this.logger);i=o.reqCnfString,c.keyId=o.kid,c.signPopToken=!0}c.reqCnf=i}return this.addRequestSKUs(c),c}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(Jr.Uu)&&e.extraParameters.hasOwnProperty(Jr.Mt)&&e.extraParameters.hasOwnProperty(Jr.U6);if(!e.embeddedClientId&&!t)return;let r="";const i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Jr.Mt],r=e.extraParameters[Jr.U6]),e.extraParameters={child_client_id:r,child_redirect_uri:i},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:i},e.correlationId)}}class pi{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(ze.MX.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:he,extensionId:this.extensionId,responseId:it(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise(((e,r)=>{this.resolvers.set(t.responseId,{resolve:e,reject:r})}))}static async createProvider(e,t,r){e.trace("NativeMessageHandler - createProvider called.");try{const i=new pi(e,t,r,de);return await i.sendHandshakeRequest(),i}catch(i){const o=new pi(e,t,r);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:he,extensionId:this.extensionId,responseId:it(),body:{method:ge}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise(((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout((()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(se(Q)),this.handshakeResolvers.delete(e.responseId)}),this.handshakeTimeoutMs)}))}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===he&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===ge){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(se(W))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if(e===fe){if(!r)return;const e=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)r.reject(hi(e.code,e.description,e.ext));else{if(!e.result)throw(0,c.pz)(ni.unexpectedError,"Event does not contain result.");e.result.code&&e.result.description?r.reject(hi(e.result.code,e.result.description,e.result.ext)):r.resolve(e.result)}this.resolvers.delete(t.responseId)}else if(e===pe){if(!i)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(t):i&&i.reject(t)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case ce.IO.BEARER:case ce.IO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}var mi=r(225236);class fi{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async handleCodeResponse(e,t){let r;this.performanceClient.addQueueMeasurement(ze.MX.HandleCodeResponse,t.correlationId);try{r=this.authModule.handleFragmentResponse(e,t.state)}catch(e){throw e instanceof mi.g&&e.subError===y?se(y):e}return(0,s.T)(this.handleCodeResponseFromServer.bind(this),ze.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(ze.MX.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await(0,s.T)(this.authModule.updateAuthority.bind(this.authModule),ze.MX.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await(0,s.T)(this.authModule.acquireToken.bind(this.authModule),ze.MX.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Tr.X.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Tr.X.UPN}:null}}var vi=r(555630);function Ci(e,t,r){const i=vi.n(e);if(!i)throw vi.S(e)?(r.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),r.errorPii(`The ${t} detected is: ${e}`),se(p)):(r.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),se(u));return i}class wi extends Yr{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s}acquireToken(e){try{const t={popupName:this.generatePopupName(e.scopes||ce.aZ,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),t.popup=this.openSizedPopup("about:blank",t),this.acquireTokenPopupAsync(e,t))}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t){this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(Be.acquireTokenPopup),i=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,De.Popup);St(i.authority);try{const o=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i),n=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),a=pi.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let c;a&&(c=this.performanceClient.startMeasurement(ze.MX.FetchAccountIdWithNativeBroker,e.correlationId));const l=await n.getAuthCodeUrl({...i,nativeBroker:a}),h=new fi(n,this.browserStorage,o,this.logger,this.performanceClient),d=this.initiateAuthRequest(l,t);this.eventHandler.emitEvent(Hr.POPUP_OPENED,De.Popup,{popupWindow:d},null);const u=await this.monitorPopupForHash(d,t.popupWindowParent),g=(0,s.l)(Ci,ze.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(u,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(xr.H.removeThrottle(this.browserStorage,this.config.auth.clientId,o),g.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),c&&c.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw se(V);const e=new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,g.accountId,this.nativeStorage,i.correlationId),{userRequestState:t}=Ir.W.parseRequestState(this.browserCrypto,i.state);return await e.acquireToken({...i,state:t,prompt:void 0})}return await h.handleCodeResponse(g,i)}catch(e){throw t.popup?.close(),e instanceof c.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}async logoutPopupAsync(e,t,r,i){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Hr.LOGOUT_START,De.Popup,e);const o=this.initializeServerTelemetryManager(Be.logoutPopup);try{await this.clearCacheOnLogout(e.account);const n=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r,account:e.account||void 0});try{n.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&n.authority.protocolMode===Rt.e.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId,this.correlationId),this.eventHandler.emitEvent(Hr.LOGOUT_SUCCESS,De.Popup,e),i){const e={apiId:Be.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=a.H.getAbsoluteUrl(i,vt());await this.navigationClient.navigateInternal(t,e)}return void t.popup?.close()}}const c=n.getLogoutUri(e);this.eventHandler.emitEvent(Hr.LOGOUT_SUCCESS,De.Popup,e);const l=this.openPopup(c,t);if(this.eventHandler.emitEvent(Hr.POPUP_OPENED,De.Popup,{popupWindow:l},null),await this.monitorPopupForHash(l,t.popupWindowParent).catch((()=>{})),i){const e={apiId:Be.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=a.H.getAbsoluteUrl(i,vt());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw t.popup?.close(),e instanceof c.lR&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(Hr.LOGOUT_FAILURE,De.Popup,null,e),this.eventHandler.emitEvent(Hr.LOGOUT_END,De.Popup),e}this.eventHandler.emitEvent(Hr.LOGOUT_END,De.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),se(d)}monitorPopupForHash(e,t){return new Promise(((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval((()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),void r(se(y));let o="";try{o=e.location.href}catch(e){}if(!o||"about:blank"===o)return;clearInterval(i);let n="";const a=this.config.auth.OIDCOptions.serverResponseType;e&&(n=a===ce.zL.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(n)}),this.config.system.pollIntervalMilliseconds)})).finally((()=>{this.cleanPopup(e,t)}))}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw se(w);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),se(C)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){const o=i.screenLeft?i.screenLeft:i.screenX,n=i.screenTop?i.screenTop:i.screenY,a=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,l=r.popupSize?.height,h=r.popupPosition?.top,d=r.popupPosition?.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=le.POPUP_WIDTH),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=le.POPUP_HEIGHT),(!h||h<0||h>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,s/2-le.POPUP_HEIGHT/2+n)),(!d||d<0||d>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),d=Math.max(0,a/2-le.POPUP_WIDTH/2+o)),i.open(e,t,`width=${c}, height=${l}, top=${h}, left=${d}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(De.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${le.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${le.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class yi{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Te,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Ee,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:Be.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if("function"==typeof t.onRedirectNavigate){this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback");return!1!==t.onRedirectNavigate(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await t.navigationClient.navigateExternal(e,r)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")}return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await t.navigationClient.navigateExternal(e,r)}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),se(d)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const r=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(r);if(!i)throw(0,gr.SB)(pr.stateNotFound,"Cached State");let o;try{o=this.authModule.handleFragmentResponse(e,i)}catch(e){throw e instanceof mi.g&&e.subError===y?se(y):e}const n=this.browserStorage.generateNonceKey(i),a=this.browserStorage.getTemporaryCache(n);if(this.authCodeRequest.code=o.code,o.cloud_instance_host_name&&await(0,s.T)(this.authModule.updateAuthority.bind(this.authModule),ze.MX.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(o.cloud_instance_host_name,this.authCodeRequest.correlationId),o.nonce=a||void 0,o.state=i,o.client_info)this.authCodeRequest.clientInfo=o.client_info;else{const e=this.checkCcsCredentials();e&&(this.authCodeRequest.ccsCredential=e)}const c=await this.authModule.acquireToken(this.authCodeRequest,o);return this.browserStorage.cleanRequestByState(t),c}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(Pe,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class ki extends Yr{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,a,c,l),this.nativeStorage=s}async acquireToken(e){const t=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,De.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const r=this.initializeServerTelemetryManager(Be.acquireTokenRedirect),i=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(Hr.RESTORE_FROM_BFCACHE,De.Redirect))};try{const o=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),n=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new yi(n,this.browserStorage,o,this.logger,this.performanceClient),c=await n.getAuthCodeUrl({...t,nativeBroker:pi.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),l=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${l}`),window.addEventListener("pageshow",i),await a.initiateAuthRequest(c,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(e){throw e instanceof c.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),e}}async handleRedirectPromise(e="",t){const r=this.initializeServerTelemetryManager(Be.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[i,o]=this.getRedirectResponse(e||"");if(!i)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(De.Redirect),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const n=this.browserStorage.getTemporaryCache(Te,!0)||ce.YM.EMPTY_STRING,s=a.H.removeHashFromUrl(n);if(s===a.H.removeHashFromUrl(window.location.href)&&this.config.auth.navigateToLoginRequestUrl){this.logger.verbose("Current page is loginRequestUrl, handling response"),n.indexOf("#")>-1&&pt(n);return await this.handleResponse(i,r)}if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(i,r);if(!mt()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(Ae,o,!0);const e={apiId:Be.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let t=!0;if(n&&"null"!==n)this.logger.verbose(`Navigating to loginRequestUrl: ${n}`),t=await this.navigationClient.navigateInternal(n,e);else{const r=Ct();this.browserStorage.setTemporaryCache(Te,r,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),t=await this.navigationClient.navigateInternal(r,e)}if(!t)return await this.handleResponse(i,r)}return null}catch(e){throw e instanceof c.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.browserStorage.cleanRequestByInteractionType(De.Redirect),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===ce.zL.QUERY?window.location.search:window.location.hash);let r=vi.n(t);if(r){try{!function(e,t,r){if(!e.state)throw se(g);const i=Pr(t,e.state);if(!i)throw se(m);if(i.interactionType!==r)throw se(f)}(r,this.browserCrypto,De.Redirect)}catch(e){return e instanceof c.lR&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return gt(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(Ae,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Ae)),i&&(r=vi.n(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t){const r=e.state;if(!r)throw se(g);const i=this.browserStorage.getCachedRequest(r);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw se(V);const t=new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:o}=Ir.W.parseRequestState(this.browserCrypto,r);return t.acquireToken({...i,state:o,prompt:void 0}).finally((()=>{this.browserStorage.cleanRequestByState(r)}))}const o=this.browserStorage.getCachedAuthority(r);if(!o)throw se(_);const n=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:o});xr.H.removeThrottle(this.browserStorage,this.config.auth.clientId,i);return new yi(n,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,r)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(Be.logout);try{this.eventHandler.emitEvent(Hr.LOGOUT_START,De.Redirect,e),await this.clearCacheOnLogout(t.account);const i={apiId:Be.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===Rt.e.OIDC)try{o.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return this.browserStorage.removeAccount(t.account?.homeAccountId,this.correlationId),void this.eventHandler.emitEvent(Hr.LOGOUT_SUCCESS,De.Redirect,t)}const n=o.getLogoutUri(t);if(this.eventHandler.emitEvent(Hr.LOGOUT_SUCCESS,De.Redirect,t),!e||"function"!=typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(n,i);if(!1!==e.onRedirectNavigate(n))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(n,i);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof c.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(Hr.LOGOUT_FAILURE,De.Redirect,null,e),this.eventHandler.emitEvent(Hr.LOGOUT_END,De.Redirect),e}this.eventHandler.emitEvent(Hr.LOGOUT_END,De.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return a.H.getAbsoluteUrl(t,vt())}}async function Ii(e,t,r,i,o){if(t.addQueueMeasurement(ze.MX.SilentHandlerInitiateAuthRequest,i),!e)throw r.info("Navigate url is empty"),se(d);return o?(0,s.T)(Ai,ze.MX.SilentHandlerLoadFrame,r,t,i)(e,o,t,i):(0,s.l)(bi,ze.MX.SilentHandlerLoadFrameSync,r,t,i)(e)}async function Ti(e,t,r,i,o,n,a){return i.addQueueMeasurement(ze.MX.SilentHandlerMonitorIframeForHash,n),new Promise(((i,n)=>{t<xt&&o.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${xt}ms). This may result in timeouts.`);const s=window.setTimeout((()=>{window.clearInterval(c),n(se(I))}),t),c=window.setInterval((()=>{let t="";const r=e.contentWindow;try{t=r?r.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let o="";r&&(o=a===ce.zL.QUERY?r.location.search:r.location.hash),window.clearTimeout(s),window.clearInterval(c),i(o)}),r)})).finally((()=>{(0,s.l)(Pi,ze.MX.RemoveHiddenIframe,o,i,n)(e)}))}function Ai(e,t,r,i){return r.addQueueMeasurement(ze.MX.SilentHandlerLoadFrame,i),new Promise(((r,i)=>{const o=Si();window.setTimeout((()=>{o?(o.src=e,r(o)):i("Unable to load iframe")}),t)}))}function bi(e){const t=Si();return t.src=e,t}function Si(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function Pi(e){document.body===e.parentNode&&document.body.removeChild(e)}class Ei extends Yr{constructor(e,t,r,i,o,n,a,s,c,l,h){super(e,t,r,i,o,n,s,l,h),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(ze.MX.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==ce._M.NONE&&t.prompt!==ce._M.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${ce._M.NONE}`),t.prompt=ce._M.NONE):t.prompt=ce._M.NONE;const r=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,De.Silent);St(r.authority);const i=this.initializeServerTelemetryManager(this.apiId);let o;try{return o=await(0,s.T)(this.createAuthCodeClient.bind(this),ze.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),await(0,s.T)(this.silentTokenHelper.bind(this),ze.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(o,r)}catch(r){if(r instanceof c.lR&&(r.setCorrelationId(this.correlationId),i.cacheFailedRequest(r)),!(o&&r instanceof c.lR&&r.errorCode===le.INVALID_GRANT_ERROR))throw r;this.performanceClient.addFields({retryError:r.errorCode},this.correlationId);const n=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,De.Silent);return await(0,s.T)(this.silentTokenHelper.bind(this),ze.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(o,n)}}logout(){return Promise.reject(se(P))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(ze.MX.SilentIframeClientTokenHelper,r);const i=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,r)(t),o=await(0,s.T)(e.getAuthCodeUrl.bind(e),ze.MX.GetAuthCodeUrl,this.logger,this.performanceClient,r)({...t,nativeBroker:pi.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),n=new fi(e,this.browserStorage,i,this.logger,this.performanceClient),a=await(0,s.T)(Ii,ze.MX.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(o,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),c=this.config.auth.OIDCOptions.serverResponseType,l=await(0,s.T)(Ti,ze.MX.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),h=(0,s.l)(Ci,ze.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,c,this.logger);if(h.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw se(V);const e=new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,h.accountId,this.browserStorage,r),{userRequestState:i}=Ir.W.parseRequestState(this.browserCrypto,t.state);return(0,s.T)(e.acquireToken.bind(e),ze.MX.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,r)({...t,state:i,prompt:t.prompt||ce._M.NONE})}return(0,s.T)(n.handleCodeResponse.bind(n),ze.MX.HandleCodeResponse,this.logger,this.performanceClient,r)(h,t)}}var Ri=r(949651);class Mi extends Yr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ze.MX.SilentRefreshClientAcquireToken,e.correlationId);const t=await(0,s.T)(Wr,ze.MX.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(Be.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return(0,s.T)(o.acquireTokenByRefreshToken.bind(o),ze.MX.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch((e=>{throw e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e),e}))}logout(){return Promise.reject(se(P))}async createRefreshTokenClient(e){const t=await(0,s.T)(this.getClientConfiguration.bind(this),ze.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Ri.O(t,this.performanceClient)}}class Ni{constructor(e,t,r,i){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw se(B);const i=e.correlationId||it(),o=t.id_token?Ar.My(t.id_token,or):void 0,n={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new dr.s4(dr.s4.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,n,this.logger,e.correlationId||it()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",i,o,a),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm,i),l=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r,i),h=this.loadRefreshToken(t,s.homeAccountId,s.environment,i);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:l,refreshToken:h},o,a)}loadAccount(e,t,r,i,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const t=mr.d.createFromAccountInfo(e.account);return this.storage.setAccount(t,r),t}if(!o||!t&&!i)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),se(x);const n=mr.d.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,i),a=i?.tid,s=(0,ti.J)(this.storage,o,n,or,r,i,t,o.hostnameAndPort,a,void 0,void 0,this.logger);return this.storage.setAccount(s,r),s}loadIdToken(e,t,r,i,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const n=Cr.c_(t,r,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(n,o),n}loadAccessToken(e,t,r,i,o,n,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const s=t.scope?ei.l.fromString(t.scope):new ei.l(e.scopes),c=n.expiresOn||t.expires_in+(new Date).getTime()/1e3,l=n.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,h=Cr.Np(r,i,t.access_token,this.config.auth.clientId,o,s.printScopes(),c,l,or);return this.storage.setAccessTokenCredential(h,a),h}loadRefreshToken(e,t,r,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=Cr.Mg(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(o,i),o}generateAuthenticationResult(e,t,r,i){let o,n="",a=[],s=null;t?.accessToken&&(n=t.accessToken.secret,a=ei.l.fromString(t.accessToken.target).asArray(),s=new Date(1e3*Number(t.accessToken.expiresOn)),o=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));const c=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:c.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:n,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:o,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}class _i extends jr.m{constructor(e){super(e),this.includeRedirectUri=!1}}class qi extends Yr{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,s,c,l),this.apiId=a}async acquireToken(e){if(!e.code)throw se(K);const t=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),ze.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,De.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},o=await(0,s.T)(this.getClientConfiguration.bind(this),ze.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),n=new _i(o);this.logger.verbose("Auth code client created");const a=new fi(n,this.browserStorage,i,this.logger,this.performanceClient);return await(0,s.T)(a.handleCodeResponseFromServer.bind(a),ze.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof c.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return Promise.reject(se(P))}}function Oi(e){const t=e?.idTokenClaims;return t?.tfp||t?.acr?"B2C":t?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===t?.tid?"MSA":"AAD":void 0}function Bi(e,t){try{At(e)}catch(e){throw t.end({success:!1},e),e}}class Di{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new cr(this.logger,this.performanceClient):hr.j,this.eventHandler=new Lr(this.logger),this.browserStorage=this.isBrowserEnvironment?new Mr(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,(0,dr.aw)(this.config.auth),this.performanceClient):Nr(this.config.auth.clientId,this.logger);const t={cacheLocation:ve.MemoryStorage,temporaryCacheLocation:ve.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Mr(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Ni(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static async createController(e,t){const r=new Di(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment)return this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,void this.eventHandler.emitEvent(Hr.INITIALIZE_END);const t=e?.correlationId||this.getRequestCorrelationId(),r=this.config.system.allowNativeBroker,i=this.performanceClient.startMeasurement(ze.MX.InitializeClientApplication,t);if(this.eventHandler.emitEvent(Hr.INITIALIZE_START),r)try{this.nativeExtensionProvider=await pi.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await(0,s.T)(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),ze.MX.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(Hr.INITIALIZE_END),i.end({allowNativeBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Tt(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),i=r&&pi.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,o=i?r?.correlationId:this.browserStorage.getTemporaryCache(Ee,!0)||"",n=this.performanceClient.startMeasurement(ze.MX.AcquireTokenRedirect,o);let a;if(this.eventHandler.emitEvent(Hr.HANDLE_REDIRECT_START,De.Redirect),i&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const e=new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,r.accountId,this.nativeInternalStorage,r.correlationId);a=(0,s.T)(e.handleRedirectPromise.bind(e),ze.MX.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,n.event.correlationId)(this.performanceClient,n.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const t=this.createRedirectClient(o);a=(0,s.T)(t.handleRedirectPromise.bind(t),ze.MX.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,n.event.correlationId)(e,n)}return a.then((e=>{if(e){t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(Hr.LOGIN_SUCCESS,De.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),n.end({success:!0,accountType:Oi(e.account)})}else n.event.errorCode?n.end({success:!1}):n.discard();return this.eventHandler.emitEvent(Hr.HANDLE_REDIRECT_END,De.Redirect),e})).catch((e=>{const r=e;throw t.length>0?this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Redirect,null,r):this.eventHandler.emitEvent(Hr.LOGIN_FAILURE,De.Redirect,null,r),this.eventHandler.emitEvent(Hr.HANDLE_REDIRECT_END,De.Redirect),n.end({success:!1},r),e}))}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(ze.MX.AcquireTokenPreRedirect,t);r.add({accountType:Oi(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=e=>{const t="function"==typeof i?i(e):void 0;return!1!==t?r.end({success:!0}):r.discard(),t};else{const e=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const i="function"==typeof e?e(t):void 0;return!1!==i?r.end({success:!0}):r.discard(),i}}const o=this.getAllAccounts().length>0;try{let i;if(bt(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),o?this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_START,De.Redirect,e):this.eventHandler.emitEvent(Hr.LOGIN_START,De.Redirect,e),this.nativeExtensionProvider&&this.canUseNative(e)){i=new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch((r=>{if(r instanceof ci&&li(r)){this.nativeExtensionProvider=void 0;return this.createRedirectClient(t).acquireToken(e)}if(r instanceof ur.CB){this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createRedirectClient(t).acquireToken(e)}throw this.browserStorage.setInteractionInProgress(!1),r}))}else{i=this.createRedirectClient(t).acquireToken(e)}return await i}catch(e){throw r.end({success:!1},e),o?this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Redirect,null,e):this.eventHandler.emitEvent(Hr.LOGIN_FAILURE,De.Redirect,null,e),e}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(ze.MX.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:Oi(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Bi(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(e){return Promise.reject(e)}const i=this.getAllAccounts();let o;if(i.length>0?this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_START,De.Popup,e):this.eventHandler.emitEvent(Hr.LOGIN_START,De.Popup,e),this.canUseNative(e))o=this.acquireTokenNative({...e,correlationId:t},Be.acquireTokenPopup).then((e=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,accountType:Oi(e.account)}),e))).catch((r=>{if(r instanceof ci&&li(r)){this.nativeExtensionProvider=void 0;return this.createPopupClient(t).acquireToken(e)}if(r instanceof ur.CB){this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createPopupClient(t).acquireToken(e)}throw this.browserStorage.setInteractionInProgress(!1),r}));else{o=this.createPopupClient(t).acquireToken(e)}return o.then((e=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(Hr.LOGIN_SUCCESS,De.Popup,e):this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Popup,e),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Oi(e.account)}),e))).catch((e=>(i.length>0?this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Popup,null,e):this.eventHandler.emitEvent(Hr.LOGIN_FAILURE,De.Popup,null,e),r.end({success:!1},e),Promise.reject(e))))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};let i;if(this.ssoSilentMeasurement=this.performanceClient.startMeasurement(ze.MX.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:Oi(e.account)}),Bi(this.initialized,this.ssoSilentMeasurement),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(Hr.SSO_SILENT_START,De.Silent,r),this.canUseNative(r))i=this.acquireTokenNative(r,Be.ssoSilent).catch((e=>{if(e instanceof ci&&li(e)){this.nativeExtensionProvider=void 0;return this.createSilentIframeClient(r.correlationId).acquireToken(r)}throw e}));else{i=this.createSilentIframeClient(r.correlationId).acquireToken(r)}return i.then((e=>(this.eventHandler.emitEvent(Hr.SSO_SILENT_SUCCESS,De.Silent,e),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Oi(e.account)}),e))).catch((e=>{throw this.eventHandler.emitEvent(Hr.SSO_SILENT_FAILURE,De.Silent,null,e),this.ssoSilentMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(ze.MX.AcquireTokenByCode,t);Bi(this.initialized,r),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_BY_CODE_START,De.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw se(X);if(e.code){const i=e.code;let o=this.hybridAuthCodeResponses.get(i);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then((e=>(this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_BY_CODE_SUCCESS,De.Silent,e),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Oi(e.account)}),e))).catch((e=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_BY_CODE_FAILURE,De.Silent,null,e),r.end({success:!1},e),e})),this.hybridAuthCodeResponses.set(i,o)),await o}if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},Be.acquireTokenByCode,e.nativeAccountId).catch((e=>{throw e instanceof ci&&li(e)&&(this.nativeExtensionProvider=void 0),e}));return r.end({accountType:Oi(i.account),success:!0}),i}throw se(G)}throw se(z)}catch(e){throw this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_BY_CODE_FAILURE,De.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(ze.MX.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then((e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker}),e))).catch((e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(ze.MX.AcquireTokenFromCache,e.correlationId),t){case je.Default:case je.AccessToken:case je.AccessTokenAndRefreshToken:const t=this.createSilentCacheClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),ze.MX.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,gr.SB)(pr.tokenRefreshRequired)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(ze.MX.AcquireTokenByRefreshToken,e.correlationId),t){case je.Default:case je.AccessTokenAndRefreshToken:case je.RefreshToken:case je.RefreshTokenAndNetwork:const t=this.createSilentRefreshClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),ze.MX.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,gr.SB)(pr.tokenRefreshRequired)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(ze.MX.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),ze.MX.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);bt(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0);return this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);At(this.initialized),this.browserStorage.setInteractionInProgress(!0);return this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return _r(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return qr(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return Or(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return Br(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return Dr(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();Ur(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return Fr(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=mr.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw se(V);return new gi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!pi.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case ce._M.NONE:case ce._M.CONSENT:case ce._M.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e))||(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1)}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new wi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new ki(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Ei(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new ui(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Mi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new qi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Be.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return It(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes(ce.Gd.ACTIVE_ACCOUNT_FILTERS)&&this.eventHandler.emitEvent(Hr.ACTIVE_ACCOUNT_CHANGED);const t=e.newValue||e.oldValue;if(!t)return;const r=JSON.parse(t);if("object"!=typeof r||!mr.d.isAccountEntity(r))return;const i=fr.G.toObject(new mr.d,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent(Hr.ACCOUNT_ADDED,void 0,i)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent(Hr.ACCOUNT_REMOVED,void 0,i))}catch(e){return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?it():ce.YM.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Fe})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Fe})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(ze.MX.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Bi(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw se(E);r.add({accountType:Oi(i)});const o={clientId:this.config.auth.clientId,authority:e.authority||ce.YM.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},n=JSON.stringify(o),a=this.activeSilentTokenRequests.get(n);if(void 0===a){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const o=(0,s.T)(this.acquireTokenSilentAsync.bind(this),ze.MX.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then((t=>(this.activeSilentTokenRequests.delete(n),r.end({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length}),t))).catch((e=>{throw this.activeSilentTokenRequests.delete(n),r.end({success:!1},e),e}));return this.activeSilentTokenRequests.set(n,o),{...await o,state:e.state}}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(ze.MX.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_START,De.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await(0,s.T)(Vr,ze.MX.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||je.Default;return this.acquireTokenSilentNoIframe(i,o).catch((async e=>{const t=function(e,t){const r=!(e instanceof ur.CB&&e.subError!==vr.badToken),i=e.errorCode===le.INVALID_GRANT_ERROR||e.errorCode===pr.tokenRefreshRequired,o=r&&i||e.errorCode===vr.noTokensFound||e.errorCode===vr.refreshTokenExpired,n=Ke.includes(t);return o&&n}(e,o);if(t){if(this.activeIframeRequest){if(o!==je.Skip){const[t,r]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${r}`,i.correlationId);const n=this.performanceClient.startMeasurement(ze.MX.AwaitConcurrentIframe,i.correlationId);n.add({awaitIframeCorrelationId:r});const a=await t;if(n.end({success:a}),a)return this.logger.verbose(`Parallel iframe request with correlationId: ${r} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,o);throw this.logger.info(`Iframe request with correlationId: ${r} failed. Interaction is required.`),e}return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),ze.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i)}{let e;return this.activeIframeRequest=[new Promise((t=>{e=t})),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),ze.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then((t=>(e(!0),t))).catch((t=>{throw e(!1),t})).finally((()=>{this.activeIframeRequest=void 0}))}}throw e})).then((t=>(this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker},e.correlationId),t))).catch((e=>{throw this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Silent,null,e),e})).finally((()=>{document.removeEventListener("visibilitychange",r)}))}async acquireTokenSilentNoIframe(e,t){return pi.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,Be.acquireTokenSilent_silentFlow).catch((async e=>{if(e instanceof ci&&li(e))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,(0,gr.SB)(pr.tokenRefreshRequired);throw e}))):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),(0,s.T)(this.acquireTokenFromCache.bind(this),ze.MX.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch((r=>{if(t===je.AccessToken)throw r;return this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_NETWORK_START,De.Silent,e),(0,s.T)(this.acquireTokenByRefreshToken.bind(this),ze.MX.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)})))}}var Ui=r(760141);class Fi{constructor(e,t,r,i){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=i}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const r=e.correlationId||this.crypto.createNewGuid(),i=new Ui.W(r).addClientCapabilitiesToClaims(e.claims,this.clientCapabilities),o=e.scopes||ce.aZ;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:o.join(" "),correlationId:r,claims:kr.$.isEmptyObj(i)?void 0:i,state:e.state,authenticationScheme:e.authenticationScheme||ce.IO.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw(0,gr.SB)(pr.nullOrEmptyToken);const i=new Date(1e3*(r+(t.token.expires_in||0))),o=Ar.My(t.token.id_token,this.crypto.base64Decode),n=this.fromNaaAccountInfo(t.account,t.token.id_token,o),a=t.token.scope||e.scope;return{authority:t.token.authority||n.environment,uniqueId:n.localAccountId,tenantId:n.tenantId,scopes:a.split(" "),account:n,idToken:t.token.id_token,idTokenClaims:o,accessToken:t.token.access_token,fromCache:!1,expiresOn:i,tokenType:e.authenticationScheme||ce.IO.BEARER,correlationId:e.correlationId,extExpiresOn:i,state:e.state}}fromNaaAccountInfo(e,t,r){const i=r||e.idTokenClaims,o=e.localAccountId||i?.oid||i?.sub||"",n=e.tenantId||i?.tid||"",a=e.homeAccountId||`${o}.${n}`,s=e.username||i?.preferred_username||"",c=e.name||i?.name,l=new Map,h=(0,oi.Km)(a,o,n,i);l.set(n,h);return{homeAccountId:a,environment:e.environment,tenantId:n,username:s,localAccountId:o,name:c,idToken:t,idTokenClaims:i,tenantProfiles:l}}fromBridgeError(e){if(!function(e){return void 0!==e.status}(e))return new c.lR("unknown_error","An unknown error occurred");switch(e.status){case Gt:return new gr.eB(pr.userCanceled);case Qt:return new gr.eB(pr.noNetworkConnectivity);case Jt:return new gr.eB(pr.noAccountFound);case Yt:return new gr.eB(pr.nestedAppAuthBridgeDisabled);case Zt:return new gr.eB(e.code||pr.nestedAppAuthBridgeDisabled,e.description);case Wt:case Vt:return new mi.g(e.code,e.description);case $t:return new ur.CB(e.code,e.description);default:return new c.lR(e.code,e.description)}}toAuthenticationResultFromCache(e,t,r,i,o){if(!t||!r)throw(0,gr.SB)(pr.nullOrEmptyToken);const n=Ar.My(t.secret,this.crypto.base64Decode),a=r.target||i.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:a.split(" "),account:e,idToken:t.secret,idTokenClaims:n||{},accessToken:r.secret,fromCache:!0,expiresOn:new Date(1e3*Number(r.expiresOn)),tokenType:i.authenticationScheme||ce.IO.BEARER,correlationId:o,extExpiresOn:new Date(1e3*Number(r.extendedExpiresOn)),state:i.state}}}const Hi={code:"unsupported_method",desc:"This method is not supported in nested app environment."};class Li extends c.lR{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Li.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new Li(Hi.code,Hi.desc)}}class xi{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new cr(this.logger,this.performanceClient,!0):hr.j,this.browserStorage=this.operatingContext.isBrowserEnvironment()?new Mr(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,(0,dr.aw)(this.config.auth)):Nr(this.config.auth.clientId,this.logger),this.eventHandler=new Lr(this.logger),this.nestedAppAuthAdapter=new Fi(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);const r=this.bridgeProxy.getAccountContext();if(r){const e=it();Ur(qr(r,this.logger,this.browserStorage,e),this.browserStorage,e)}}static async createController(e){const t=new xi(e);return Promise.resolve(t)}initialize(){return Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_START,De.Popup,t);const r=this.performanceClient.startMeasurement(ze.MX.AcquireTokenPopup,t.correlationId);r?.add({nestedAppAuthRequest:!0});try{const i=this.nestedAppAuthAdapter.toNaaTokenRequest(t),o=Zr._C(),n=await this.bridgeProxy.getTokenInteractive(i),a={...this.nestedAppAuthAdapter.fromNaaTokenResponse(i,n,o)};return await this.hydrateCache(a,e),this.browserStorage.setActiveAccount(a.account,a.correlationId),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Popup,a),r.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),r.end({success:!0,requestId:a.requestId}),a}catch(e){const t=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Popup,null,e),r.end({success:!1},e),t}}async acquireTokenSilentInternal(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_START,De.Silent,t);const r=await this.acquireTokenFromCache(t);if(r)return this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Silent,r),r;const i=this.performanceClient.startMeasurement(ze.MX.SsoSilent,t.correlationId);i?.increment({visibilityChangeCount:0}),i?.add({nestedAppAuthRequest:!0});try{const r=this.nestedAppAuthAdapter.toNaaTokenRequest(t),o=Zr._C(),n=await this.bridgeProxy.getTokenSilent(r),a=this.nestedAppAuthAdapter.fromNaaTokenResponse(r,n,o);return await this.hydrateCache(a,e),this.browserStorage.setActiveAccount(a.account,a.correlationId),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Silent,a),i?.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),i?.end({success:!0,requestId:a.requestId}),a}catch(e){const t=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Silent,null,e),i?.end({success:!1},e),t}}async acquireTokenFromCache(e){const t=this.performanceClient.startMeasurement(ze.MX.AcquireTokenSilent,e.correlationId);if(t?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("Claims are present in the request, skipping cache lookup"),null;let r=null;switch(e.cacheLookupPolicy){case je.Default:case je.AccessToken:case je.AccessTokenAndRefreshToken:r=await this.acquireTokenFromCacheInternal(e);break;default:return null}return r?(this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_SUCCESS,De.Silent,r),t?.add({accessTokenSize:r?.accessToken.length,idTokenSize:r?.idToken.length}),t?.end({success:!0}),r):(this.logger.error("Cached tokens are not found for the account, proceeding with silent token request."),this.eventHandler.emitEvent(Hr.ACQUIRE_TOKEN_FAILURE,De.Silent,null),t?.end({success:!1}),null)}async acquireTokenFromCacheInternal(e){const t=e.correlationId||it(),r=this.bridgeProxy.getAccountContext();let i=null;if(r){i=qr(r,this.logger,this.browserStorage,t)||e.account}if(!i)return this.logger.verbose("No active account found, falling back to the host"),Promise.resolve(null);this.logger.verbose("active account found, attempting to acquire token silently");const o={...e,correlationId:t,authority:e.authority||i.environment,scopes:e.scopes?.length?e.scopes:[...ce.aZ]},n=this.browserStorage.getTokenKeys(),a=this.browserStorage.getAccessToken(i,o,n,i.tenantId,this.performanceClient);if(!a)return this.logger.verbose("No cached access token found"),Promise.resolve(null);if(Zr.XJ(a.cachedAt)||Zr.Hm(a.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("Cached access token has expired"),Promise.resolve(null);const s=this.browserStorage.getIdToken(i,o.correlationId,n,i.tenantId,this.performanceClient);return s?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(i,s,a,o,o.correlationId):(this.logger.verbose("No cached id token found"),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw Li.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw Li.createUnsupportedError()}acquireTokenNative(e,t,r){throw Li.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw Li.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw Li.createUnsupportedError()}removePerformanceCallback(e){throw Li.createUnsupportedError()}enableAccountStorageEvents(){throw Li.createUnsupportedError()}disableAccountStorageEvents(){throw Li.createUnsupportedError()}getAllAccounts(e){const t=it();return _r(this.logger,this.browserStorage,this.isBrowserEnv(),t,e)}getAccount(e){const t=it();return qr(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=it();return Or(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=it();return Br(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=it();return Dr(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=it();return Ur(e,this.browserStorage,t)}getActiveAccount(){const e=it();return Fr(this.browserStorage,e)}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||Fe)}loginRedirect(e){throw Li.createUnsupportedError()}logout(e){throw Li.createUnsupportedError()}logoutRedirect(e){throw Li.createUnsupportedError()}logoutPopup(e){throw Li.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw Li.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw Li.createUnsupportedError()}getRedirectResponse(){throw Li.createUnsupportedError()}async clearCache(e){throw Li.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=mr.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r,e.correlationId),this.browserStorage.hydrateCache(e,t)}}async function ji(e){const t=new rr(e),r=new tr(e),i=[t.initialize(),r.initialize()];return await Promise.all(i),r.isAvailable()&&e.auth.supportsNestedAppAuth?xi.createController(r):t.isAvailable()?Di.createController(t):null}class Ki{static async createPublicClientApplication(e){const t=await async function(e,t){const r=new rr(e);return await r.initialize(),Di.createController(r,t)}(e);return new Ki(e,t)}constructor(e,t){this.controller=t||new Di(new rr(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}async function zi(e){const t=new tr(e);if(await t.initialize(),t.isAvailable()){const r=new xi(t);return new Ki(e,r)}return Xi(e)}async function Xi(e){const t=new Ki(e);return await t.initialize(),t}class $i{constructor(e){this.initialized=!1,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.logger=e.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new cr(this.logger,this.performanceClient):hr.j,this.browserStorage=this.isBrowserEnvironment?new Mr(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,void 0,this.performanceClient):Nr(this.config.auth.clientId,this.logger)}getBrowserStorage(){return this.browserStorage}getAccount(e){return null}getAccountByHomeId(e){return null}getAccountByLocalId(e){return null}getAccountByUsername(e){return null}getAllAccounts(){return[]}initialize(){return this.initialized=!0,Promise.resolve()}acquireTokenPopup(e){return Tt(this.initialized),It(),{}}acquireTokenRedirect(e){return Tt(this.initialized),It(),Promise.resolve()}acquireTokenSilent(e){return Tt(this.initialized),It(),{}}acquireTokenByCode(e){return Tt(this.initialized),It(),{}}acquireTokenNative(e,t,r){return Tt(this.initialized),It(),{}}acquireTokenByRefreshToken(e,t){return Tt(this.initialized),It(),{}}addEventCallback(e,t){return null}removeEventCallback(e){}addPerformanceCallback(e){return Tt(this.initialized),It(),""}removePerformanceCallback(e){return Tt(this.initialized),It(),!0}enableAccountStorageEvents(){Tt(this.initialized),It()}disableAccountStorageEvents(){Tt(this.initialized),It()}handleRedirectPromise(e){return Tt(this.initialized),Promise.resolve(null)}loginPopup(e){return Tt(this.initialized),It(),{}}loginRedirect(e){return Tt(this.initialized),It(),{}}logout(e){return Tt(this.initialized),It(),{}}logoutRedirect(e){return Tt(this.initialized),It(),{}}logoutPopup(e){return Tt(this.initialized),It(),{}}ssoSilent(e){return Tt(this.initialized),It(),{}}getTokenCache(){return Tt(this.initialized),It(),{}}getLogger(){return this.logger}setLogger(e){Tt(this.initialized),It()}setActiveAccount(e){Tt(this.initialized),It()}getActiveAccount(){return Tt(this.initialized),It(),null}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){Tt(this.initialized),It()}getConfiguration(){return this.config}isBrowserEnv(){return Tt(this.initialized),It(),!0}getBrowserCrypto(){return Tt(this.initialized),It(),{}}getPerformanceClient(){return Tt(this.initialized),It(),{}}getRedirectResponse(){return Tt(this.initialized),It(),{}}async clearCache(e){Tt(this.initialized),It()}async hydrateCache(e,t){Tt(this.initialized),It()}}class Gi extends Xt{getId(){return Gi.ID}getModuleName(){return Gi.MODULE_NAME}async initialize(){return!0}}Gi.MODULE_NAME="",Gi.ID="UnknownOperatingContext";class Qi{static async createPublicClientApplication(e){const t=await ji(e);let r;return r=null!==t?new Qi(e,t):new Qi(e),r}constructor(e,t){if(this.configuration=e,t)this.controller=t;else{const t=new Gi(e);this.controller=new $i(t)}}async initialize(){if(this.controller instanceof $i){const e=await ji(this.configuration);return null!==e&&(this.controller=e),this.controller.initialize()}return Promise.resolve()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const Wi={initialize:()=>Promise.reject(ut(st)),acquireTokenPopup:()=>Promise.reject(ut(st)),acquireTokenRedirect:()=>Promise.reject(ut(st)),acquireTokenSilent:()=>Promise.reject(ut(st)),acquireTokenByCode:()=>Promise.reject(ut(st)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(ut(st)),loginPopup:()=>Promise.reject(ut(st)),loginRedirect:()=>Promise.reject(ut(st)),logout:()=>Promise.reject(ut(st)),logoutRedirect:()=>Promise.reject(ut(st)),logoutPopup:()=>Promise.reject(ut(st)),ssoSilent:()=>Promise.reject(ut(st)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw ut(st)},getLogger:()=>{throw ut(st)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw ut(st)},hydrateCache:()=>Promise.reject(ut(st)),clearCache:()=>Promise.reject(ut(st))};class Vi{constructor(e){if(e===ve.LocalStorage)this.windowStorage=new br;else{if(e!==ve.SessionStorage)throw ut(at);this.windowStorage=new Sr}}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}class Yi{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case Hr.LOGIN_START:return Ue.Login;case Hr.SSO_SILENT_START:return Ue.SsoSilent;case Hr.ACQUIRE_TOKEN_START:if(e.interactionType===De.Redirect||e.interactionType===De.Popup)return Ue.AcquireToken;break;case Hr.HANDLE_REDIRECT_START:return Ue.HandleRedirect;case Hr.LOGOUT_START:return Ue.Logout;case Hr.SSO_SILENT_SUCCESS:case Hr.SSO_SILENT_FAILURE:if(t&&t!==Ue.SsoSilent)break;return Ue.None;case Hr.LOGOUT_END:if(t&&t!==Ue.Logout)break;return Ue.None;case Hr.HANDLE_REDIRECT_END:if(t&&t!==Ue.HandleRedirect)break;return Ue.None;case Hr.LOGIN_SUCCESS:case Hr.LOGIN_FAILURE:case Hr.ACQUIRE_TOKEN_SUCCESS:case Hr.ACQUIRE_TOKEN_FAILURE:case Hr.RESTORE_FROM_BFCACHE:if(e.interactionType===De.Redirect||e.interactionType===De.Popup){if(t&&t!==Ue.Login&&t!==Ue.AcquireToken)break;return Ue.None}}return null}}class Ji{constructor(e,t){const r=t&&t.loggerOptions||{};this.logger=new Et.V(r,jt,Kt),this.cryptoOps=new cr(this.logger),this.popTokenGenerator=new ii.Q(this.cryptoOps),this.shrParameters=e}async generatePublicKeyThumbprint(){const{kid:e}=await this.popTokenGenerator.generateKid(this.shrParameters);return e}async signRequest(e,t,r){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,r)}async removeKeys(e){return this.cryptoOps.removeTokenBindingKey(e)}}var Zi=r(296950);function eo(){let e;try{e=window[ve.SessionStorage];const t=e?.getItem("msal.browser.performance.enabled");if(1===Number(t))return Promise.resolve().then(r.bind(r,205090))}catch(e){}}function to(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now}function ro(e){if(e&&to())return Math.round(window.performance.now()-e)}class io extends Zi.cm{constructor(e,t,r){super(e.auth.clientId,e.auth.authority||`${ce.YM.DEFAULT_AUTHORITY}`,new Et.V(e.system?.loggerOptions||{},jt,Kt),jt,Kt,e.telemetry?.application||{appName:"",appVersion:""},t,r)}generateId(){return it()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){eo()?.then((t=>{const r=this.eventsByCorrelationId.get(e.event.correlationId),i=r&&r.eventId===e.event.eventId,o=[];i&&r?.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach((e=>{o.push({...e})})),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,o)}))}startMeasurement(e,t){const r=this.getPageVisibility(),i=super.startMeasurement(e,t),o=to()?window.performance.now():void 0,n=eo()?.then((t=>new t.BrowserPerformanceMeasurement(e,i.event.correlationId)));return n?.then((e=>e.startMeasurement())),{...i,end:(e,t)=>{const a=i.end({...e,startPageVisibility:r,endPageVisibility:this.getPageVisibility(),durationMs:ro(o)},t);return n?.then((e=>e.endMeasurement())),this.deleteIncompleteSubMeasurements(i),a},discard:()=>{i.discard(),n?.then((e=>e.flushMeasurement())),this.deleteIncompleteSubMeasurements(i)}}}setPreQueueTime(e,t){if(!to())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);const r=this.preQueueTimeByCorrelationId.get(t);r&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${r.name} found`,t),this.addQueueMeasurement(r.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,r,i){if(!to())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);const o=super.getPreQueueTime(e,t);if(!o)return;const n=window.performance.now(),a=r||super.calculateQueuedTime(o,n);return super.addQueueMeasurement(e,t,a,i)}}var oo=r(205090),no=r(64158)},33544:(e,t,r)=>{r.d(t,{M:()=>m});var i=r(285868),o=r(310617),n=r(206809),a=r(139785),s=r(931553),c=r(666637),l=r(279676),h=r(207712),d=r(441454),u=r(388e3),g=r(570954);class p{constructor(e){this.inMemoryCache=new u.X,this.indexedDBCache=new d.V,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof h.jT&&e.errorCode===g.databaseUnavailable))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class m{constructor(e,t,r){this.logger=e,(0,l.RW)(r??!1),this.cache=new p(this.logger),this.performanceClient=t}createNewGuid(){return(0,l.Oy)()}base64Encode(e){return(0,s.KA)(e)}base64Decode(e){return(0,c.u)(e)}base64UrlEncode(e){return(0,s.u4)(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(i.MX.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await(0,l.TZ)(m.EXTRACTABLE,m.POP_KEY_USAGES),o=await(0,l.RI)(r.publicKey),n=f({e:o.e,kty:o.kty,n:o.n}),a=await this.hashString(n),s=await(0,l.RI)(r.privateKey),c=await(0,l.W6)(s,!1,["sign"]);return await this.cache.setItem(a,{privateKey:c,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){await this.cache.removeItem(e);if(await this.cache.containsKey(e))throw(0,o.SB)(n.bindingKeyNotRemoved)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,o){const n=this.performanceClient?.startMeasurement(i.MX.CryptoOptsSignJwt,o),c=await this.cache.getItem(t);if(!c)throw(0,h.bD)(g.cryptoKeyNotFound);const d=await(0,l.RI)(c.publicKey),u=f(d),p=(0,s.u4)(JSON.stringify({kid:t})),m=a.p.getShrHeaderString({...r?.header,alg:d.alg,kid:p}),v=(0,s.u4)(m);e.cnf={jwk:JSON.parse(u)};const C=`${v}.${(0,s.u4)(JSON.stringify(e))}`,w=(new TextEncoder).encode(C),y=await(0,l._S)(c.privateKey,w),k=`${C}.${(0,s.dB)(new Uint8Array(y))}`;return n&&n.end({success:!0}),k}async hashString(e){return(0,l.YZ)(e)}}function f(e){return JSON.stringify(e,Object.keys(e).sort())}m.POP_KEY_USAGES=["sign","verify"],m.EXTRACTABLE=!0},34467:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(634651);class o extends i.A{getModuleName(){return o.MODULE_NAME}getId(){return o.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}o.MODULE_NAME="",o.ID="StandardOperatingContext"},156024:(e,t,r)=>{if(r.d(t,{Q:()=>a}),"cloudFilePickerDialog"!=r.j)var i=r(360871);if("cloudFilePickerDialog"!=r.j)var o=r(975189);if("cloudFilePickerDialog"!=r.j)var n=r(520134);class a{static async createPublicClientApplication(e){const t=await(0,i.d)(e);let r;return r=null!==t?new a(e,t):new a(e),r}constructor(e,t){if(this.configuration=e,t)this.controller=t;else{const t=new n.v(e);this.controller=new o.n(t)}}async initialize(){if(this.controller instanceof o.n){const e=await(0,i.d)(this.configuration);return null!==e&&(this.controller=e),this.controller.initialize()}return Promise.resolve()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}},180315:(e,t,r)=>{if(r.d(t,{D:()=>n}),"cloudFilePickerDialog"!=r.j)var i=r(494030);if("cloudFilePickerDialog"!=r.j)var o=r(585020);class n{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case i.B.LOGIN_START:return o.T$.Login;case i.B.SSO_SILENT_START:return o.T$.SsoSilent;case i.B.ACQUIRE_TOKEN_START:if(e.interactionType===o.X8.Redirect||e.interactionType===o.X8.Popup)return o.T$.AcquireToken;break;case i.B.HANDLE_REDIRECT_START:return o.T$.HandleRedirect;case i.B.LOGOUT_START:return o.T$.Logout;case i.B.SSO_SILENT_SUCCESS:case i.B.SSO_SILENT_FAILURE:if(t&&t!==o.T$.SsoSilent)break;return o.T$.None;case i.B.LOGOUT_END:if(t&&t!==o.T$.Logout)break;return o.T$.None;case i.B.HANDLE_REDIRECT_END:if(t&&t!==o.T$.HandleRedirect)break;return o.T$.None;case i.B.LOGIN_SUCCESS:case i.B.LOGIN_FAILURE:case i.B.ACQUIRE_TOKEN_SUCCESS:case i.B.ACQUIRE_TOKEN_FAILURE:case i.B.RESTORE_FROM_BFCACHE:if(e.interactionType===o.X8.Redirect||e.interactionType===o.X8.Popup){if(t&&t!==o.T$.Login&&t!==o.T$.AcquireToken)break;return o.T$.None}}return null}}},182150:(e,t,r)=>{r.d(t,{Z:()=>R});var i=r(667426),o=r(639051),n=r(285868),a=r(81877),s=r(469829),c=r(310617),l=r(206809),h=r(744212),d=r(716936),u=r(525630),g=r(593744),p=r(405648),m=r(975030),f=r(281072),v=r(128837),C=r(162989),w=r(642059),y=r(765846),k=r(585020),I=r(447851),T=r(207712),A=r(347780),b=r(666637),S=r(556012),P=r(570954),E=r(841075);class R extends y.x{constructor(e,t,r,o,n,a,s,c,l,h,d,u){super(e,t,r,o,n,a,c,l,u),this.apiId=s,this.accountId=h,this.platformAuthProvider=l,this.nativeStorageManager=d,this.silentCacheClient=new A.d(e,this.nativeStorageManager,r,o,n,a,c,l,u);const g=this.platformAuthProvider.getExtensionName();this.skus=i.e.makeExtraSkuString({libraryName:k.Q1.MSAL_SKU,libraryVersion:S.r,extensionName:g,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[o.YB]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(n.MX.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const r=this.performanceClient.startMeasurement(n.MX.NativeInteractionClientAcquireToken,e.correlationId),i=a._C(),o=this.initializeServerTelemetryManager(this.apiId);try{const n=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,n);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(t===k.nN.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),e;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const a=await this.platformAuthProvider.sendMessage(n);return await this.handleNativeResponse(a,n,i).then((e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e))).catch((e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e}))}catch(e){throw e instanceof I.mr&&o.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:s.l.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,c.SB)(l.noAccountFound);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!r)throw(0,c.SB)(l.noAccountFound);try{const e=this.createSilentCacheRequest(t,r),i=await this.silentCacheClient.acquireToken(e),o={...r,idTokenClaims:i?.idTokenClaims,idToken:i?.idToken};return{...i,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r);try{await this.platformAuthProvider.sendMessage(i)}catch(e){if(e instanceof I.mr){if(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(e.errorCode),(0,I.Em)(e))throw e}}this.browserStorage.setTemporaryCache(k._p.NATIVE_REQUEST,JSON.stringify(i),!0);const o={apiId:k.sA.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(n,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:i,...o}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(k._p.NATIVE_REQUEST));const n=a._C();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const e=await this.platformAuthProvider.sendMessage(o),t=await this.handleNativeResponse(e,o,n);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),t}catch(e){throw e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=h.My(e.id_token,b.u),o=this.createHomeAccountIdentifier(e,i),n=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(o!==n&&e.account.id!==t.accountId)throw(0,I.uz)(E.o);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),s=(0,d.J)(this.browserStorage,a,o,b.u,this.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const c=await this.generateAuthenticationResult(e,t,i,s,a.canonicalAuthority,r);return await this.cacheAccount(s,this.correlationId),await this.cacheNativeTokens(e,t,o,i,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return u.d.generateHomeAccountId(e.client_info||g.YM.EMPTY_STRING,p.I.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?s.l.fromString(t):s.l.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===g.IO.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new m.Q(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,c.SB)(l.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,i)}return e.access_token}async generateAuthenticationResult(e,t,r,i,o,n){const s=this.addTelemetryFromNativeResponse(e.properties.MATS),c=this.generateScopes(t.scope,e.scope),l=e.account.properties||{},h=l.UID||r.oid||r.sub||g.YM.EMPTY_STRING,d=l.TenantId||r.tid||g.YM.EMPTY_STRING,u=(0,f.o9)(i.getAccountInfo(),void 0,r,e.id_token);u.nativeAccountId!==e.account.id&&(u.nativeAccountId=e.account.id);const p=await this.generatePopAccessToken(e,t),m=t.tokenType===g.IO.POP?g.IO.POP:g.IO.BEARER;return{authority:o,uniqueId:h,tenantId:d,scopes:c.asArray(),account:u,idToken:e.id_token,idTokenClaims:r,accessToken:p,fromCache:!!s&&this.isResponseFromCache(s),expiresOn:a.dM(n+e.expires_in),tokenType:m,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,t)}cacheNativeTokens(e,t,r,i,o,n,a){const s=v.c_(r,t.authority,e.id_token||"",t.clientId,i.tid||""),c=a+(t.tokenType===g.IO.POP?g.YM.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e.scope,t.scope),h={idToken:s,accessToken:v.Np(r,t.authority,o,t.clientId,i.tid||n,l.printScopes(),c,0,b.u,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(h,this.correlationId,t.storeInCache)}getExpiresInValue(e,t){return e===g.IO.POP?g.YM.SHR_NONCE_VALIDITY:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:r,...i}=e,o=new s.l(r||[]);o.appendScopes(g.aZ);const a={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(a.signPopToken&&e.popKid)throw(0,T.bD)(P.invalidPopTokenRequest);if(this.handleExtraBrokerParams(a),a.extraParameters=a.extraParameters||{},a.extraParameters.telemetry=k.V8.MATS_TELEMETRY,e.authenticationScheme===g.IO.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},r=new m.Q(this.browserCrypto);let i;if(a.keyId)i=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:a.keyId})),a.signPopToken=!1;else{const o=await(0,C.T)(r.generateCnf.bind(r),n.MX.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(t,this.logger);i=o.reqCnfString,a.keyId=o.kid,a.signPopToken=!0}a.reqCnf=i}return this.addRequestSKUs(a),a}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new w.H(t);return r.validateAsUri(),r}getPrompt(e){switch(this.apiId){case k.sA.ssoSilent:case k.sA.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),g._M.NONE}if(e)switch(e){case g._M.NONE:case g._M.CONSENT:case g._M.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),(0,T.bD)(P.nativePromptNotSupported)}else this.logger.trace("initializeNativeRequest: prompt was not provided")}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(o.Uu)&&e.extraParameters.hasOwnProperty(o.Mt)&&e.extraParameters.hasOwnProperty(o.U6);if(!e.embeddedClientId&&!t)return;let r="";const i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[o.Mt],r=e.extraParameters[o.U6]),e.extraParameters={child_client_id:r,child_redirect_uri:i},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:i},e.correlationId)}}},205090:(e,t,r)=>{r.r(t),r.d(t,{BrowserPerformanceMeasurement:()=>i});class i{constructor(e,t){this.correlationId=t,this.measureName=i.makeMeasureName(e,t),this.startMark=i.makeStartMark(e,t),this.endMark=i.makeEndMark(e,t)}static makeMeasureName(e,t){return`msal.measure.${e}.${t}`}static makeStartMark(e,t){return`msal.start.${e}.${t}`}static makeEndMark(e,t){return`msal.end.${e}.${t}`}static supportsBrowserPerformance(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.mark&&"function"==typeof window.performance.measure&&"function"==typeof window.performance.clearMarks&&"function"==typeof window.performance.clearMeasures&&"function"==typeof window.performance.getEntriesByName}static flushMeasurements(e,t){if(i.supportsBrowserPerformance())try{t.forEach((t=>{const r=i.makeMeasureName(t.name,e);window.performance.getEntriesByName(r,"measure").length>0&&(window.performance.clearMeasures(r),window.performance.clearMarks(i.makeStartMark(r,e)),window.performance.clearMarks(i.makeEndMark(r,e)))}))}catch(e){}}startMeasurement(){if(i.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(e){}}endMeasurement(){if(i.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(e){}}flushMeasurement(){if(i.supportsBrowserPerformance())try{const e=window.performance.getEntriesByName(this.measureName,"measure");if(e.length>0){const t=e[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),t}}catch(e){}return null}}},207712:(e,t,r)=>{r.d(t,{UP:()=>s,bD:()=>l,jT:()=>c});var i=r(312982),o=r(570954);const n="For more visit: aka.ms/msaljs/browser-errors",a={[o.pkceNotCreated]:"The PKCE code challenge and verifier could not be generated.",[o.earJwkEmpty]:"No EAR encryption key provided. This is unexpected.",[o.earJweEmpty]:"Server response does not contain ear_jwe property. This is unexpected.",[o.cryptoNonExistent]:"The crypto object or function is not available.",[o.emptyNavigateUri]:"Navigation URI is empty. Please check stack trace for more info.",[o.hashEmptyError]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${n}`,[o.noStateInHash]:"Hash does not contain state. Please verify that the request originated from msal.",[o.hashDoesNotContainKnownProperties]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${n}`,[o.unableToParseState]:"Unable to parse state. Please verify that the request originated from msal.",[o.stateInteractionTypeMismatch]:"Hash contains state but the interaction type does not match the caller.",[o.interactionInProgress]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${n}`,[o.popupWindowError]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[o.emptyWindowError]:"window.open returned null or undefined window object.",[o.userCancelled]:"User cancelled the flow.",[o.monitorPopupTimeout]:`Token acquisition in popup failed due to timeout.  ${n}`,[o.monitorWindowTimeout]:`Token acquisition in iframe failed due to timeout.  ${n}`,[o.redirectInIframe]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[o.blockIframeReload]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${n}`,[o.blockNestedPopups]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[o.iframeClosedPrematurely]:"The iframe being monitored was closed prematurely.",[o.silentLogoutUnsupported]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[o.noAccountError]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[o.silentPromptValueError]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[o.noTokenRequestCacheError]:"No token request found in cache.",[o.unableToParseTokenRequestCacheError]:"The cached token request could not be parsed.",[o.authRequestNotSetError]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[o.invalidCacheType]:"Invalid cache type",[o.nonBrowserEnvironment]:"Login and token requests are not supported in non-browser environments.",[o.databaseNotOpen]:"Database is not open!",[o.noNetworkConnectivity]:"No network connectivity. Check your internet connection.",[o.postRequestFailed]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[o.getRequestFailed]:"Network request failed. Please check the network trace to determine root cause.",[o.failedToParseResponse]:"Failed to parse network response. Check network trace.",[o.unableToLoadToken]:"Error loading token to cache.",[o.cryptoKeyNotFound]:"Cryptographic Key or Keypair not found in browser storage.",[o.authCodeRequired]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[o.authCodeOrNativeAccountIdRequired]:"An authorization code or nativeAccountId must be provided to this flow.",[o.spaCodeAndNativeAccountIdPresent]:"Request cannot contain both spa code and native account id.",[o.databaseUnavailable]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[o.unableToAcquireTokenFromNativePlatform]:`Unable to acquire token from native platform.  ${n}`,[o.nativeHandshakeTimeout]:"Timed out while attempting to establish connection to browser extension",[o.nativeExtensionNotInstalled]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[o.nativeConnectionNotEstablished]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${n}`,[o.uninitializedPublicClientApplication]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${n}`,[o.nativePromptNotSupported]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[o.invalidBase64String]:"Invalid base64 encoded string.",[o.invalidPopTokenRequest]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[o.failedToBuildHeaders]:"Failed to build request headers object.",[o.failedToParseHeaders]:"Failed to parse response headers",[o.failedToDecryptEarResponse]:"Failed to decrypt ear response",[o.timedOut]:"The request timed out."},s={pkceNotGenerated:{code:o.pkceNotCreated,desc:a[o.pkceNotCreated]},cryptoDoesNotExist:{code:o.cryptoNonExistent,desc:a[o.cryptoNonExistent]},emptyNavigateUriError:{code:o.emptyNavigateUri,desc:a[o.emptyNavigateUri]},hashEmptyError:{code:o.hashEmptyError,desc:a[o.hashEmptyError]},hashDoesNotContainStateError:{code:o.noStateInHash,desc:a[o.noStateInHash]},hashDoesNotContainKnownPropertiesError:{code:o.hashDoesNotContainKnownProperties,desc:a[o.hashDoesNotContainKnownProperties]},unableToParseStateError:{code:o.unableToParseState,desc:a[o.unableToParseState]},stateInteractionTypeMismatchError:{code:o.stateInteractionTypeMismatch,desc:a[o.stateInteractionTypeMismatch]},interactionInProgress:{code:o.interactionInProgress,desc:a[o.interactionInProgress]},popupWindowError:{code:o.popupWindowError,desc:a[o.popupWindowError]},emptyWindowError:{code:o.emptyWindowError,desc:a[o.emptyWindowError]},userCancelledError:{code:o.userCancelled,desc:a[o.userCancelled]},monitorPopupTimeoutError:{code:o.monitorPopupTimeout,desc:a[o.monitorPopupTimeout]},monitorIframeTimeoutError:{code:o.monitorWindowTimeout,desc:a[o.monitorWindowTimeout]},redirectInIframeError:{code:o.redirectInIframe,desc:a[o.redirectInIframe]},blockTokenRequestsInHiddenIframeError:{code:o.blockIframeReload,desc:a[o.blockIframeReload]},blockAcquireTokenInPopupsError:{code:o.blockNestedPopups,desc:a[o.blockNestedPopups]},iframeClosedPrematurelyError:{code:o.iframeClosedPrematurely,desc:a[o.iframeClosedPrematurely]},silentLogoutUnsupportedError:{code:o.silentLogoutUnsupported,desc:a[o.silentLogoutUnsupported]},noAccountError:{code:o.noAccountError,desc:a[o.noAccountError]},silentPromptValueError:{code:o.silentPromptValueError,desc:a[o.silentPromptValueError]},noTokenRequestCacheError:{code:o.noTokenRequestCacheError,desc:a[o.noTokenRequestCacheError]},unableToParseTokenRequestCacheError:{code:o.unableToParseTokenRequestCacheError,desc:a[o.unableToParseTokenRequestCacheError]},authRequestNotSet:{code:o.authRequestNotSetError,desc:a[o.authRequestNotSetError]},invalidCacheType:{code:o.invalidCacheType,desc:a[o.invalidCacheType]},notInBrowserEnvironment:{code:o.nonBrowserEnvironment,desc:a[o.nonBrowserEnvironment]},databaseNotOpen:{code:o.databaseNotOpen,desc:a[o.databaseNotOpen]},noNetworkConnectivity:{code:o.noNetworkConnectivity,desc:a[o.noNetworkConnectivity]},postRequestFailed:{code:o.postRequestFailed,desc:a[o.postRequestFailed]},getRequestFailed:{code:o.getRequestFailed,desc:a[o.getRequestFailed]},failedToParseNetworkResponse:{code:o.failedToParseResponse,desc:a[o.failedToParseResponse]},unableToLoadTokenError:{code:o.unableToLoadToken,desc:a[o.unableToLoadToken]},signingKeyNotFoundInStorage:{code:o.cryptoKeyNotFound,desc:a[o.cryptoKeyNotFound]},authCodeRequired:{code:o.authCodeRequired,desc:a[o.authCodeRequired]},authCodeOrNativeAccountRequired:{code:o.authCodeOrNativeAccountIdRequired,desc:a[o.authCodeOrNativeAccountIdRequired]},spaCodeAndNativeAccountPresent:{code:o.spaCodeAndNativeAccountIdPresent,desc:a[o.spaCodeAndNativeAccountIdPresent]},databaseUnavailable:{code:o.databaseUnavailable,desc:a[o.databaseUnavailable]},unableToAcquireTokenFromNativePlatform:{code:o.unableToAcquireTokenFromNativePlatform,desc:a[o.unableToAcquireTokenFromNativePlatform]},nativeHandshakeTimeout:{code:o.nativeHandshakeTimeout,desc:a[o.nativeHandshakeTimeout]},nativeExtensionNotInstalled:{code:o.nativeExtensionNotInstalled,desc:a[o.nativeExtensionNotInstalled]},nativeConnectionNotEstablished:{code:o.nativeConnectionNotEstablished,desc:a[o.nativeConnectionNotEstablished]},uninitializedPublicClientApplication:{code:o.uninitializedPublicClientApplication,desc:a[o.uninitializedPublicClientApplication]},nativePromptNotSupported:{code:o.nativePromptNotSupported,desc:a[o.nativePromptNotSupported]},invalidBase64StringError:{code:o.invalidBase64String,desc:a[o.invalidBase64String]},invalidPopTokenRequest:{code:o.invalidPopTokenRequest,desc:a[o.invalidPopTokenRequest]}};class c extends i.lR{constructor(e,t){super(e,a[e],t),Object.setPrototypeOf(this,c.prototype),this.name="BrowserAuthError"}}function l(e,t){return new c(e,t)}},220901:(e,t,r)=>{if(r.d(t,{N:()=>h,v:()=>d}),"cloudFilePickerDialog"!=r.j)var i=r(285868);if("cloudFilePickerDialog"!=r.j)var o=r(593744);if("cloudFilePickerDialog"!=r.j)var n=r(662443);if("cloudFilePickerDialog"!=r.j)var a=r(285683);if("cloudFilePickerDialog"!=r.j)var s=r(364225);if("cloudFilePickerDialog"!=r.j)var c=r(162989);if("cloudFilePickerDialog"!=r.j)var l=r(279676);async function h(e,t,r,c){r.addQueueMeasurement(i.MX.InitializeBaseRequest,e.correlationId);const h=e.authority||t.auth.authority,d=[...e&&e.scopes||[]],u={...e,correlationId:e.correlationId,authority:h,scopes:d};if(u.authenticationScheme){if(u.authenticationScheme===o.IO.SSH){if(!e.sshJwk)throw(0,n.aD)(a.missingSshJwk);if(!e.sshKid)throw(0,n.aD)(a.missingSshKid)}c.verbose(`Authentication Scheme set to "${u.authenticationScheme}" as configured in Auth request`)}else u.authenticationScheme=o.IO.BEARER,c.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!s.$.isEmptyObj(e.claims)&&(u.requestedClaimsHash=await(0,l.YZ)(e.claims)),u}async function d(e,t,r,o,n){o.addQueueMeasurement(i.MX.InitializeSilentRequest,e.correlationId);const a=await(0,c.T)(h,i.MX.InitializeBaseRequest,n,o,e.correlationId)(e,r,o,n);return{...e,...a,account:t,forceRefresh:e.forceRefresh||!1}}},221678:(e,t,r)=>{if(r.d(t,{v:()=>m}),"cloudFilePickerDialog"!=r.j)var i=r(642059);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(162989);if("cloudFilePickerDialog"!=r.j)var a=r(142316);if("cloudFilePickerDialog"!=r.j)var s=r(593744);if("cloudFilePickerDialog"!=r.j)var c=r(403316);if("cloudFilePickerDialog"!=r.j)var l=r(765846);if("cloudFilePickerDialog"!=r.j)var h=r(585020);if("cloudFilePickerDialog"!=r.j)var d=r(556012);if("cloudFilePickerDialog"!=r.j)var u=r(887440);if("cloudFilePickerDialog"!=r.j)var g=r(279676);if("cloudFilePickerDialog"!=r.j)var p=r(220901);class m extends("cloudFilePickerDialog"!=r.j?l.x:null){initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||(0,g.Oy)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=i.H.getAbsoluteUrl(e.postLogoutRedirectUri,(0,u.getCurrentUri)())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=i.H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,(0,u.getCurrentUri)())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=i.H.getAbsoluteUrl((0,u.getCurrentUri)(),(0,u.getCurrentUri)())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(o.MX.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await(0,n.T)(this.getClientConfiguration.bind(this),o.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new a.m(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:c}=e;this.performanceClient.addQueueMeasurement(o.MX.StandardInteractionClientGetClientConfiguration,this.correlationId);const l=await(0,n.T)(this.getDiscoveredAuthority.bind(this),o.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:a,account:c}),u=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:l,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:u.loggerCallback,piiLoggingEnabled:u.piiLoggingEnabled,logLevel:u.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:h.Q1.MSAL_SKU,version:d.r,cpu:s.YM.EMPTY_STRING,os:s.YM.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(o.MX.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},a=c.W.setRequestState(this.browserCrypto,e&&e.state||s.YM.EMPTY_STRING,i),l={...await(0,n.T)(p.N,o.MX.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:a,nonce:e.nonce||(0,g.Oy)(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return l;const h=e.account||this.browserStorage.getActiveAccount(this.correlationId);return h&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${h.homeAccountId}`,this.correlationId),l.account=h),l}}},224003:(e,t,r)=>{if(r.d(t,{u:()=>n}),"cloudFilePickerDialog"!=r.j)var i=r(593130);if("cloudFilePickerDialog"!=r.j)var o=r(531292);class n{constructor(){if(!window.sessionStorage)throw(0,i.jz)(o.storageNotSupported)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}},236819:(e,t,r)=>{function i(e,t,r){const i=window.msal?.clientIds||[],o=i.length,n=i.filter((t=>t===e)).length;n>1&&r.warning("There is already an instance of MSAL.js in the window with the same client id."),t.add({msalInstanceCount:o,sameClientIdInstanceCount:n})}r.d(t,{n:()=>i})},268485:(e,t,r)=>{if(r.d(t,{An:()=>R,Bh:()=>S,HT:()=>E,kM:()=>b}),"cloudFilePickerDialog"!=r.j)var i=r(31371);if("cloudFilePickerDialog"!=r.j)var o=r(740278);if("cloudFilePickerDialog"!=r.j)var n=r(808484);if("cloudFilePickerDialog"!=r.j)var a=r(593744);if("cloudFilePickerDialog"!=r.j)var s=r(975030);if("cloudFilePickerDialog"!=r.j)var c=r(162989);if("cloudFilePickerDialog"!=r.j)var l=r(285868);if("cloudFilePickerDialog"!=r.j)var h=r(662443);if("cloudFilePickerDialog"!=r.j)var d=r(285683);if("cloudFilePickerDialog"!=r.j)var u=r(403316);if("cloudFilePickerDialog"!=r.j)var g=r(654790);if("cloudFilePickerDialog"!=r.j)var p=r(716936);if("cloudFilePickerDialog"!=r.j)var m=r(81877);if("cloudFilePickerDialog"!=r.j)var f=r(585020);if("cloudFilePickerDialog"!=r.j)var v=r(556012);if("cloudFilePickerDialog"!=r.j)var C=r(33544);if("cloudFilePickerDialog"!=r.j)var w=r(207712);if("cloudFilePickerDialog"!=r.j)var y=r(404705);if("cloudFilePickerDialog"!=r.j)var k=r(182150);if("cloudFilePickerDialog"!=r.j)var I=r(279676);if("cloudFilePickerDialog"!=r.j)var T=r(570954);async function A(e,t,r,h,d){const u=i._b({...e.auth,authority:t},r,h,d);if(o.RH(u,{sku:f.Q1.MSAL_SKU,version:v.r,os:"",cpu:""}),e.auth.protocolMode!==n.e.OIDC&&o.Ht(u,e.telemetry.application),r.platformBroker&&(o.KN(u),r.authenticationScheme===a.IO.POP)){const e=new C.M(h,d),t=new s.Q(e);let i;if(r.popKid)i=e.encodeKid(r.popKid);else{i=(await(0,c.T)(t.generateCnf.bind(t),l.MX.PopTokenGenerateCnf,h,d,r.correlationId)(r,h)).reqCnfString}o.Ux(u,i)}return o.PA(u,r.correlationId,d),u}async function b(e,t,r,n,s){if(!r.codeChallenge)throw(0,h.aD)(d.pkceParamsMissing);const u=await(0,c.T)(A,l.MX.GetStandardParams,n,s,r.correlationId)(e,t,r,n,s);return o.bq(u,a.RX.CODE),o.ie(u,r.codeChallenge,a.YM.S256_CODE_CHALLENGE_METHOD),o._H(u,r.extraQueryParameters||{}),i.Zz(t,u,e.auth.encodeExtraQueryParams,r.extraQueryParameters)}async function S(e,t,r,n,s,c){if(!n.earJwk)throw(0,w.bD)(T.earJwkEmpty);const l=await A(t,r,n,s,c);o.bq(l,a.RX.IDTOKEN_TOKEN_REFRESHTOKEN),o.GG(l,n.earJwk);const h=new Map;o._H(h,n.extraQueryParameters||{});return function(e,t,r){const i=e.createElement("form");return i.method="post",i.action=t,r.forEach(((t,r)=>{const o=e.createElement("input");o.hidden=!0,o.name=r,o.value=t,i.appendChild(o)})),e.body.appendChild(i),i}(e,i.Zz(r,h,t.auth.encodeExtraQueryParams,n.extraQueryParameters),l)}async function P(e,t,r,i,o,n,a,s,h,d){if(s.verbose("Account id found, calling WAM for token"),!d)throw(0,w.bD)(T.nativeConnectionNotEstablished);const g=new C.M(s,h),p=new k.Z(i,o,g,s,a,i.system.navigationClient,r,h,d,t,n,e.correlationId),{userRequestState:m}=u.W.parseRequestState(g,e.state);return(0,c.T)(p.acquireToken.bind(p),l.MX.NativeInteractionClientAcquireToken,s,h,e.correlationId)({...e,state:m,prompt:void 0})}async function E(e,t,r,i,o,n,a,s,h,d,u,p){if(g.H.removeThrottle(a,o.auth.clientId,e),t.accountId)return(0,c.T)(P,l.MX.HandleResponsePlatformBroker,d,u,e.correlationId)(e,t.accountId,i,o,a,s,h,d,u,p);const m={...e,code:t.code||"",codeVerifier:r},f=new y.l(n,a,m,d,u);return await(0,c.T)(f.handleCodeResponse.bind(f),l.MX.HandleCodeResponse,d,u,e.correlationId)(t,e)}async function R(e,t,r,o,n,a,s,h,d,u,f){if(g.H.removeThrottle(a,o.auth.clientId,e),i.VR(t,e.state),!t.ear_jwe)throw(0,w.bD)(T.earJweEmpty);if(!e.earJwk)throw(0,w.bD)(T.earJwkEmpty);const v=JSON.parse(await(0,c.T)(I.TR,l.MX.DecryptEarResponse,d,u,e.correlationId)(e.earJwk,t.ear_jwe));if(v.accountId)return(0,c.T)(P,l.MX.HandleResponsePlatformBroker,d,u,e.correlationId)(e,v.accountId,r,o,a,s,h,d,u,f);const y=new p.w(o.auth.clientId,a,new C.M(d,u),d,null,null,u);y.validateTokenResponse(v);const k={code:"",state:e.state,nonce:e.nonce,client_info:v.client_info,cloud_graph_host_name:v.cloud_graph_host_name,cloud_instance_host_name:v.cloud_instance_host_name,cloud_instance_name:v.cloud_instance_name,msgraph_host:v.msgraph_host};return await(0,c.T)(y.handleServerTokenResponse.bind(y),l.MX.HandleServerTokenResponse,d,u,e.correlationId)(v,n,m._C(),e,k,void 0,void 0,void 0,void 0)}},279676:(e,t,r)=>{if(r.d(t,{DP:()=>M,Oy:()=>b,RI:()=>P,RW:()=>k,TR:()=>N,TZ:()=>S,UY:()=>T,W6:()=>E,YZ:()=>U,Yc:()=>D,_S:()=>R,lg:()=>q,og:()=>_,sI:()=>I,w:()=>B}),"cloudFilePickerDialog"!=r.j)var i=r(207712);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(585020);if("cloudFilePickerDialog"!=r.j)var a=r(931553);if("cloudFilePickerDialog"!=r.j)var s=r(666637);if("cloudFilePickerDialog"!=r.j)var c=r(570954);const l="AES-GCM",h="HKDF",d="SHA-256",u=new Uint8Array([1,0,1]),g="0123456789abcdef",p=new Uint32Array(1),m="raw",f="encrypt",v="decrypt",C="deriveKey",w="crypto_subtle_undefined",y={name:"RSASSA-PKCS1-v1_5",hash:d,modulusLength:2048,publicExponent:u};function k(e){if(!window)throw(0,i.bD)(c.nonBrowserEnvironment);if(!window.crypto)throw(0,i.bD)(c.cryptoNonExistent);if(!e&&!window.crypto.subtle)throw(0,i.bD)(c.cryptoNonExistent,w)}async function I(e,t,r){t?.addQueueMeasurement(o.MX.Sha256Digest,r);const i=(new TextEncoder).encode(e);return window.crypto.subtle.digest(d,i)}function T(e){return window.crypto.getRandomValues(e)}function A(){return window.crypto.getRandomValues(p),p[0]}function b(){const e=Date.now(),t=1024*A()+(1023&A()),r=new Uint8Array(16),i=Math.trunc(t/2**30),o=t&2**30-1,n=A();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|i>>>8,r[7]=i,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=n>>>24,r[13]=n>>>16,r[14]=n>>>8,r[15]=n;let a="";for(let e=0;e<r.length;e++)a+=g.charAt(r[e]>>>4),a+=g.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(a+="-");return a}async function S(e,t){return window.crypto.subtle.generateKey(y,e,t)}async function P(e){return window.crypto.subtle.exportKey(n.jb,e)}async function E(e,t,r){return window.crypto.subtle.importKey(n.jb,e,y,t,r)}async function R(e,t){return window.crypto.subtle.sign(y,e,t)}async function M(){const e=await _(),t={alg:"dir",kty:"oct",k:(0,a.dB)(new Uint8Array(e))};return(0,a.KA)(JSON.stringify(t))}async function N(e,t){const r=t.split(".");if(5!==r.length)throw(0,i.bD)(c.failedToDecryptEarResponse,"jwe_length");const o=await async function(e){const t=(0,s.u)(e),r=JSON.parse(t).k,i=(0,s.C)(r);return window.crypto.subtle.importKey(m,i,l,!1,[v])}(e).catch((()=>{throw(0,i.bD)(c.failedToDecryptEarResponse,"import_key")}));try{const e=(new TextEncoder).encode(r[0]),t=(0,s.C)(r[2]),i=(0,s.C)(r[3]),n=(0,s.C)(r[4]),a=8*n.byteLength,c=new Uint8Array(i.length+n.length);c.set(i),c.set(n,i.length);const h=await window.crypto.subtle.decrypt({name:l,iv:t,tagLength:a,additionalData:e},o,c);return(new TextDecoder).decode(h)}catch(e){throw(0,i.bD)(c.failedToDecryptEarResponse,"decrypt")}}async function _(){const e=await window.crypto.subtle.generateKey({name:l,length:256},!0,[f,v]);return window.crypto.subtle.exportKey(m,e)}async function q(e){return window.crypto.subtle.importKey(m,e,h,!1,[C])}async function O(e,t,r){return window.crypto.subtle.deriveKey({name:h,salt:t,hash:d,info:(new TextEncoder).encode(r)},e,{name:l,length:256},!1,[f,v])}async function B(e,t,r){const i=(new TextEncoder).encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),n=await O(e,o,r),s=await window.crypto.subtle.encrypt({name:l,iv:new Uint8Array(12)},n,i);return{data:(0,a.dB)(new Uint8Array(s)),nonce:(0,a.dB)(o)}}async function D(e,t,r,i){const o=(0,s.C)(i),n=await O(e,(0,s.C)(t),r),a=await window.crypto.subtle.decrypt({name:l,iv:new Uint8Array(12)},n,o);return(new TextDecoder).decode(a)}async function U(e){const t=await I(e),r=new Uint8Array(t);return(0,a.dB)(r)}},284613:(e,t,r)=>{if(r.d(t,{l:()=>w}),"cloudFilePickerDialog"!=r.j)var i=r(275967);if("cloudFilePickerDialog"!=r.j)var o=r(358794);if("cloudFilePickerDialog"!=r.j)var n=r(285868);if("cloudFilePickerDialog"!=r.j)var a=r(81877);if("cloudFilePickerDialog"!=r.j)var s=r(312982);if("cloudFilePickerDialog"!=r.j)var c=r(593744);if("cloudFilePickerDialog"!=r.j)var l=r(525630);if("cloudFilePickerDialog"!=r.j)var h=r(585020);if("cloudFilePickerDialog"!=r.j)var d=r(33544);if("cloudFilePickerDialog"!=r.j)var u=r(918062);if("cloudFilePickerDialog"!=r.j)var g=r(684130);if("cloudFilePickerDialog"!=r.j)var p=r(642026);if("cloudFilePickerDialog"!=r.j)var m=r(494030);if("cloudFilePickerDialog"!=r.j)var f=r(453275);if("cloudFilePickerDialog"!=r.j)var v=r(318030);if("cloudFilePickerDialog"!=r.j)var C=r(279676);class w{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new d.M(this.logger,this.performanceClient,!0):i.j,this.eventHandler=new p.J(this.logger),this.browserStorage=this.operatingContext.isBrowserEnvironment()?new f.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,(0,o.aw)(this.config.auth)):(0,f.E)(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler),this.nestedAppAuthAdapter=new u.G(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);const r=this.bridgeProxy.getAccountContext();this.currentAccountContext=r||null}static async createController(e){const t=new w(e);return Promise.resolve(t)}async initialize(e,t){const r=e?.correlationId||(0,C.Oy)();return await this.browserStorage.initialize(r),Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_START,h.X8.Popup,t);const r=this.performanceClient.startMeasurement(n.MX.AcquireTokenPopup,t.correlationId);r?.add({nestedAppAuthRequest:!0});try{const i=this.nestedAppAuthAdapter.toNaaTokenRequest(t),o=a._C(),n=await this.bridgeProxy.getTokenInteractive(i),s={...this.nestedAppAuthAdapter.fromNaaTokenResponse(i,n,o)};return await this.hydrateCache(s,e),this.currentAccountContext={homeAccountId:s.account.homeAccountId,environment:s.account.environment,tenantId:s.account.tenantId},this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_SUCCESS,h.X8.Popup,s),r.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),r.end({success:!0,requestId:s.requestId}),s}catch(e){const t=e instanceof s.lR?e:this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_FAILURE,h.X8.Popup,null,e),r.end({success:!1},e),t}}async acquireTokenSilentInternal(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_START,h.X8.Silent,t);const r=await this.acquireTokenFromCache(t);if(r)return this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_SUCCESS,h.X8.Silent,r),r;const i=this.performanceClient.startMeasurement(n.MX.SsoSilent,t.correlationId);i?.increment({visibilityChangeCount:0}),i?.add({nestedAppAuthRequest:!0});try{const r=this.nestedAppAuthAdapter.toNaaTokenRequest(t),o=a._C(),n=await this.bridgeProxy.getTokenSilent(r),s=this.nestedAppAuthAdapter.fromNaaTokenResponse(r,n,o);return await this.hydrateCache(s,e),this.currentAccountContext={homeAccountId:s.account.homeAccountId,environment:s.account.environment,tenantId:s.account.tenantId},this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_SUCCESS,h.X8.Silent,s),i?.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),i?.end({success:!0,requestId:s.requestId}),s}catch(e){const t=e instanceof s.lR?e:this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_FAILURE,h.X8.Silent,null,e),i?.end({success:!1},e),t}}async acquireTokenFromCache(e){const t=this.performanceClient.startMeasurement(n.MX.AcquireTokenSilent,e.correlationId);if(t?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("Claims are present in the request, skipping cache lookup"),null;if(e.forceRefresh)return this.logger.verbose("forceRefresh is set to true, skipping cache lookup"),null;let r=null;switch(e.cacheLookupPolicy||(e.cacheLookupPolicy=h.nN.Default),e.cacheLookupPolicy){case h.nN.Default:case h.nN.AccessToken:case h.nN.AccessTokenAndRefreshToken:r=await this.acquireTokenFromCacheInternal(e);break;default:return null}return r?(this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_SUCCESS,h.X8.Silent,r),t?.add({accessTokenSize:r?.accessToken.length,idTokenSize:r?.idToken.length}),t?.end({success:!0}),r):(this.logger.warning("Cached tokens are not found for the account, proceeding with silent token request."),this.eventHandler.emitEvent(m.B.ACQUIRE_TOKEN_FAILURE,h.X8.Silent,null),t?.end({success:!1}),null)}async acquireTokenFromCacheInternal(e){const t=this.bridgeProxy.getAccountContext()||this.currentAccountContext;let r=null;const i=e.correlationId||this.browserCrypto.createNewGuid();if(t&&(r=(0,v.sU)(t,this.logger,this.browserStorage,i)),!r)return this.logger.verbose("No active account found, falling back to the host"),Promise.resolve(null);this.logger.verbose("active account found, attempting to acquire token silently");const o={...e,correlationId:e.correlationId||this.browserCrypto.createNewGuid(),authority:e.authority||r.environment,scopes:e.scopes?.length?e.scopes:[...c.aZ]},n=this.browserStorage.getTokenKeys(),s=this.browserStorage.getAccessToken(r,o,n,r.tenantId);if(!s)return this.logger.verbose("No cached access token found"),Promise.resolve(null);if(a.XJ(s.cachedAt)||a.Hm(s.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("Cached access token has expired"),Promise.resolve(null);const l=this.browserStorage.getIdToken(r,o.correlationId,n,r.tenantId,this.performanceClient);return l?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(r,l,s,o,o.correlationId):(this.logger.verbose("No cached id token found"),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw g.B.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw g.B.createUnsupportedError()}acquireTokenNative(e,t,r){throw g.B.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw g.B.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw g.B.createUnsupportedError()}removePerformanceCallback(e){throw g.B.createUnsupportedError()}enableAccountStorageEvents(){throw g.B.createUnsupportedError()}disableAccountStorageEvents(){throw g.B.createUnsupportedError()}getAllAccounts(e){const t=this.browserCrypto.createNewGuid();return(0,v.Is)(this.logger,this.browserStorage,this.isBrowserEnv(),t,e)}getAccount(e){const t=this.browserCrypto.createNewGuid();return(0,v.sU)(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.browserCrypto.createNewGuid();return(0,v.hN)(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.browserCrypto.createNewGuid();return(0,v.PX)(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.browserCrypto.createNewGuid();return(0,v.P6)(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.browserCrypto.createNewGuid();return(0,v.I$)(e,this.browserStorage,t)}getActiveAccount(){const e=this.browserCrypto.createNewGuid();return(0,v.yq)(this.browserStorage,e)}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||h.uq)}loginRedirect(e){throw g.B.createUnsupportedError()}logout(e){throw g.B.createUnsupportedError()}logoutRedirect(e){throw g.B.createUnsupportedError()}logoutPopup(e){throw g.B.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw g.B.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw g.B.createUnsupportedError()}getRedirectResponse(){throw g.B.createUnsupportedError()}async clearCache(e){throw g.B.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=l.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId),this.browserStorage.hydrateCache(e,t)}}},296413:(e,t,r)=>{r.r(t),r.d(t,{BrowserPerformanceMeasurement:()=>i});class i{constructor(e,t){this.correlationId=t,this.measureName=i.makeMeasureName(e,t),this.startMark=i.makeStartMark(e,t),this.endMark=i.makeEndMark(e,t)}static makeMeasureName(e,t){return`msal.measure.${e}.${t}`}static makeStartMark(e,t){return`msal.start.${e}.${t}`}static makeEndMark(e,t){return`msal.end.${e}.${t}`}static supportsBrowserPerformance(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.mark&&"function"==typeof window.performance.measure&&"function"==typeof window.performance.clearMarks&&"function"==typeof window.performance.clearMeasures&&"function"==typeof window.performance.getEntriesByName}static flushMeasurements(e,t){if(i.supportsBrowserPerformance())try{t.forEach((t=>{const r=i.makeMeasureName(t.name,e);window.performance.getEntriesByName(r,"measure").length>0&&(window.performance.clearMeasures(r),window.performance.clearMarks(i.makeStartMark(r,e)),window.performance.clearMarks(i.makeEndMark(r,e)))}))}catch(e){}}startMeasurement(){if(i.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(e){}}endMeasurement(){if(i.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(e){}}flushMeasurement(){if(i.supportsBrowserPerformance())try{const e=window.performance.getEntriesByName(this.measureName,"measure");if(e.length>0){const t=e[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),t}}catch(e){}return null}}},318030:(e,t,r)=>{function i(e,t,r,i,o){return e.verbose("getAllAccounts called"),r?t.getAllAccounts(o||{},i):[]}function o(e,t,r,i){if(t.trace("getAccount called"),0===Object.keys(e).length)return t.warning("getAccount: No accountFilter provided"),null;const o=r.getAccountInfoFilteredBy(e,i);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}function n(e,t,r,i){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;const o=r.getAccountInfoFilteredBy({username:e},i);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}function a(e,t,r,i){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=r.getAccountInfoFilteredBy({homeAccountId:e},i);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function s(e,t,r,i){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;const o=r.getAccountInfoFilteredBy({localAccountId:e},i);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function c(e,t,r){t.setActiveAccount(e,r)}function l(e,t){return e.getActiveAccount(t)}r.d(t,{I$:()=>c,Is:()=>i,P6:()=>s,PX:()=>a,hN:()=>n,sU:()=>o,yq:()=>l})},336625:(e,t,r)=>{if(r.d(t,{c:()=>n}),"cloudFilePickerDialog"!=r.j)var i=r(207712);if("cloudFilePickerDialog"!=r.j)var o=r(570954);class n{navigateInternal(e,t){return n.defaultNavigateWindow(e,t)}navigateExternal(e,t){return n.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(((e,r)=>{setTimeout((()=>{r((0,i.bD)(o.timedOut,"failed_to_redirect"))}),t.timeout)}))}}},347780:(e,t,r)=>{if(r.d(t,{d:()=>h}),"cloudFilePickerDialog"!=r.j)var i=r(221678);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(162989);if("cloudFilePickerDialog"!=r.j)var a=r(969911);if("cloudFilePickerDialog"!=r.j)var s=r(585020);if("cloudFilePickerDialog"!=r.j)var c=r(207712);if("cloudFilePickerDialog"!=r.j)var l=r(570954);class h extends("cloudFilePickerDialog"!=r.j?i.v:null){async acquireToken(e){this.performanceClient.addQueueMeasurement(o.MX.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(s.sA.acquireTokenSilent_silentFlow),r=await(0,n.T)(this.getClientConfiguration.bind(this),o.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new a.t(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const t=(await(0,n.T)(i.acquireCachedToken.bind(i),o.MX.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof c.jT&&e.errorCode===l.cryptoKeyNotFound&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t?.account)}}},360871:(e,t,r)=>{if(r.d(t,{K:()=>s,d:()=>c}),"cloudFilePickerDialog"!=r.j)var i=r(732316);if("cloudFilePickerDialog"!=r.j)var o=r(34467);if("cloudFilePickerDialog"!=r.j)var n=r(941504);if("cloudFilePickerDialog"!=r.j)var a=r(284613);async function s(e,t){const r=new o.A(e);return await r.initialize(),n.i.createController(r,t)}async function c(e){const t=new o.A(e),r=new i.R(e),s=[t.initialize(),r.initialize()];return await Promise.all(s),r.isAvailable()&&e.auth.supportsNestedAppAuth?a.l.createController(r):t.isAvailable()?n.i.createController(t):null}},363073:(e,t,r)=>{r.d(t,{C:()=>y});var i=r(593744),o=r(162989),n=r(285868),a=r(808484),s=r(312982),c=r(642059),l=r(221678),h=r(494030),d=r(585020),u=r(887440),g=r(207712),p=r(453826),m=r(268485),f=r(474569),v=r(735198),C=r(279676),w=r(570954);class y extends l.v{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s,this.eventHandler=o}acquireToken(e,t){try{const r={popupName:this.generatePopupName(e.scopes||i.aZ,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r,t))}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("acquireTokenPopupAsync called");const i=await(0,o.T)(this.initializeAuthorizationRequest.bind(this),n.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,d.X8.Popup);t.popup&&(0,u.preconnect)(i.authority);const s=(0,v.O4)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return i.platformBroker=s,this.config.auth.protocolMode===a.e.EAR?this.executeEarFlow(i,t):this.executeCodeFlow(i,t,r)}async executeCodeFlow(e,t,r){const i=e.correlationId,a=this.initializeServerTelemetryManager(d.sA.acquireTokenPopup),c=r||await(0,o.T)(f.p,n.MX.GeneratePkceCodes,this.logger,this.performanceClient,i)(this.performanceClient,this.logger,i),l={...e,codeChallenge:c.challenge};try{const r=await(0,o.T)(this.createAuthCodeClient.bind(this),n.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,i)({serverTelemetryManager:a,requestAuthority:l.authority,requestAzureCloudOptions:l.azureCloudOptions,requestExtraQueryParameters:l.extraQueryParameters,account:l.account}),s=await(0,o.T)(m.kM,n.MX.GetAuthCodeUrl,this.logger,this.performanceClient,i)(this.config,r.authority,l,this.logger,this.performanceClient),u=this.initiateAuthRequest(s,t);this.eventHandler.emitEvent(h.B.POPUP_OPENED,d.X8.Popup,{popupWindow:u},null);const g=await this.monitorPopupForHash(u,t.popupWindowParent),f=(0,o.l)(p.L,n.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await(0,o.T)(m.HT,n.MX.HandleResponseCode,this.logger,this.performanceClient,i)(e,f,c.verifier,d.sA.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}catch(e){throw t.popup?.close(),e instanceof s.lR&&(e.setCorrelationId(this.correlationId),a.cacheFailedRequest(e)),e}}async executeEarFlow(e,t){const r=e.correlationId,i=await(0,o.T)(this.getDiscoveredAuthority.bind(this),n.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),a=await(0,o.T)(C.DP,n.MX.GenerateEarKey,this.logger,this.performanceClient,r)(),s={...e,earJwk:a},c=t.popup||this.openPopup("about:blank",t);(await(0,m.Bh)(c.document,this.config,i,s,this.logger,this.performanceClient)).submit();const l=await(0,o.T)(this.monitorPopupForHash.bind(this),n.MX.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,t.popupWindowParent),h=(0,o.l)(p.L,n.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return(0,o.T)(m.An,n.MX.HandleResponseEar,this.logger,this.performanceClient,r)(s,h,d.sA.acquireTokenPopup,this.config,i,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,i){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(h.B.LOGOUT_START,d.X8.Popup,e);const l=this.initializeServerTelemetryManager(d.sA.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const s=await(0,o.T)(this.createAuthCodeClient.bind(this),n.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:l,requestAuthority:r,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===a.e.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId,this.correlationId),this.eventHandler.emitEvent(h.B.LOGOUT_SUCCESS,d.X8.Popup,e),i){const e={apiId:d.sA.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=c.H.getAbsoluteUrl(i,(0,u.getCurrentUri)());await this.navigationClient.navigateInternal(t,e)}return void t.popup?.close()}}const g=s.getLogoutUri(e);this.eventHandler.emitEvent(h.B.LOGOUT_SUCCESS,d.X8.Popup,e);const p=this.openPopup(g,t);if(this.eventHandler.emitEvent(h.B.POPUP_OPENED,d.X8.Popup,{popupWindow:p},null),await this.monitorPopupForHash(p,t.popupWindowParent).catch((()=>{})),i){const e={apiId:d.sA.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=c.H.getAbsoluteUrl(i,(0,u.getCurrentUri)());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw t.popup?.close(),e instanceof s.lR&&(e.setCorrelationId(this.correlationId),l.cacheFailedRequest(e)),this.eventHandler.emitEvent(h.B.LOGOUT_FAILURE,d.X8.Popup,null,e),this.eventHandler.emitEvent(h.B.LOGOUT_END,d.X8.Popup),e}this.eventHandler.emitEvent(h.B.LOGOUT_END,d.X8.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,g.bD)(w.emptyNavigateUri)}monitorPopupForHash(e,t){return new Promise(((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval((()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),void r((0,g.bD)(w.userCancelled));let n="";try{n=e.location.href}catch(e){}if(!n||"about:blank"===n)return;clearInterval(o);let a="";const s=this.config.auth.OIDCOptions.serverResponseType;e&&(a=s===i.zL.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(a)}),this.config.system.pollIntervalMilliseconds)})).finally((()=>{this.cleanPopup(e,t)}))}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw(0,g.bD)(w.emptyWindowError);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),(0,g.bD)(w.popupWindowError)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){const o=i.screenLeft?i.screenLeft:i.screenX,n=i.screenTop?i.screenTop:i.screenY,a=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,l=r.popupSize?.height,h=r.popupPosition?.top,u=r.popupPosition?.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=d.Q1.POPUP_WIDTH),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=d.Q1.POPUP_HEIGHT),(!h||h<0||h>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,s/2-d.Q1.POPUP_HEIGHT/2+n)),(!u||u<0||u>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),u=Math.max(0,a/2-d.Q1.POPUP_WIDTH/2+o)),i.open(e,t,`width=${c}, height=${l}, top=${h}, left=${u}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${d.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${d.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}},381607:(e,t,r)=>{r.d(t,{u:()=>k});var i=r(162989),o=r(285868),n=r(808484),a=r(312982),s=r(593744),c=r(642059),l=r(874719),h=r(221678),d=r(585020),u=r(887440),g=r(494030),p=r(207712),m=r(453826),f=r(268485),v=r(474569),C=r(735198),w=r(279676),y=r(570954);class k extends h.v{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,a,c,l),this.nativeStorage=s}async acquireToken(e){const t=await(0,i.T)(this.initializeAuthorizationRequest.bind(this),o.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,d.X8.Redirect);t.platformBroker=(0,C.O4)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const r=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(g.B.RESTORE_FROM_BFCACHE,d.X8.Redirect))},s=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${s}`),this.browserStorage.setTemporaryCache(d._p.ORIGIN_URI,s,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===n.e.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(e){throw e instanceof a.lR&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),e}}async executeCodeFlow(e,t){const r=e.correlationId,n=this.initializeServerTelemetryManager(d.sA.acquireTokenRedirect),s=await(0,i.T)(v.p,o.MX.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),c={...e,codeChallenge:s.challenge};this.browserStorage.cacheAuthorizeRequest(c,s.verifier);try{const r=await(0,i.T)(this.createAuthCodeClient.bind(this),o.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:c.authority,requestAzureCloudOptions:c.azureCloudOptions,requestExtraQueryParameters:c.extraQueryParameters,account:c.account}),a=await(0,i.T)(f.kM,o.MX.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,r.authority,c,this.logger,this.performanceClient);return await this.initiateAuthRequest(a,t)}catch(e){throw e instanceof a.lR&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),e}}async executeEarFlow(e){const t=e.correlationId,r=await(0,i.T)(this.getDiscoveredAuthority.bind(this),o.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),n=await(0,i.T)(w.DP,o.MX.GenerateEarKey,this.logger,this.performanceClient,t)(),a={...e,earJwk:n};this.browserStorage.cacheAuthorizeRequest(a);return(await(0,f.Bh)(document,this.config,r,a,this.logger,this.performanceClient)).submit(),new Promise(((e,t)=>{setTimeout((()=>{t((0,p.bD)(y.timedOut,"failed_to_redirect"))}),this.config.system.redirectNavigationTimeout)}))}async handleRedirectPromise(e="",t,r,i){const o=this.initializeServerTelemetryManager(d.sA.handleRedirectPromise);try{const[n,a]=this.getRedirectResponse(e||"");if(!n)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?i.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const l=this.browserStorage.getTemporaryCache(d._p.ORIGIN_URI,!0)||s.YM.EMPTY_STRING,h=c.H.removeHashFromUrl(l);if(h===c.H.removeHashFromUrl(window.location.href)&&this.config.auth.navigateToLoginRequestUrl){this.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&(0,u.replaceHash)(l);return await this.handleResponse(n,t,r,o)}if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(n,t,r,o);if(!(0,u.isInIframe)()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(d._p.URL_HASH,a,!0);const e={apiId:d.sA.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let i=!0;if(l&&"null"!==l)this.logger.verbose(`Navigating to loginRequestUrl: ${l}`),i=await this.navigationClient.navigateInternal(l,e);else{const t=(0,u.getHomepage)();this.browserStorage.setTemporaryCache(d._p.ORIGIN_URI,t,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),i=await this.navigationClient.navigateInternal(t,e)}if(!i)return await this.handleResponse(n,t,r,o)}return null}catch(e){throw e instanceof a.lR&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===s.zL.QUERY?window.location.search:window.location.hash);let r=l.nV(t);if(r){try{(0,m.j)(r,this.browserCrypto,d.X8.Redirect)}catch(e){return e instanceof a.lR&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return(0,u.clearHash)(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(d._p.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(d._p.URL_HASH)),i&&(r=l.nV(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t,r,n){if(!e.state)throw(0,p.bD)(y.noStateInHash);if(e.ear_jwe){const r=await(0,i.T)(this.getDiscoveredAuthority.bind(this),o.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return(0,i.T)(f.An,o.MX.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,d.sA.acquireTokenRedirect,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const a=await(0,i.T)(this.createAuthCodeClient.bind(this),o.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority});return(0,i.T)(f.HT,o.MX.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,d.sA.acquireTokenRedirect,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:d.sA.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=t||this.config.auth.onRedirectNavigate;if("function"==typeof i){this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback");return!1!==i(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await this.navigationClient.navigateExternal(e,r)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")}return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await this.navigationClient.navigateExternal(e,r)}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,p.bD)(y.emptyNavigateUri)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(d.sA.logout);try{this.eventHandler.emitEvent(g.B.LOGOUT_START,d.X8.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const a={apiId:d.sA.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=await(0,i.T)(this.createAuthCodeClient.bind(this),o.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(s.authority.protocolMode===n.e.OIDC)try{s.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return this.browserStorage.removeAccount(t.account?.homeAccountId,this.correlationId),void this.eventHandler.emitEvent(g.B.LOGOUT_SUCCESS,d.X8.Redirect,t)}const c=s.getLogoutUri(t);if(this.eventHandler.emitEvent(g.B.LOGOUT_SUCCESS,d.X8.Redirect,t),!e||"function"!=typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,d.O2.SIGNOUT),void await this.navigationClient.navigateExternal(c,a);if(!1!==e.onRedirectNavigate(c))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,d.O2.SIGNOUT),void await this.navigationClient.navigateExternal(c,a);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof a.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(g.B.LOGOUT_FAILURE,d.X8.Redirect,null,e),this.eventHandler.emitEvent(g.B.LOGOUT_END,d.X8.Redirect),e}this.eventHandler.emitEvent(g.B.LOGOUT_END,d.X8.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return c.H.getAbsoluteUrl(t,(0,u.getCurrentUri)())}}},388e3:(e,t,r)=>{r.d(t,{X:()=>i});class i{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach(((t,r)=>{e.push(r)})),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}},404705:(e,t,r)=>{if(r.d(t,{l:()=>h}),"cloudFilePickerDialog"!=r.j)var i=r(285868);if("cloudFilePickerDialog"!=r.j)var o=r(31371);if("cloudFilePickerDialog"!=r.j)var n=r(949575);if("cloudFilePickerDialog"!=r.j)var a=r(162989);if("cloudFilePickerDialog"!=r.j)var s=r(687323);if("cloudFilePickerDialog"!=r.j)var c=r(207712);if("cloudFilePickerDialog"!=r.j)var l=r(570954);class h{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async handleCodeResponse(e,t){let r;this.performanceClient.addQueueMeasurement(i.MX.HandleCodeResponse,t.correlationId);try{r=o.TB(e,t.state)}catch(e){throw e instanceof n.g&&e.subError===l.userCancelled?(0,c.bD)(l.userCancelled):e}return(0,a.T)(this.handleCodeResponseFromServer.bind(this),i.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(i.MX.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await(0,a.T)(this.authModule.updateAuthority.bind(this.authModule),i.MX.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await(0,a.T)(this.authModule.acquireToken.bind(this.authModule),i.MX.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:s.X.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:s.X.UPN}:null}}},441454:(e,t,r)=>{if(r.d(t,{V:()=>a}),"cloudFilePickerDialog"!=r.j)var i=r(207712);if("cloudFilePickerDialog"!=r.j)var o=r(585020);if("cloudFilePickerDialog"!=r.j)var n=r(570954);class a{constructor(){this.dbName=o.$u,this.version=o.G8,this.tableName=o.WJ,this.dbOpen=!1}async open(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(this.tableName)})),r.addEventListener("success",(t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()})),r.addEventListener("error",(()=>t((0,i.bD)(n.databaseUnavailable))))}))}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,i.bD)(n.databaseNotOpen));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(r.target.result)})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async setItem(e,t){return await this.validateDbIsOpen(),new Promise(((r,o)=>{if(!this.db)return o((0,i.bD)(n.databaseNotOpen));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",(()=>{this.closeConnection(),r()})),a.addEventListener("error",(e=>{this.closeConnection(),o(e)}))}))}async removeItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,i.bD)(n.databaseNotOpen));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",(()=>{this.closeConnection(),t()})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async getKeys(){return await this.validateDbIsOpen(),new Promise(((e,t)=>{if(!this.db)return t((0,i.bD)(n.databaseNotOpen));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",(t=>{const r=t;this.closeConnection(),e(r.target.result)})),r.addEventListener("error",(e=>{this.closeConnection(),t(e)}))}))}async containsKey(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,i.bD)(n.databaseNotOpen));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(1===r.target.result)})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise(((e,t)=>{const r=window.indexedDB.deleteDatabase(o.$u),i=setTimeout((()=>t(!1)),200);r.addEventListener("success",(()=>(clearTimeout(i),e(!0)))),r.addEventListener("blocked",(()=>(clearTimeout(i),e(!0)))),r.addEventListener("error",(()=>(clearTimeout(i),t(!1))))}))}}},447851:(e,t,r)=>{r.d(t,{Em:()=>g,mr:()=>u,uz:()=>p});var i=r(312982);if("cloudFilePickerDialog"!=r.j)var o=r(535367);if("cloudFilePickerDialog"!=r.j)var n=r(933679);if("cloudFilePickerDialog"!=r.j)var a=r(207712);var s=r(841075);if("cloudFilePickerDialog"!=r.j)var c=r(460485);if("cloudFilePickerDialog"!=r.j)var l=r(570954);const h="cloudFilePickerDialog"!=r.j?-2147186943:null,d={[s.o]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class u extends i.lR{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,u.prototype),this.name="NativeAuthError",this.ext=r}}function g(e){return!(!e.ext||!e.ext.status||e.ext.status!==c.R&&e.ext.status!==c.F4)||(!(!e.ext||!e.ext.error||e.ext.error!==h)||e.errorCode===s.G)}function p(e,t,r){if(r&&r.status)switch(r.status){case c.tY:return(0,o.IE)(n.nativeAccountUnavailable);case c.Fz:return new o.CB(e,t);case c.f1:return(0,a.bD)(l.userCancelled);case c.T0:return(0,a.bD)(l.noNetworkConnectivity);case c.vj:return(0,o.IE)(n.uxNotAllowed)}return new u(e,d[e]||t,r)}},453275:(e,t,r)=>{r.d(t,{E:()=>R,c:()=>P});var i=r(19113),o=r(939698),n=r(945316),a=r(162989),s=r(285868),c=r(525630),l=r(128837),h=r(593744),d=r(81877),u=r(364225);if("cloudFilePickerDialog"!=r.j)var g=r(275967);var p=r(207712),m=r(585020),f=r(785292),v=r(224003),C=r(388e3),w=r(666637),y=r(931553),k=r(699465),I=r(498001),T=r(494030),A=r(887440),b=r(556012),S=r(570954);class P extends i.G{constructor(e,t,r,i,o,n,a){super(e,r,i,o,a),this.cacheConfig=t,this.logger=i,this.internalStorage=new C.X,this.browserStorage=E(e,t.cacheLocation,i,o),this.temporaryCacheStorage=E(e,t.temporaryCacheLocation,i,o),this.cookieStorage=new k.W6,this.eventHandler=n}async initialize(e){await this.browserStorage.initialize(e),this.trackVersionChanges(e)}trackVersionChanges(e){const t=this.browserStorage.getItem(m.dh.VERSION);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==b.r&&this.setItem(m.dh.VERSION,b.r,e)}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,r){let i=[];for(let a=0;a<=20;a++)try{this.browserStorage.setItem(e,t),a>0&&this.removeAccessTokenKeys(i.slice(0,a),r);break}catch(s){const c=(0,o.du)(s);if(!(c.errorCode===n.O&&a<20))throw c;if(i.length||(i=e===`${m.dh.TOKEN_KEYS}.${this.clientId}`?JSON.parse(t).accessToken:this.getTokenKeys().accessToken),i.length<=a)throw c;this.removeAccessToken(i[a],r,!1)}}async setUserData(e,t,r,i){let c=[];for(let l=0;l<=20;l++)try{await(0,a.T)(this.browserStorage.setUserData.bind(this.browserStorage),s.MX.SetUserData,this.logger,this.performanceClient)(e,t,r,i),l>0&&this.removeAccessTokenKeys(c.slice(0,l),r);break}catch(e){const t=(0,o.du)(e);if(!(t.errorCode===n.O&&l<20))throw t;if(c.length||(c=this.getTokenKeys().accessToken),c.length<=l)throw t;this.removeAccessToken(c[l],r,!1)}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const o=this.validateAndParseJson(r);return o&&c.d.isAccountEntity(o)?i.G.toObject(new c.d,o):null}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const r=e.generateAccountKey(),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.addAccountKeyToMap(r,t);this.cacheConfig.cacheLocation===m.Al.LocalStorage&&o&&this.eventHandler.emitEvent(T.B.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return(0,I.S)(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const r=this.getAccountKeys();return-1===r.indexOf(e)?(r.push(e),this.setItem(m.dh.ACCOUNT_KEYS,JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const r=this.getAccountKeys(),i=r.indexOf(e);if(i>-1){if(r.splice(i,1),0===r.length)return void this.removeItem(m.dh.ACCOUNT_KEYS);this.setItem(m.dh.ACCOUNT_KEYS,JSON.stringify(r),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){super.removeAccount(e,t),this.removeAccountKeyFromMap(e,t)}removeAccountContext(e,t){super.removeAccountContext(e,t),this.cacheConfig.cacheLocation===m.Al.LocalStorage&&this.eventHandler.emitEvent(T.B.ACCOUNT_REMOVED,void 0,e.getAccountInfo())}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),i=r.idToken.indexOf(e);i>-1&&(this.logger.info("idToken removed from tokenKeys map"),r.idToken.splice(i,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");const r=this.getTokenKeys();let i=0;if(e.forEach((e=>{const t=r.accessToken.indexOf(e);t>-1&&(r.accessToken.splice(t,1),i++)})),i>0)return this.logger.info(`removed ${i} accessToken keys from tokenKeys map`),void this.setTokenKeys(r,t)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),i=r.refreshToken.indexOf(e);i>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),r.refreshToken.splice(i,1),this.setTokenKeys(r,t))}getTokenKeys(){return(0,I.e)(this.clientId,this.browserStorage)}setTokenKeys(e,t){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(`${m.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(e),t):this.removeItem(`${m.dh.TOKEN_KEYS}.${this.clientId}`)}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const i=this.validateAndParseJson(r);return i&&l.Kx(i)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=l.og(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();-1===o.idToken.indexOf(r)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),o.idToken.push(r),this.setTokenKeys(o,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const i=this.validateAndParseJson(r);return i&&l.dj(i)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=l.og(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys(),n=o.accessToken.indexOf(r);-1!==n&&o.accessToken.splice(n,1),this.logger.trace(`access token ${-1===n?"added to":"updated in"} map`),o.accessToken.push(r),this.setTokenKeys(o,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const i=this.validateAndParseJson(r);return i&&l.WB(i)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),i):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=l.og(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();-1===o.refreshToken.indexOf(r)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),o.refreshToken.push(r),this.setTokenKeys(o,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&l.ki(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const r=l.JP(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&l.ur(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&l.ey(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter((e=>this.isAuthorityMetadata(e)))}setWrapperMetadata(e,t){this.internalStorage.setItem(m.H3.WRAPPER_SKU,e),this.internalStorage.setItem(m.H3.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(m.H3.WRAPPER_SKU)||h.YM.EMPTY_STRING,this.internalStorage.getItem(m.H3.WRAPPER_VER)||h.YM.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const i=this.validateAndParseJson(r);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,tenantId:i.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const r=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:d._C().toString()};this.setItem(r,JSON.stringify(i),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(T.B.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&l.r1(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.cookieStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===m.Al.LocalStorage){const e=this.browserStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach((e=>{-1===e.indexOf(h.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)})),this.browserStorage.getKeys().forEach((e=>{-1===e.indexOf(h.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)})),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(s.MX.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let r=0;t.accessToken.forEach((t=>{const i=this.getAccessTokenCredential(t,e);i?.requestedClaimsHash&&t.includes(i.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(t,e),r++)})),r>0&&this.logger.warning(`${r} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):u.$.startsWith(e,h.YM.CACHE_PREFIX)?e:`${h.YM.CACHE_PREFIX}.${this.clientId}.${e}`}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(m._p.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(m._p.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(m._p.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(m._p.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(m._p.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const r=(0,y.KA)(JSON.stringify(e));if(this.setTemporaryCache(m._p.REQUEST_PARAMS,r,!0),t){const e=(0,y.KA)(t);this.setTemporaryCache(m._p.VERIFIER,e,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(m._p.REQUEST_PARAMS,!0);if(!e)throw(0,p.bD)(S.noTokenRequestCacheError);const t=this.getTemporaryCache(m._p.VERIFIER,!0);let r,i="";try{r=JSON.parse((0,w.u)(e)),t&&(i=(0,w.u)(t))}catch(t){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${t}`),(0,p.bD)(S.unableToParseTokenRequestCacheError)}return[r,i]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(m._p.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${h.YM.CACHE_PREFIX}.${m._p.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),(0,A.clearHash)(window),null}}setInteractionInProgress(e,t=m.O2.SIGNIN){const r=`${h.YM.CACHE_PREFIX}.${m._p.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw(0,p.bD)(S.interactionInProgress);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1)}else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(r)}async hydrateCache(e,t){const r=l.c_(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const o={idToken:r,accessToken:l.Np(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?d.pK(e.expiresOn):0,e.extExpiresOn?d.pK(e.extExpiresOn):0,w.u,void 0,e.tokenType,void 0,t.sshKid,t.claims,i)};return this.saveCacheRecord(o,e.correlationId)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(e){if(e instanceof o.xA&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function E(e,t,r,i){try{switch(t){case m.Al.LocalStorage:return new f.D(e,r,i);case m.Al.SessionStorage:return new v.u;case m.Al.MemoryStorage:}}catch(e){r.error(e)}return new C.X}const R=(e,t,r,i)=>{const o={cacheLocation:m.Al.MemoryStorage,temporaryCacheLocation:m.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new P(e,o,g.j,t,r,i)}},453826:(e,t,r)=>{if(r.d(t,{L:()=>s,j:()=>c}),"cloudFilePickerDialog"!=r.j)var i=r(874719);if("cloudFilePickerDialog"!=r.j)var o=r(207712);if("cloudFilePickerDialog"!=r.j)var n=r(900360);if("cloudFilePickerDialog"!=r.j)var a=r(570954);function s(e,t,r){const n=i.nV(e);if(!n)throw i.Su(e)?(r.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),r.errorPii(`The ${t} detected is: ${e}`),(0,o.bD)(a.hashDoesNotContainKnownProperties)):(r.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,o.bD)(a.hashEmptyError));return n}function c(e,t,r){if(!e.state)throw(0,o.bD)(a.noStateInHash);const i=(0,n.A)(t,e.state);if(!i)throw(0,o.bD)(a.unableToParseState);if(i.interactionType!==r)throw(0,o.bD)(a.stateInteractionTypeMismatch)}},460485:(e,t,r)=>{r.d(t,{F4:()=>s,Fz:()=>i,R:()=>a,T0:()=>n,f1:()=>o,tY:()=>c,vj:()=>l});const i="USER_INTERACTION_REQUIRED",o="USER_CANCEL",n="NO_NETWORK",a="PERSISTENT_ERROR",s="DISABLED",c="ACCOUNT_UNAVAILABLE",l="UX_NOT_ALLOWED"},474569:(e,t,r)=>{if(r.d(t,{p:()=>h}),"cloudFilePickerDialog"!=r.j)var i=r(285868);if("cloudFilePickerDialog"!=r.j)var o=r(162989);if("cloudFilePickerDialog"!=r.j)var n=r(207712);if("cloudFilePickerDialog"!=r.j)var a=r(931553);if("cloudFilePickerDialog"!=r.j)var s=r(279676);if("cloudFilePickerDialog"!=r.j)var c=r(570954);const l=32;async function h(e,t,r){e.addQueueMeasurement(i.MX.GeneratePkceCodes,r);const n=(0,o.l)(d,i.MX.GenerateCodeVerifier,t,e,r)(e,t,r);return{verifier:n,challenge:await(0,o.T)(u,i.MX.GenerateCodeChallengeFromVerifier,t,e,r)(n,e,t,r)}}function d(e,t,r){try{const n=new Uint8Array(l);(0,o.l)(s.UY,i.MX.GetRandomValues,t,e,r)(n);return(0,a.dB)(n)}catch(e){throw(0,n.bD)(c.pkceNotCreated)}}async function u(e,t,r,l){t.addQueueMeasurement(i.MX.GenerateCodeChallengeFromVerifier,l);try{const n=await(0,o.T)(s.sI,i.MX.Sha256Digest,r,t,l)(e,t,l);return(0,a.dB)(new Uint8Array(n))}catch(e){throw(0,n.bD)(c.pkceNotCreated)}}},480968:(e,t,r)=>{r.d(t,{H:()=>i});const i={UserInteractionRequired:"USER_INTERACTION_REQUIRED",UserCancel:"USER_CANCEL",NoNetwork:"NO_NETWORK",TransientError:"TRANSIENT_ERROR",PersistentError:"PERSISTENT_ERROR",Disabled:"DISABLED",AccountUnavailable:"ACCOUNT_UNAVAILABLE",NestedAppAuthUnavailable:"NESTED_APP_AUTH_UNAVAILABLE"}},494030:(e,t,r)=>{r.d(t,{B:()=>i});const i={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"}},498001:(e,t,r)=>{if(r.d(t,{S:()=>o,e:()=>n}),"cloudFilePickerDialog"!=r.j)var i=r(585020);function o(e){const t=e.getItem(i.dh.ACCOUNT_KEYS);return t?JSON.parse(t):[]}function n(e,t){const r=t.getItem(`${i.dh.TOKEN_KEYS}.${e}`);if(r){const e=JSON.parse(r);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}},520134:(e,t,r)=>{r.d(t,{v:()=>o});var i=r(634651);class o extends i.A{getId(){return o.ID}getModuleName(){return o.MODULE_NAME}async initialize(){return!0}}o.MODULE_NAME="",o.ID="UnknownOperatingContext"},531292:(e,t,r)=>{r.r(t),r.d(t,{inMemRedirectUnavailable:()=>n,storageNotSupported:()=>i,stubbedPublicClientApplicationCalled:()=>o});const i="storage_not_supported",o="stubbed_public_client_application_called",n="in_mem_redirect_unavailable"},546987:(e,t,r)=>{if(r.d(t,{G:()=>p}),"cloudFilePickerDialog"!=r.j)var i=r(744212);if("cloudFilePickerDialog"!=r.j)var o=r(358794);if("cloudFilePickerDialog"!=r.j)var n=r(525630);if("cloudFilePickerDialog"!=r.j)var a=r(716936);if("cloudFilePickerDialog"!=r.j)var s=r(128837);if("cloudFilePickerDialog"!=r.j)var c=r(469829);if("cloudFilePickerDialog"!=r.j)var l=r(81877);if("cloudFilePickerDialog"!=r.j)var h=r(207712);if("cloudFilePickerDialog"!=r.j)var d=r(666637);if("cloudFilePickerDialog"!=r.j)var u=r(279676);if("cloudFilePickerDialog"!=r.j)var g=r(570954);class p{constructor(e,t,r,i){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}async loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw(0,h.bD)(g.nonBrowserEnvironment);const n=e.correlationId||(0,u.Oy)(),a=t.id_token?i.My(t.id_token,d.u):void 0,s={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new o.s4(o.s4.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,s,this.logger,e.correlationId||(0,u.Oy)()):void 0,l=await this.loadAccount(e,r.clientInfo||t.client_info||"",n,a,c),p=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,n),m=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,r,n),f=await this.loadRefreshToken(t,l.homeAccountId,l.environment,n);return this.generateAuthenticationResult(e,{account:l,idToken:p,accessToken:m,refreshToken:f},a,c)}async loadAccount(e,t,r,i,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const t=n.d.createFromAccountInfo(e.account);return await this.storage.setAccount(t,r),t}if(!o||!t&&!i)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),(0,h.bD)(g.unableToLoadToken);const s=n.d.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,i),c=i?.tid,l=(0,a.J)(this.storage,o,s,d.u,r,i,t,o.hostnameAndPort,c,void 0,void 0,this.logger);return await this.storage.setAccount(l,r),l}async loadIdToken(e,t,r,i,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const n=s.c_(t,r,e.id_token,this.config.auth.clientId,i);return await this.storage.setIdTokenCredential(n,o),n}async loadAccessToken(e,t,r,i,o,n,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const h=t.scope?c.l.fromString(t.scope):new c.l(e.scopes),u=n.expiresOn||t.expires_in+l._C(),g=n.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+l._C(),p=s.Np(r,i,t.access_token,this.config.auth.clientId,o,h.printScopes(),u,g,d.u);return await this.storage.setAccessTokenCredential(p,a),p}async loadRefreshToken(e,t,r,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=s.Mg(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(o,i),o}generateAuthenticationResult(e,t,r,i){let o,n="",a=[],s=null;t?.accessToken&&(n=t.accessToken.secret,a=c.l.fromString(t.accessToken.target).asArray(),s=l.dM(t.accessToken.expiresOn),o=l.dM(t.accessToken.extendedExpiresOn));const h=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:h.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:n,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:o,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:h.cloudGraphHostName||"",msGraphHost:h.msGraphHost||"",fromNativeBroker:!1}}}},551347:(e,t,r)=>{r.d(t,{a:()=>g});var i=r(162989),o=r(285868),n=r(312982),a=r(221678),s=r(207712),c=r(585020),l=r(142316);class h extends l.m{constructor(e){super(e),this.includeRedirectUri=!1}}var d=r(404705),u=r(570954);class g extends a.v{constructor(e,t,r,i,o,n,a,s,c,l){super(e,t,r,i,o,n,s,c,l),this.apiId=a}async acquireToken(e){if(!e.code)throw(0,s.bD)(u.authCodeRequired);const t=await(0,i.T)(this.initializeAuthorizationRequest.bind(this),o.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,c.X8.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const n={...t,code:e.code},a=await(0,i.T)(this.getClientConfiguration.bind(this),o.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new h(a);this.logger.verbose("Auth code client created");const c=new d.l(s,this.browserStorage,n,this.logger,this.performanceClient);return await(0,i.T)(c.handleCodeResponseFromServer.bind(c),o.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof n.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return Promise.reject((0,s.bD)(u.silentLogoutUnsupported))}}},556012:(e,t,r)=>{r.d(t,{U:()=>i,r:()=>o});const i="@azure/msal-browser",o="4.14.0"},570954:(e,t,r)=>{r.r(t),r.d(t,{authCodeOrNativeAccountIdRequired:()=>H,authCodeRequired:()=>F,authRequestNotSetError:()=>E,blockIframeReload:()=>y,blockNestedPopups:()=>k,cryptoKeyNotFound:()=>U,cryptoNonExistent:()=>a,databaseNotOpen:()=>N,databaseUnavailable:()=>x,earJweEmpty:()=>n,earJwkEmpty:()=>o,emptyNavigateUri:()=>s,emptyWindowError:()=>m,failedToBuildHeaders:()=>V,failedToDecryptEarResponse:()=>J,failedToParseHeaders:()=>Y,failedToParseResponse:()=>B,getRequestFailed:()=>O,hashDoesNotContainKnownProperties:()=>h,hashEmptyError:()=>c,iframeClosedPrematurely:()=>I,interactionInProgress:()=>g,invalidBase64String:()=>Q,invalidCacheType:()=>R,invalidPopTokenRequest:()=>W,monitorPopupTimeout:()=>v,monitorWindowTimeout:()=>C,nativeConnectionNotEstablished:()=>X,nativeExtensionNotInstalled:()=>z,nativeHandshakeTimeout:()=>K,nativePromptNotSupported:()=>G,noAccountError:()=>A,noNetworkConnectivity:()=>_,noStateInHash:()=>l,noTokenRequestCacheError:()=>S,nonBrowserEnvironment:()=>M,pkceNotCreated:()=>i,popupWindowError:()=>p,postRequestFailed:()=>q,redirectInIframe:()=>w,silentLogoutUnsupported:()=>T,silentPromptValueError:()=>b,spaCodeAndNativeAccountIdPresent:()=>L,stateInteractionTypeMismatch:()=>u,timedOut:()=>Z,unableToAcquireTokenFromNativePlatform:()=>j,unableToLoadToken:()=>D,unableToParseState:()=>d,unableToParseTokenRequestCacheError:()=>P,uninitializedPublicClientApplication:()=>$,userCancelled:()=>f});const i="pkce_not_created",o="ear_jwk_empty",n="ear_jwe_empty",a="crypto_nonexistent",s="empty_navigate_uri",c="hash_empty_error",l="no_state_in_hash",h="hash_does_not_contain_known_properties",d="unable_to_parse_state",u="state_interaction_type_mismatch",g="interaction_in_progress",p="popup_window_error",m="empty_window_error",f="user_cancelled",v="monitor_popup_timeout",C="monitor_window_timeout",w="redirect_in_iframe",y="block_iframe_reload",k="block_nested_popups",I="iframe_closed_prematurely",T="silent_logout_unsupported",A="no_account_error",b="silent_prompt_value_error",S="no_token_request_cache_error",P="unable_to_parse_token_request_cache_error",E="auth_request_not_set_error",R="invalid_cache_type",M="non_browser_environment",N="database_not_open",_="no_network_connectivity",q="post_request_failed",O="get_request_failed",B="failed_to_parse_response",D="unable_to_load_token",U="crypto_key_not_found",F="auth_code_required",H="auth_code_or_nativeAccountId_required",L="spa_code_and_nativeAccountId_present",x="database_unavailable",j="unable_to_acquire_token_from_native_platform",K="native_handshake_timeout",z="native_extension_not_installed",X="native_connection_not_established",$="uninitialized_public_client_application",G="native_prompt_not_supported",Q="invalid_base64_string",W="invalid_pop_token_request",V="failed_to_build_headers",Y="failed_to_parse_headers",J="failed_to_decrypt_ear_response",Z="timed_out"},574422:(e,t,r)=>{r.d(t,{K:()=>n});var i=r(593130),o=r(531292);const n={initialize:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),acquireTokenPopup:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),acquireTokenRedirect:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),acquireTokenSilent:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),acquireTokenByCode:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),loginPopup:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),loginRedirect:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),logout:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),logoutRedirect:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),logoutPopup:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),ssoSilent:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw(0,i.jz)(o.stubbedPublicClientApplicationCalled)},getLogger:()=>{throw(0,i.jz)(o.stubbedPublicClientApplicationCalled)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw(0,i.jz)(o.stubbedPublicClientApplicationCalled)},hydrateCache:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled)),clearCache:()=>Promise.reject((0,i.jz)(o.stubbedPublicClientApplicationCalled))}},585020:(e,t,r)=>{r.d(t,{$u:()=>w,Al:()=>s,CC:()=>c,Ct:()=>a,Fi:()=>S,G8:()=>y,H3:()=>u,JE:()=>T,L$:()=>A,MA:()=>P,O2:()=>l,P3:()=>b,Q1:()=>o,T$:()=>m,V8:()=>n,WJ:()=>k,X8:()=>p,_p:()=>h,dh:()=>d,f7:()=>C,jb:()=>v,nN:()=>I,sA:()=>g,uq:()=>f});var i=r(593744);const o={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},n={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},a={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},s={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},c={GET:"GET",POST:"POST"},l={SIGNIN:"signin",SIGNOUT:"signout"},h={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},d={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys",VERSION:"msal.version"},u={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},g={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var p;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(p||(p={}));const m={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},f={scopes:i.aZ},v="jwk",C={React:"@azure/msal-react",Angular:"@azure/msal-angular"},w="msal.db",y=1,k="cloudFilePickerDialog"!=r.j?`${w}.keys`:null,I={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},T=[I.Default,I.Skip,I.RefreshTokenAndNetwork],A="msal.browser.log.level",b="msal.browser.log.pii",S="msal.browser.performance.enabled",P="msal.browser.platform.auth.dom"},593130:(e,t,r)=>{r.d(t,{XX:()=>s,cl:()=>a,jz:()=>c});var i=r(312982),o=r(531292);const n={[o.storageNotSupported]:"Given storage configuration option was not supported.",[o.stubbedPublicClientApplicationCalled]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[o.inMemRedirectUnavailable]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},a={storageNotSupportedError:{code:o.storageNotSupported,desc:n[o.storageNotSupported]},stubPcaInstanceCalled:{code:o.stubbedPublicClientApplicationCalled,desc:n[o.stubbedPublicClientApplicationCalled]},inMemRedirectUnavailable:{code:o.inMemRedirectUnavailable,desc:n[o.inMemRedirectUnavailable]}};class s extends i.lR{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,s.prototype)}}function c(e){return new s(e,n[e])}},599807:(e,t,r)=>{if(r.r(t),r.d(t,{AccountEntity:()=>k.d,ApiId:()=>s.sA,AuthError:()=>I.lR,AuthErrorCodes:()=>T,AuthErrorMessage:()=>I.ej,AuthenticationHeaderParser:()=>A.H,AuthenticationScheme:()=>b.IO,AzureCloudInstance:()=>S._,BrowserAuthError:()=>c.jT,BrowserAuthErrorCodes:()=>j,BrowserAuthErrorMessage:()=>c.UP,BrowserCacheLocation:()=>s.Al,BrowserConfigurationAuthError:()=>l.XX,BrowserConfigurationAuthErrorCodes:()=>K,BrowserConfigurationAuthErrorMessage:()=>l.cl,BrowserPerformanceClient:()=>w.S,BrowserPerformanceMeasurement:()=>y.BrowserPerformanceMeasurement,BrowserUtils:()=>i,CacheLookupPolicy:()=>s.nN,ClientAuthError:()=>P.eB,ClientAuthErrorCodes:()=>E,ClientAuthErrorMessage:()=>P.NE,ClientConfigurationError:()=>R.q5,ClientConfigurationErrorCodes:()=>M,ClientConfigurationErrorMessage:()=>R.P7,DEFAULT_IFRAME_TIMEOUT_MS:()=>a.YH,EventHandler:()=>v.J,EventMessageUtils:()=>m.D,EventType:()=>f.B,InteractionRequiredAuthError:()=>N.CB,InteractionRequiredAuthErrorCodes:()=>_,InteractionRequiredAuthErrorMessage:()=>N.$D,InteractionStatus:()=>s.T$,InteractionType:()=>s.X8,JsonWebTokenTypes:()=>b.Lz,LocalStorage:()=>g.D,LogLevel:()=>q.$,Logger:()=>q.V,MemoryStorage:()=>u.X,NavigationClient:()=>d.c,OIDC_DEFAULT_SCOPES:()=>b.aZ,PerformanceEvents:()=>O.MX,PromptValue:()=>b._M,ProtocolMode:()=>B.e,PublicClientApplication:()=>o.vq,PublicClientNext:()=>n.Q,ServerError:()=>D.g,ServerResponseType:()=>b.zL,SessionStorage:()=>p.u,SignedHttpRequest:()=>C.a,StringUtils:()=>U.$,StubPerformanceClient:()=>F.a,UrlString:()=>H.H,WrapperSKU:()=>s.f7,createNestablePublicClientApplication:()=>o.Ji,createStandardPublicClientApplication:()=>o.q8,isPlatformBrokerAvailable:()=>x.gI,stubbedPublicClientApplication:()=>h.K,version:()=>L.r}),"cloudFilePickerDialog"!=r.j)var i=r(887440);if("cloudFilePickerDialog"!=r.j)var o=r(13943);if("cloudFilePickerDialog"!=r.j)var n=r(156024);if("cloudFilePickerDialog"!=r.j)var a=r(866520);if("cloudFilePickerDialog"!=r.j)var s=r(585020);if("cloudFilePickerDialog"!=r.j)var c=r(207712);if("cloudFilePickerDialog"!=r.j)var l=r(593130);if("cloudFilePickerDialog"!=r.j)var h=r(574422);if("cloudFilePickerDialog"!=r.j)var d=r(336625);if("cloudFilePickerDialog"!=r.j)var u=r(388e3);if("cloudFilePickerDialog"!=r.j)var g=r(785292);if("cloudFilePickerDialog"!=r.j)var p=r(224003);if("cloudFilePickerDialog"!=r.j)var m=r(180315);if("cloudFilePickerDialog"!=r.j)var f=r(494030);if("cloudFilePickerDialog"!=r.j)var v=r(642026);if("cloudFilePickerDialog"!=r.j)var C=r(745960);if("cloudFilePickerDialog"!=r.j)var w=r(12338);if("cloudFilePickerDialog"!=r.j)var y=r(296413);if("cloudFilePickerDialog"!=r.j)var k=r(525630);if("cloudFilePickerDialog"!=r.j)var I=r(312982);if("cloudFilePickerDialog"!=r.j)var T=r(505640);if("cloudFilePickerDialog"!=r.j)var A=r(545279);if("cloudFilePickerDialog"!=r.j)var b=r(593744);if("cloudFilePickerDialog"!=r.j)var S=r(637282);if("cloudFilePickerDialog"!=r.j)var P=r(310617);if("cloudFilePickerDialog"!=r.j)var E=r(206809);if("cloudFilePickerDialog"!=r.j)var R=r(662443);if("cloudFilePickerDialog"!=r.j)var M=r(285683);if("cloudFilePickerDialog"!=r.j)var N=r(535367);if("cloudFilePickerDialog"!=r.j)var _=r(933679);if("cloudFilePickerDialog"!=r.j)var q=r(466538);if("cloudFilePickerDialog"!=r.j)var O=r(285868);if("cloudFilePickerDialog"!=r.j)var B=r(808484);if("cloudFilePickerDialog"!=r.j)var D=r(949575);if("cloudFilePickerDialog"!=r.j)var U=r(364225);if("cloudFilePickerDialog"!=r.j)var F=r(739161);if("cloudFilePickerDialog"!=r.j)var H=r(642059);if("cloudFilePickerDialog"!=r.j)var L=r(556012);if("cloudFilePickerDialog"!=r.j)var x=r(735198);if("cloudFilePickerDialog"!=r.j)var j=r(570954);if("cloudFilePickerDialog"!=r.j)var K=r(531292)},634651:(e,t,r)=>{if(r.d(t,{A:()=>c}),"cloudFilePickerDialog"!=r.j)var i=r(466538);if("cloudFilePickerDialog"!=r.j)var o=r(866520);if("cloudFilePickerDialog"!=r.j)var n=r(556012);if("cloudFilePickerDialog"!=r.j)var a=r(585020);var s=r(758651);class c{static loggerCallback(e,t){switch(e){case i.$.Error:return void s.error(t);case i.$.Info:return void s.info(t);case i.$.Verbose:return void s.debug(t);case i.$.Warning:return void s.warn(t);default:return void s.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=(0,o.tD)(e,this.browserEnvironment);try{t=window[a.Al.SessionStorage]}catch(e){}const r=t?.getItem(a.L$),s=t?.getItem(a.P3)?.toLowerCase(),l="true"===s||"false"!==s&&void 0,h={...this.config.system.loggerOptions},d=r&&Object.keys(i.$).includes(r)?i.$[r]:void 0;d&&(h.loggerCallback=c.loggerCallback,h.logLevel=d),void 0!==l&&(h.piiLoggingEnabled=l),this.logger=new i.V(h,n.U,n.r),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}},638551:(e,t,r)=>{if(r.d(t,{O:()=>d}),"cloudFilePickerDialog"!=r.j)var i=r(221678);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(162989);if("cloudFilePickerDialog"!=r.j)var a=r(132432);if("cloudFilePickerDialog"!=r.j)var s=r(585020);if("cloudFilePickerDialog"!=r.j)var c=r(207712);if("cloudFilePickerDialog"!=r.j)var l=r(220901);if("cloudFilePickerDialog"!=r.j)var h=r(570954);class d extends("cloudFilePickerDialog"!=r.j?i.v:null){async acquireToken(e){this.performanceClient.addQueueMeasurement(o.MX.SilentRefreshClientAcquireToken,e.correlationId);const t=await(0,n.T)(l.N,o.MX.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(s.sA.acquireTokenSilent_silentFlow),a=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return(0,n.T)(a.acquireTokenByRefreshToken.bind(a),o.MX.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch((e=>{throw e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e),e}))}logout(){return Promise.reject((0,c.bD)(h.silentLogoutUnsupported))}async createRefreshTokenClient(e){const t=await(0,n.T)(this.getClientConfiguration.bind(this),o.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new a.O(t,this.performanceClient)}}},642026:(e,t,r)=>{if(r.d(t,{J:()=>a}),"cloudFilePickerDialog"!=r.j)var i=r(466538);if("cloudFilePickerDialog"!=r.j)var o=r(494030);if("cloudFilePickerDialog"!=r.j)var n=r(887440);class a{constructor(e){this.eventCallbacks=new Map,this.logger=e||new i.V({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if("undefined"!=typeof window){const i=r||(0,n.createGuid)();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){const n={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};switch(e){case o.B.ACCOUNT_ADDED:case o.B.ACCOUNT_REMOVED:case o.B.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(n);break;default:this.invokeCallbacks(n)}}invokeCallbacks(e){this.eventCallbacks.forEach((([t,r],i)=>{(0===r.length||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${i}: ${e.eventType}`),t.apply(null,[e]))}))}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}},666637:(e,t,r)=>{if(r.d(t,{C:()=>a,u:()=>n}),"cloudFilePickerDialog"!=r.j)var i=r(207712);if("cloudFilePickerDialog"!=r.j)var o=r(570954);function n(e){return(new TextDecoder).decode(a(e))}function a(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw(0,i.bD)(o.invalidBase64String)}const r=atob(t);return Uint8Array.from(r,(e=>e.codePointAt(0)||0))}},684130:(e,t,r)=>{r.d(t,{B:()=>n});var i=r(312982);const o={code:"unsupported_method",desc:"This method is not supported in nested app environment."};class n extends i.lR{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new n(o.code,o.desc)}}},699465:(e,t,r)=>{if(r.d(t,{W6:()=>s,WF:()=>a}),"cloudFilePickerDialog"!=r.j)var i=r(310617);if("cloudFilePickerDialog"!=r.j)var o=r(206809);const n="cloudFilePickerDialog"!=r.j?864e5:null,a={Lax:"Lax",None:"None"};class s{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){const i=r[e],[o,...n]=decodeURIComponent(i).trim().split("="),a=n.join("=");if(o===t)return a}return""}getUserData(){throw(0,i.SB)(o.methodNotImplemented)}setItem(e,t,r,i=!0,o=a.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){const e=function(e){const t=new Date,r=new Date(t.getTime()+e*n);return r.toUTCString()}(r);s+=`expires=${e};`}(i||o===a.None)&&(s+="Secure;"),document.cookie=s}async setUserData(){return Promise.reject((0,i.SB)(o.methodNotImplemented))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach((e=>{const r=decodeURIComponent(e).trim().split("=");t.push(r[0])})),t}containsKey(e){return this.getKeys().includes(e)}}},732316:(e,t,r)=>{r.d(t,{R:()=>l});var i=r(634651),o=r(480968),n=r(279676),a=r(585020),s=r(556012);class c{static async initializeNestedAppAuthBridge(){if(void 0===window)throw new Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",(e=>{const t="string"==typeof e?e:e.data,r=JSON.parse(t),i=c.bridgeRequests.find((e=>e.requestId===r.requestId));void 0!==i&&(c.bridgeRequests.splice(c.bridgeRequests.indexOf(i),1),r.success?i.resolve(r):i.reject(r.error))}));const e=await new Promise(((e,t)=>{const r=c.buildRequest("GetInitContext"),i={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(i),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}));return c.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){const r=await this.sendRequest(e,{tokenParams:t});return{token:c.validateBridgeResultOrThrow(r.token),account:c.validateBridgeResultOrThrow(r.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:(0,n.Oy)(),sendTime:Date.now(),clientLibrary:a.Q1.MSAL_SKU,clientLibraryVersion:s.r,...t}}sendRequest(e,t){const r=c.buildRequest(e,t);return new Promise(((e,t)=>{const i={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(i),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}))}static validateBridgeResultOrThrow(e){if(void 0===e){throw{status:o.H.NestedAppAuthUnavailable}}return e}constructor(e,t,r,i){this.sdkName=e,this.sdkVersion=t,this.accountContext=r,this.capabilities=i}static async create(){const e=await c.initializeNestedAppAuthBridge();return new c(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}c.bridgeRequests=[];class l extends i.A{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return l.MODULE_NAME}getId(){return l.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();const e=await c.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(e){this.logger.infoPii(`Could not initialize Nested App Auth bridge (${e})`)}return this.logger.info(`Nested App Auth Bridge available: ${this.available}`),this.available}}l.MODULE_NAME="",l.ID="NestedAppOperatingContext"},735198:(e,t,r)=>{if(r.d(t,{O4:()=>p,gI:()=>u,xB:()=>g}),"cloudFilePickerDialog"!=r.j)var i=r(466538);if("cloudFilePickerDialog"!=r.j)var o=r(739161);if("cloudFilePickerDialog"!=r.j)var n=r(593744);if("cloudFilePickerDialog"!=r.j)var a=r(556012);if("cloudFilePickerDialog"!=r.j)var s=r(866520);if("cloudFilePickerDialog"!=r.j)var c=r(912604);if("cloudFilePickerDialog"!=r.j)var l=r(837133);if("cloudFilePickerDialog"!=r.j)var h=r(279676);if("cloudFilePickerDialog"!=r.j)var d=r(585020);async function u(e,t,r){const n=new i.V(e||{},a.U,a.r);n.trace("isPlatformBrokerAvailable called");const s=t||new o.a;return"undefined"==typeof window?(n.trace("Non-browser environment detected, returning false"),!1):!!await g(n,s,r||(0,h.Oy)())}async function g(e,t,r,i){e.trace("getPlatformAuthProvider called",r);const o=function(){let e;try{return e=window[d.Al.SessionStorage],"true"===e?.getItem(d.MA)}catch(e){return!1}}();let n;e.trace("Has client allowed platform auth via DOM API: "+o);try{o&&(n=await l.K.createProvider(e,t,r)),n||(e.trace("Platform auth via DOM API not available, checking for extension"),n=await c.f.createProvider(e,i||s.fy,t))}catch(t){e.trace("Platform auth not available",t)}return n}function p(e,t,r,i){if(t.trace("isPlatformAuthAllowed called"),!e.system.allowPlatformBroker)return t.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!r)return t.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(i)switch(i){case n.IO.BEARER:case n.IO.POP:return t.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}},745960:(e,t,r)=>{if(r.d(t,{a:()=>l}),"cloudFilePickerDialog"!=r.j)var i=r(33544);if("cloudFilePickerDialog"!=r.j)var o=r(466538);if("cloudFilePickerDialog"!=r.j)var n=r(975030);if("cloudFilePickerDialog"!=r.j)var a=r(310617);if("cloudFilePickerDialog"!=r.j)var s=r(206809);if("cloudFilePickerDialog"!=r.j)var c=r(556012);class l{constructor(e,t){const r=t&&t.loggerOptions||{};this.logger=new o.V(r,c.U,c.r),this.cryptoOps=new i.M(this.logger),this.popTokenGenerator=new n.Q(this.cryptoOps),this.shrParameters=e}async generatePublicKeyThumbprint(){const{kid:e}=await this.popTokenGenerator.generateKid(this.shrParameters);return e}async signRequest(e,t,r){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,r)}async removeKeys(e){return this.cryptoOps.removeTokenBindingKey(e).then((()=>!0)).catch((e=>{if(e instanceof a.eB&&e.errorCode===s.bindingKeyNotRemoved)return!1;throw e}))}}},759461:(e,t,r)=>{if(r.d(t,{i:()=>s}),"cloudFilePickerDialog"!=r.j)var i=r(156942);if("cloudFilePickerDialog"!=r.j)var o=r(207712);if("cloudFilePickerDialog"!=r.j)var n=r(585020);if("cloudFilePickerDialog"!=r.j)var a=r(570954);class s{async sendGetRequestAsync(e,t){let r,s={},h=0;const d=c(t);try{r=await fetch(e,{method:n.CC.GET,headers:d})}catch(e){throw(0,i.t)((0,o.bD)(window.navigator.onLine?a.getRequestFailed:a.noNetworkConnectivity),void 0,void 0,e)}s=l(r.headers);try{return h=r.status,{headers:s,body:await r.json(),status:h}}catch(e){throw(0,i.t)((0,o.bD)(a.failedToParseResponse),h,s,e)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",s=c(t);let h,d=0,u={};try{h=await fetch(e,{method:n.CC.POST,headers:s,body:r})}catch(e){throw(0,i.t)((0,o.bD)(window.navigator.onLine?a.postRequestFailed:a.noNetworkConnectivity),void 0,void 0,e)}u=l(h.headers);try{return d=h.status,{headers:u,body:await h.json(),status:d}}catch(e){throw(0,i.t)((0,o.bD)(a.failedToParseResponse),d,u,e)}}}function c(e){try{const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.entries(r).forEach((([e,r])=>{t.append(e,r)})),t}catch(e){throw(0,i.t)((0,o.bD)(a.failedToBuildHeaders),void 0,void 0,e)}}function l(e){try{const t={};return e.forEach(((e,r)=>{t[r]=e})),t}catch(e){throw(0,o.bD)(a.failedToParseHeaders)}}},765846:(e,t,r)=>{if(r.d(t,{x:()=>f}),"cloudFilePickerDialog"!=r.j)var i=r(525630);if("cloudFilePickerDialog"!=r.j)var o=r(642059);if("cloudFilePickerDialog"!=r.j)var n=r(667426);if("cloudFilePickerDialog"!=r.j)var a=r(285868);if("cloudFilePickerDialog"!=r.j)var s=r(358794);if("cloudFilePickerDialog"!=r.j)var c=r(162989);if("cloudFilePickerDialog"!=r.j)var l=r(389642);if("cloudFilePickerDialog"!=r.j)var h=r(662443);if("cloudFilePickerDialog"!=r.j)var d=r(285683);if("cloudFilePickerDialog"!=r.j)var u=r(556012);if("cloudFilePickerDialog"!=r.j)var g=r(585020);if("cloudFilePickerDialog"!=r.j)var p=r(887440);if("cloudFilePickerDialog"!=r.j)var m=r(279676);class f{constructor(e,t,r,i,o,n,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=n,this.platformAuthProvider=s,this.correlationId=c||(0,m.Oy)(),this.logger=i.clone(g.Q1.MSAL_SKU,u.r,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e,t){if(t){i.d.accountInfoIsEqual(t,this.browserStorage.getActiveAccount(e),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null,e));try{this.browserStorage.removeAccount(i.d.generateAccountCacheKey(t),e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return o.H.getAbsoluteUrl(t,(0,p.getCurrentUri)())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new n.e(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},n=e.requestAuthority||this.config.auth.authority,u=r?.length?"true"===r:this.config.auth.instanceAware,g=t&&u?this.config.auth.authority.replace(o.H.getDomainFromUrl(n),t.environment):n,p=s.s4.generateAuthority(g,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),m=await(0,c.T)(l.Y,a.MX.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(p,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!m.isAlias(t.environment))throw(0,h.aD)(d.authorityMismatch);return m}}},785292:(e,t,r)=>{if(r.d(t,{D:()=>C}),"cloudFilePickerDialog"!=r.j)var i=r(162989);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(593744);if("cloudFilePickerDialog"!=r.j)var a=r(279676);if("cloudFilePickerDialog"!=r.j)var s=r(666637);if("cloudFilePickerDialog"!=r.j)var c=r(931553);if("cloudFilePickerDialog"!=r.j)var l=r(207712);if("cloudFilePickerDialog"!=r.j)var h=r(593130);if("cloudFilePickerDialog"!=r.j)var d=r(699465);if("cloudFilePickerDialog"!=r.j)var u=r(388e3);if("cloudFilePickerDialog"!=r.j)var g=r(498001);if("cloudFilePickerDialog"!=r.j)var p=r(585020);if("cloudFilePickerDialog"!=r.j)var m=r(531292);if("cloudFilePickerDialog"!=r.j)var f=r(570954);const v="msal.cache.encryption";class C{constructor(e,t,r){if(!window.localStorage)throw(0,h.jz)(m.storageNotSupported);this.memoryStorage=new u.X,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new d.W6,r=t.getItem(v);let n={key:"",id:""};if(r)try{n=JSON.parse(r)}catch(e){}if(n.key&&n.id){const t=(0,i.l)(s.C,o.MX.Base64Decode,this.logger,this.performanceClient,e)(n.key);this.encryptionCookie={id:n.id,key:await(0,i.T)(a.lg,o.MX.GenerateHKDF,this.logger,this.performanceClient,e)(t)},await(0,i.T)(this.importExistingCache.bind(this),o.MX.ImportExistingCache,this.logger,this.performanceClient,e)(e)}else{this.clear();const r=(0,a.Oy)(),n=await(0,i.T)(a.og,o.MX.GenerateBaseKey,this.logger,this.performanceClient,e)(),s=(0,i.l)(c.dB,o.MX.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(n));this.encryptionCookie={id:r,key:await(0,i.T)(a.lg,o.MX.GenerateHKDF,this.logger,this.performanceClient,e)(n)};const l={id:r,key:s};t.setItem(v,JSON.stringify(l),0,!0,d.WF.None)}this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw(0,l.bD)(f.uninitializedPublicClientApplication);return this.memoryStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,n){if(!this.initialized||!this.encryptionCookie)throw(0,l.bD)(f.uninitializedPublicClientApplication);const{data:s,nonce:c}=await(0,i.T)(a.w,o.MX.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),h={id:this.encryptionCookie.id,nonce:c,data:s,lastUpdatedAt:n};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(h)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear();(0,g.S)(this).forEach((e=>this.removeItem(e)));const e=(0,g.e)(this.clientId,this);e.idToken.forEach((e=>this.removeItem(e))),e.accessToken.forEach((e=>this.removeItem(e))),e.refreshToken.forEach((e=>this.removeItem(e))),this.getKeys().forEach((e=>{(e.startsWith(n.YM.CACHE_PREFIX)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)}))}async importExistingCache(e){if(!this.encryptionCookie)return;let t=(0,g.S)(this);t=await this.importArray(t,e),this.setItem(p.dh.ACCOUNT_KEYS,JSON.stringify(t));const r=(0,g.e)(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),this.setItem(`${p.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let n;try{n=JSON.parse(r)}catch(e){return null}return n.id&&n.nonce&&n.data?n.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(0,i.T)(a.Yc,o.MX.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,n.nonce,this.getContext(e),n.data):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),null)}async importArray(e,t){const r=[],i=[];return e.forEach((e=>{const o=this.getItemFromEncryptedCache(e,t).then((t=>{t?(this.memoryStorage.setItem(e,t),r.push(e)):this.removeItem(e)}));i.push(o)})),await Promise.all(i),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(o.MX.LocalStorageUpdated);t.add({isBackground:!0});const{key:r,value:i,context:n}=e.data;return r?n&&n!==this.clientId?(this.logger.trace(`Ignoring broadcast event from clientId: ${n}`),void t.end({success:!1,errorCode:"contextMismatch"})):(i?(this.memoryStorage.setItem(r,i),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),void t.end({success:!0})):(this.logger.error("Broadcast event missing key"),void t.end({success:!1,errorCode:"noKey"}))}}},803169:(e,t,r)=>{function i(e){return void 0!==e.status}r.d(t,{m:()=>i})},837133:(e,t,r)=>{if(r.d(t,{K:()=>s}),"cloudFilePickerDialog"!=r.j)var i=r(312982);if("cloudFilePickerDialog"!=r.j)var o=r(505640);if("cloudFilePickerDialog"!=r.j)var n=r(585020);if("cloudFilePickerDialog"!=r.j)var a=r(447851);class s{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=n.V8.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,r){if(e.trace("PlatformAuthDOMHandler: createProvider called"),window.navigator?.platformAuthentication){const i=await window.navigator.platformAuthentication.getSupportedContracts(n.V8.MICROSOFT_ENTRA_BROKERID);if(i?.includes(n.V8.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new s(e,t,r)}}getExtensionId(){return n.V8.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return n.V8.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r)}catch(e){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),e}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:r,authority:i,scope:o,redirectUri:n,correlationId:a,state:s,storeInCache:c,embeddedClientId:l,extraParameters:h,...d}=e,u=this.getDOMExtraParams(d);return{accountId:t,brokerId:this.getExtensionId(),authority:i,clientId:r,correlationId:a||this.correlationId,extraParameters:{...h,...u},isSecurityTokenService:!1,redirectUri:n,scope:o,state:s,storeInCache:c,embeddedClientId:l}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(!1===t.isSuccess&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),(0,a.uz)(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw(0,i.pz)(o.unexpectedError,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){this.logger.trace(this.platformAuthType+" - convertToNativeResponse called");return{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce(((e,[t,r])=>(e[t]=String(r),e)),{})}}}},841075:(e,t,r)=>{r.d(t,{G:()=>i,o:()=>o});const i="ContentError",o="user_switch"},866520:(e,t,r)=>{if(r.d(t,{YH:()=>v,fy:()=>w,tD:()=>y}),"cloudFilePickerDialog"!=r.j)var i=r(593744);if("cloudFilePickerDialog"!=r.j)var o=r(808484);if("cloudFilePickerDialog"!=r.j)var n=r(637282);if("cloudFilePickerDialog"!=r.j)var a=r(466538);if("cloudFilePickerDialog"!=r.j)var s=r(494765);if("cloudFilePickerDialog"!=r.j)var c=r(518019);if("cloudFilePickerDialog"!=r.j)var l=r(739161);if("cloudFilePickerDialog"!=r.j)var h=r(662443);if("cloudFilePickerDialog"!=r.j)var d=r(285683);if("cloudFilePickerDialog"!=r.j)var u=r(585020);if("cloudFilePickerDialog"!=r.j)var g=r(336625);if("cloudFilePickerDialog"!=r.j)var p=r(759461);if("cloudFilePickerDialog"!=r.j)var m=r(887440);const f=6e4,v=1e4,C=3e4,w=2e3;function y({auth:e,cache:t,system:r,telemetry:y},k){const I={clientId:i.YM.EMPTY_STRING,authority:`${i.YM.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:i.YM.EMPTY_STRING,authorityMetadata:i.YM.EMPTY_STRING,redirectUri:"undefined"!=typeof window?(0,m.getCurrentUri)():"",postLogoutRedirectUri:i.YM.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:o.e.AAD,OIDCOptions:{serverResponseType:i.zL.FRAGMENT,defaultScopes:[i.YM.OPENID_SCOPE,i.YM.PROFILE_SCOPE,i.YM.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:n._.None,tenant:i.YM.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},T={cacheLocation:u.Al.SessionStorage,temporaryCacheLocation:u.Al.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!t||t.cacheLocation!==u.Al.LocalStorage),claimsBasedCachingEnabled:!1},A={loggerCallback:()=>{},logLevel:a.$.Info,piiLoggingEnabled:!1},b={...{...s.J1,loggerOptions:A,networkClient:k?new p.i:c.A,navigationClient:new g.c,loadFrameTimeout:0,windowHashTimeout:r?.loadFrameTimeout||f,iframeHashTimeout:r?.loadFrameTimeout||v,navigateFrameWait:0,redirectNavigationTimeout:C,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||w,pollIntervalMilliseconds:u.Q1.DEFAULT_POLL_INTERVAL_MS},...r,loggerOptions:r?.loggerOptions||A},S={application:{appName:i.YM.EMPTY_STRING,appVersion:i.YM.EMPTY_STRING},client:new l.a};if(e?.protocolMode!==o.e.OIDC&&e?.OIDCOptions){new a.V(b.loggerOptions).warning(JSON.stringify((0,h.aD)(d.cannotSetOIDCOptions)))}if(e?.protocolMode&&e.protocolMode===o.e.OIDC&&b?.allowPlatformBroker)throw(0,h.aD)(d.cannotAllowPlatformBroker);return{auth:{...I,...e,OIDCOptions:{...I.OIDCOptions,...e?.OIDCOptions}},cache:{...T,...t},system:b,telemetry:{...S,...y}}}},887440:(e,t,r)=>{if(r.r(t),r.d(t,{blockAPICallsBeforeInitialize:()=>k,blockAcquireTokenInPopups:()=>w,blockNonBrowserEnvironment:()=>y,blockRedirectInIframe:()=>C,blockReloadInHiddenIframes:()=>v,clearHash:()=>d,createGuid:()=>b,getCurrentUri:()=>m,getHomepage:()=>f,invoke:()=>o.l,invokeAsync:()=>o.T,isInIframe:()=>g,isInPopup:()=>p,preconnect:()=>A,preflightCheck:()=>I,redirectPreflightCheck:()=>T,replaceHash:()=>u}),"cloudFilePickerDialog"!=r.j)var i=r(642059);if("cloudFilePickerDialog"!=r.j)var o=r(162989);if("cloudFilePickerDialog"!=r.j)var n=r(207712);if("cloudFilePickerDialog"!=r.j)var a=r(585020);if("cloudFilePickerDialog"!=r.j)var s=r(279676);if("cloudFilePickerDialog"!=r.j)var c=r(593130);if("cloudFilePickerDialog"!=r.j)var l=r(570954);if("cloudFilePickerDialog"!=r.j)var h=r(531292);function d(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function u(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function g(){return window.parent!==window}function p(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${a.Q1.POPUP_NAME_PREFIX}.`)}function m(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function f(){const e=new i.H(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function v(){if(i.H.hashContainsKnownProperties(window.location.hash)&&g())throw(0,n.bD)(l.blockIframeReload)}function C(e){if(g()&&!e)throw(0,n.bD)(l.redirectInIframe)}function w(){if(p())throw(0,n.bD)(l.blockNestedPopups)}function y(){if("undefined"==typeof window)throw(0,n.bD)(l.nonBrowserEnvironment)}function k(e){if(!e)throw(0,n.bD)(l.uninitializedPublicClientApplication)}function I(e){y(),v(),w(),k(e)}function T(e,t){if(I(e),C(t.system.allowRedirectInIframe),t.cache.cacheLocation===a.Al.MemoryStorage&&!t.cache.storeAuthStateInCookie)throw(0,c.jz)(h.inMemRedirectUnavailable)}function A(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout((()=>{try{document.head.removeChild(t)}catch{}}),1e4)}function b(){return(0,s.Oy)()}},900360:(e,t,r)=>{if(r.d(t,{A:()=>a}),"cloudFilePickerDialog"!=r.j)var i=r(403316);if("cloudFilePickerDialog"!=r.j)var o=r(310617);if("cloudFilePickerDialog"!=r.j)var n=r(206809);function a(e,t){if(!t)return null;try{return i.W.parseRequestState(e,t).libraryState.meta}catch(e){throw(0,o.SB)(n.invalidState)}}},912604:(e,t,r)=>{if(r.d(t,{f:()=>d}),"cloudFilePickerDialog"!=r.j)var i=r(585020);if("cloudFilePickerDialog"!=r.j)var o=r(285868);if("cloudFilePickerDialog"!=r.j)var n=r(312982);if("cloudFilePickerDialog"!=r.j)var a=r(505640);if("cloudFilePickerDialog"!=r.j)var s=r(447851);if("cloudFilePickerDialog"!=r.j)var c=r(207712);if("cloudFilePickerDialog"!=r.j)var l=r(279676);if("cloudFilePickerDialog"!=r.j)var h=r(570954);class d{constructor(e,t,r,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(o.MX.NativeMessageHandlerHandshake),this.platformAuthType=i.V8.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:i.Ct.GetToken,request:e},r={channel:i.V8.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,l.Oy)(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(r)}`),this.messageChannel.port1.postMessage(r);const o=await new Promise(((e,t)=>{this.resolvers.set(r.responseId,{resolve:e,reject:t})}));return this.validatePlatformBrokerResponse(o)}static async createProvider(e,t,r){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const o=new d(e,t,r,i.V8.PREFERRED_EXTENSION_ID);return await o.sendHandshakeRequest(),o}catch(i){const o=new d(e,t,r);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:i.V8.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,l.Oy)(),body:{method:i.Ct.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise(((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout((()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r((0,c.bD)(h.nativeHandshakeTimeout)),this.handshakeResolvers.delete(e.responseId)}),this.handshakeTimeoutMs)}))}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===i.V8.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===i.Ct.HandshakeRequest){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject((0,c.bD)(h.nativeExtensionNotInstalled))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if(e===i.Ct.Response){if(!r)return;const e=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)r.reject((0,s.uz)(e.code,e.description,e.ext));else{if(!e.result)throw(0,n.pz)(a.unexpectedError,"Event does not contain result.");e.result.code&&e.result.description?r.reject((0,s.uz)(e.result.code,e.result.description,e.result.ext)):r.resolve(e.result)}this.resolvers.delete(t.responseId)}else if(e===i.Ct.HandshakeResponse){if(!o)return void this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(t):o&&o.reject(t)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,n.pz)(a.unexpectedError,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===i.V8.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}}},918062:(e,t,r)=>{if(r.d(t,{G:()=>f}),"cloudFilePickerDialog"!=r.j)var i=r(740278);if("cloudFilePickerDialog"!=r.j)var o=r(593744);if("cloudFilePickerDialog"!=r.j)var n=r(364225);if("cloudFilePickerDialog"!=r.j)var a=r(310617);if("cloudFilePickerDialog"!=r.j)var s=r(206809);if("cloudFilePickerDialog"!=r.j)var c=r(81877);if("cloudFilePickerDialog"!=r.j)var l=r(744212);if("cloudFilePickerDialog"!=r.j)var h=r(281072);if("cloudFilePickerDialog"!=r.j)var d=r(949575);if("cloudFilePickerDialog"!=r.j)var u=r(535367);if("cloudFilePickerDialog"!=r.j)var g=r(312982);if("cloudFilePickerDialog"!=r.j)var p=r(803169);if("cloudFilePickerDialog"!=r.j)var m=r(480968);class f{constructor(e,t,r,i){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=i}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const r=e.correlationId||this.crypto.createNewGuid(),a=i.Ni(e.claims,this.clientCapabilities),s=e.scopes||o.aZ;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:s.join(" "),correlationId:r,claims:n.$.isEmptyObj(a)?void 0:a,state:e.state,authenticationScheme:e.authenticationScheme||o.IO.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw(0,a.SB)(s.nullOrEmptyToken);const i=c.dM(r+(t.token.expires_in||0)),n=l.My(t.token.id_token,this.crypto.base64Decode),h=this.fromNaaAccountInfo(t.account,t.token.id_token,n),d=t.token.scope||e.scope;return{authority:t.token.authority||h.environment,uniqueId:h.localAccountId,tenantId:h.tenantId,scopes:d.split(" "),account:h,idToken:t.token.id_token,idTokenClaims:n,accessToken:t.token.access_token,fromCache:!1,expiresOn:i,tokenType:e.authenticationScheme||o.IO.BEARER,correlationId:e.correlationId,extExpiresOn:i,state:e.state}}fromNaaAccountInfo(e,t,r){const i=r||e.idTokenClaims,o=e.localAccountId||i?.oid||i?.sub||"",n=e.tenantId||i?.tid||"",a=e.homeAccountId||`${o}.${n}`,s=e.username||i?.preferred_username||"",c=e.name||i?.name,l=new Map,d=(0,h.Km)(a,o,n,i);l.set(n,d);return{homeAccountId:a,environment:e.environment,tenantId:n,username:s,localAccountId:o,name:c,idToken:t,idTokenClaims:i,tenantProfiles:l}}fromBridgeError(e){if(!(0,p.m)(e))return new g.lR("unknown_error","An unknown error occurred");switch(e.status){case m.H.UserCancel:return new a.eB(s.userCanceled);case m.H.NoNetwork:return new a.eB(s.noNetworkConnectivity);case m.H.AccountUnavailable:return new a.eB(s.noAccountFound);case m.H.Disabled:return new a.eB(s.nestedAppAuthBridgeDisabled);case m.H.NestedAppAuthUnavailable:return new a.eB(e.code||s.nestedAppAuthBridgeDisabled,e.description);case m.H.TransientError:case m.H.PersistentError:return new d.g(e.code,e.description);case m.H.UserInteractionRequired:return new u.CB(e.code,e.description);default:return new g.lR(e.code,e.description)}}toAuthenticationResultFromCache(e,t,r,i,n){if(!t||!r)throw(0,a.SB)(s.nullOrEmptyToken);const h=l.My(t.secret,this.crypto.base64Decode),d=r.target||i.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:d.split(" "),account:e,idToken:t.secret,idTokenClaims:h||{},accessToken:r.secret,fromCache:!0,expiresOn:c.dM(r.expiresOn),extExpiresOn:c.dM(r.extendedExpiresOn),tokenType:i.authenticationScheme||o.IO.BEARER,correlationId:n,state:i.state}}}},931553:(e,t,r)=>{function i(e){return encodeURIComponent(n(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function o(e){return a(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return a((new TextEncoder).encode(e))}function a(e){const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return btoa(t)}r.d(t,{KA:()=>n,dB:()=>o,u4:()=>i})},941504:(e,t,r)=>{if(r.d(t,{i:()=>L}),"cloudFilePickerDialog"!=r.j)var i=r(33544);if("cloudFilePickerDialog"!=r.j)var o=r(275967);if("cloudFilePickerDialog"!=r.j)var n=r(358794);if("cloudFilePickerDialog"!=r.j)var a=r(285868);if("cloudFilePickerDialog"!=r.j)var s=r(162989);if("cloudFilePickerDialog"!=r.j)var c=r(535367);if("cloudFilePickerDialog"!=r.j)var l=r(310617);if("cloudFilePickerDialog"!=r.j)var h=r(206809);if("cloudFilePickerDialog"!=r.j)var d=r(525630);if("cloudFilePickerDialog"!=r.j)var u=r(593744);if("cloudFilePickerDialog"!=r.j)var g=r(312982);if("cloudFilePickerDialog"!=r.j)var p=r(769540);if("cloudFilePickerDialog"!=r.j)var m=r(933679);if("cloudFilePickerDialog"!=r.j)var f=r(453275);if("cloudFilePickerDialog"!=r.j)var v=r(318030);if("cloudFilePickerDialog"!=r.j)var C=r(585020);if("cloudFilePickerDialog"!=r.j)var w=r(887440);if("cloudFilePickerDialog"!=r.j)var y=r(494030);if("cloudFilePickerDialog"!=r.j)var k=r(642026);if("cloudFilePickerDialog"!=r.j)var I=r(363073);if("cloudFilePickerDialog"!=r.j)var T=r(381607);if("cloudFilePickerDialog"!=r.j)var A=r(987953);if("cloudFilePickerDialog"!=r.j)var b=r(638551);if("cloudFilePickerDialog"!=r.j)var S=r(546987);if("cloudFilePickerDialog"!=r.j)var P=r(182150);if("cloudFilePickerDialog"!=r.j)var E=r(447851);if("cloudFilePickerDialog"!=r.j)var R=r(347780);if("cloudFilePickerDialog"!=r.j)var M=r(551347);if("cloudFilePickerDialog"!=r.j)var N=r(207712);if("cloudFilePickerDialog"!=r.j)var _=r(279676);if("cloudFilePickerDialog"!=r.j)var q=r(220901);if("cloudFilePickerDialog"!=r.j)var O=r(474569);if("cloudFilePickerDialog"!=r.j)var B=r(735198);if("cloudFilePickerDialog"!=r.j)var D=r(236819);if("cloudFilePickerDialog"!=r.j)var U=r(570954);function F(e){const t=e?.idTokenClaims;return t?.tfp||t?.acr?"B2C":t?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===t?.tid?"MSA":"AAD":void 0}function H(e,t){try{(0,w.preflightCheck)(e)}catch(e){throw t.end({success:!1},e),e}}class L{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new i.M(this.logger,this.performanceClient):o.j,this.eventHandler=new k.J(this.logger),this.browserStorage=this.isBrowserEnvironment?new f.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,(0,n.aw)(this.config.auth)):(0,f.E)(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:C.Al.MemoryStorage,temporaryCacheLocation:C.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new f.c(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new S.G(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new L(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment)return this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,void this.eventHandler.emitEvent(y.B.INITIALIZE_END);const r=e?.correlationId||this.getRequestCorrelationId(),i=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(a.MX.InitializeClientApplication,r);if(this.eventHandler.emitEvent(y.B.INITIALIZE_START),!t)try{this.logMultipleInstances(o)}catch{}if(await(0,s.T)(this.browserStorage.initialize.bind(this.browserStorage),a.MX.InitializeCache,this.logger,this.performanceClient,r)(r),i)try{this.platformAuthProvider=await(0,B.xB)(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),(0,s.l)(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),a.MX.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(r)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(y.B.INITIALIZE_END),o.end({allowPlatformBroker:i,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),(0,w.blockAPICallsBeforeInitialize)(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const t=this.browserStorage.getInteractionInProgress()?.type;if(t===C.O2.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),i=this.browserStorage.getCachedNativeRequest(),o=i&&this.platformAuthProvider&&!e;let n,c;this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_START,C.X8.Redirect);try{if(o&&this.platformAuthProvider){n=this.performanceClient.startMeasurement(a.MX.AcquireTokenRedirect,i?.correlationId||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform");const e=new P.Z(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,C.sA.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,i.accountId,this.nativeInternalStorage,i.correlationId);c=(0,s.T)(e.handleRedirectPromise.bind(e),a.MX.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,n.event.correlationId)(this.performanceClient,n.event.correlationId)}else{const[t,r]=this.browserStorage.getCachedRequest(),i=t.correlationId;n=this.performanceClient.startMeasurement(a.MX.AcquireTokenRedirect,i),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const o=this.createRedirectClient(i);c=(0,s.T)(o.handleRedirectPromise.bind(o),a.MX.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,n.event.correlationId)(e,t,r,n)}}catch(e){throw this.browserStorage.resetRequestCache(),e}return c.then((e=>{if(e){this.browserStorage.resetRequestCache();r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(y.B.LOGIN_SUCCESS,C.X8.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,C.X8.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),n.end({success:!0,accountType:F(e.account)})}else n.event.errorCode?n.end({success:!1}):n.discard();return this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_END,C.X8.Redirect),e})).catch((e=>{this.browserStorage.resetRequestCache();const t=e;throw r.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,C.X8.Redirect,null,t):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,C.X8.Redirect,null,t),this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_END,C.X8.Redirect),n.end({success:!1},t),e}))}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(a.MX.AcquireTokenPreRedirect,t);r.add({accountType:F(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=e=>{const t="function"==typeof i?i(e):void 0;return!1!==t?r.end({success:!0}):r.discard(),t};else{const e=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const i="function"==typeof e?e(t):void 0;return!1!==i?r.end({success:!0}):r.discard(),i}}const o=this.getAllAccounts().length>0;try{let i;if((0,w.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,C.O2.SIGNIN),o?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,C.X8.Redirect,e):this.eventHandler.emitEvent(y.B.LOGIN_START,C.X8.Redirect,e),this.platformAuthProvider&&this.canUsePlatformBroker(e)){i=new P.Z(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,C.sA.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch((r=>{if(r instanceof E.mr&&(0,E.Em)(r)){this.platformAuthProvider=void 0;return this.createRedirectClient(t).acquireToken(e)}if(r instanceof c.CB){this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createRedirectClient(t).acquireToken(e)}throw r}))}else{i=this.createRedirectClient(t).acquireToken(e)}return await i}catch(e){throw this.browserStorage.resetRequestCache(),r.end({success:!1},e),o?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,C.X8.Redirect,null,e):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,C.X8.Redirect,null,e),e}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(a.MX.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:F(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),H(this.initialized,r),this.browserStorage.setInteractionInProgress(!0,C.O2.SIGNIN)}catch(e){return Promise.reject(e)}const i=this.getAllAccounts();let o;i.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,C.X8.Popup,e):this.eventHandler.emitEvent(y.B.LOGIN_START,C.X8.Popup,e);const n=this.getPreGeneratedPkceCodes(t);if(this.canUsePlatformBroker(e))o=this.acquireTokenNative({...e,correlationId:t},C.sA.acquireTokenPopup).then((e=>(r.end({success:!0,isNativeBroker:!0,accountType:F(e.account)}),e))).catch((r=>{if(r instanceof E.mr&&(0,E.Em)(r)){this.platformAuthProvider=void 0;return this.createPopupClient(t).acquireToken(e,n)}if(r instanceof c.CB){this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createPopupClient(t).acquireToken(e,n)}throw r}));else{o=this.createPopupClient(t).acquireToken(e,n)}return o.then((e=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(y.B.LOGIN_SUCCESS,C.X8.Popup,e):this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,C.X8.Popup,e),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:F(e.account)}),e))).catch((e=>(i.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,C.X8.Popup,null,e):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,C.X8.Popup,null,e),r.end({success:!1},e),Promise.reject(e)))).finally((async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)}))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};let i;if(this.ssoSilentMeasurement=this.performanceClient.startMeasurement(a.MX.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:F(e.account)}),H(this.initialized,this.ssoSilentMeasurement),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(y.B.SSO_SILENT_START,C.X8.Silent,r),this.canUsePlatformBroker(r))i=this.acquireTokenNative(r,C.sA.ssoSilent).catch((e=>{if(e instanceof E.mr&&(0,E.Em)(e)){this.platformAuthProvider=void 0;return this.createSilentIframeClient(r.correlationId).acquireToken(r)}throw e}));else{i=this.createSilentIframeClient(r.correlationId).acquireToken(r)}return i.then((e=>(this.eventHandler.emitEvent(y.B.SSO_SILENT_SUCCESS,C.X8.Silent,e),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:F(e.account)}),e))).catch((e=>{throw this.eventHandler.emitEvent(y.B.SSO_SILENT_FAILURE,C.X8.Silent,null,e),this.ssoSilentMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(a.MX.AcquireTokenByCode,t);H(this.initialized,r),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_START,C.X8.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw(0,N.bD)(U.spaCodeAndNativeAccountIdPresent);if(e.code){const i=e.code;let o=this.hybridAuthCodeResponses.get(i);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then((e=>(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_SUCCESS,C.X8.Silent,e),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:F(e.account)}),e))).catch((e=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,C.X8.Silent,null,e),r.end({success:!1},e),e})),this.hybridAuthCodeResponses.set(i,o)),await o}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},C.sA.acquireTokenByCode,e.nativeAccountId).catch((e=>{throw e instanceof E.mr&&(0,E.Em)(e)&&(this.platformAuthProvider=void 0),e}));return r.end({accountType:F(i.account),success:!0}),i}throw(0,N.bD)(U.unableToAcquireTokenFromNativePlatform)}throw(0,N.bD)(U.authCodeOrNativeAccountIdRequired)}catch(e){throw this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,C.X8.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(a.MX.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then((e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker}),e))).catch((e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenFromCache,e.correlationId),t){case C.nN.Default:case C.nN.AccessToken:case C.nN.AccessTokenAndRefreshToken:const t=this.createSilentCacheClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,l.SB)(h.tokenRefreshRequired)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenByRefreshToken,e.correlationId),t){case C.nN.Default:case C.nN.AccessTokenAndRefreshToken:case C.nN.RefreshToken:case C.nN.RefreshTokenAndNetwork:const t=this.createSilentRefreshClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,l.SB)(h.tokenRefreshRequired)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);(0,w.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,C.O2.SIGNOUT);return this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);(0,w.preflightCheck)(this.initialized),this.browserStorage.setInteractionInProgress(!0,C.O2.SIGNOUT);return this.createPopupClient(t).logout(e).finally((()=>{this.browserStorage.setInteractionInProgress(!1)}))}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return(0,v.Is)(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return(0,v.sU)(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return(0,v.hN)(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return(0,v.PX)(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return(0,v.P6)(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();(0,v.I$)(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return(0,v.yq)(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=d.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,i){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw(0,N.bD)(U.nativeConnectionNotEstablished);return new P.Z(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,i)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!(0,B.O4)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case u._M.NONE:case u._M.CONSENT:case u._M.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e))||(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1)}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new I.C(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new T.u(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new A.N(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,C.sA.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new R.d(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new b.O(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new M.a(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,C.sA.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return(0,w.blockNonBrowserEnvironment)(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.config.cache.cacheLocation===C.Al.LocalStorage?this.eventHandler.subscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}disableAccountStorageEvents(){this.config.cache.cacheLocation===C.Al.LocalStorage?this.eventHandler.unsubscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,_.Oy)():u.YM.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||C.uq})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||C.uq})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(a.MX.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),H(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw(0,N.bD)(U.noAccountError);return r.add({accountType:F(i)}),this.acquireTokenSilentDeduped(e,i,t).then((i=>(r.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length}),{...i,state:e.state,correlationId:t}))).catch((e=>{throw e instanceof g.lR&&e.setCorrelationId(t),r.end({success:!1},e),e}))}async acquireTokenSilentDeduped(e,t,r){const i=(0,p.B)(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),o=JSON.stringify(i),n=this.activeSilentTokenRequests.get(o);if(void 0===n){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);const i=(0,s.T)(this.acquireTokenSilentAsync.bind(this),a.MX.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(o,i),i.finally((()=>{this.activeSilentTokenRequests.delete(o)}))}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),n}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,C.X8.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await(0,s.T)(q.v,a.MX.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||C.nN.Default;return this.acquireTokenSilentNoIframe(i,o).catch((async e=>{const t=function(e,t){const r=!(e instanceof c.CB&&e.subError!==m.badToken),i=e.errorCode===C.Q1.INVALID_GRANT_ERROR||e.errorCode===h.tokenRefreshRequired,o=r&&i||e.errorCode===m.noTokensFound||e.errorCode===m.refreshTokenExpired,n=C.JE.includes(t);return o&&n}(e,o);if(t){if(this.activeIframeRequest){if(o!==C.nN.Skip){const[t,r]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${r}`,i.correlationId);const n=this.performanceClient.startMeasurement(a.MX.AwaitConcurrentIframe,i.correlationId);n.add({awaitIframeCorrelationId:r});const s=await t;if(n.end({success:s}),s)return this.logger.verbose(`Parallel iframe request with correlationId: ${r} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,o);throw this.logger.info(`Iframe request with correlationId: ${r} failed. Interaction is required.`),e}return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),a.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i)}{let e;return this.activeIframeRequest=[new Promise((t=>{e=t})),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),a.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then((t=>(e(!0),t))).catch((t=>{throw e(!1),t})).finally((()=>{this.activeIframeRequest=void 0}))}}throw e})).then((t=>(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,C.X8.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker},e.correlationId),t))).catch((e=>{throw this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,C.X8.Silent,null,e),e})).finally((()=>{document.removeEventListener("visibilitychange",r)}))}async acquireTokenSilentNoIframe(e,t){return(0,B.O4)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,C.sA.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch((async e=>{if(e instanceof E.mr&&(0,E.Em)(e))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,(0,l.SB)(h.tokenRefreshRequired);throw e}))):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===C.nN.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),(0,s.T)(this.acquireTokenFromCache.bind(this),a.MX.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch((r=>{if(t===C.nN.AccessToken)throw r;return this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_NETWORK_START,C.X8.Silent,e),(0,s.T)(this.acquireTokenByRefreshToken.bind(this),a.MX.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)})))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await(0,s.T)(O.p,a.MX.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose((t?"Found":"Did not find")+" pre-generated PKCE codes"),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[];window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),(0,D.n)(t,e,this.logger)}}},975189:(e,t,r)=>{if(r.d(t,{n:()=>c}),"cloudFilePickerDialog"!=r.j)var i=r(275967);if("cloudFilePickerDialog"!=r.j)var o=r(453275);if("cloudFilePickerDialog"!=r.j)var n=r(33544);if("cloudFilePickerDialog"!=r.j)var a=r(887440);if("cloudFilePickerDialog"!=r.j)var s=r(642026);class c{constructor(e){this.initialized=!1,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.logger=e.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new n.M(this.logger,this.performanceClient):i.j,this.eventHandler=new s.J(this.logger),this.browserStorage=this.isBrowserEnvironment?new o.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,void 0):(0,o.E)(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler)}getBrowserStorage(){return this.browserStorage}getAccount(e){return null}getAccountByHomeId(e){return null}getAccountByLocalId(e){return null}getAccountByUsername(e){return null}getAllAccounts(){return[]}initialize(){return this.initialized=!0,Promise.resolve()}acquireTokenPopup(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}acquireTokenRedirect(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),Promise.resolve()}acquireTokenSilent(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}acquireTokenByCode(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}acquireTokenNative(e,t,r){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}acquireTokenByRefreshToken(e,t){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}addEventCallback(e,t){return null}removeEventCallback(e){}addPerformanceCallback(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),""}removePerformanceCallback(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),!0}enableAccountStorageEvents(){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}disableAccountStorageEvents(){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}handleRedirectPromise(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),Promise.resolve(null)}loginPopup(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}loginRedirect(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}logout(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}logoutRedirect(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}logoutPopup(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}ssoSilent(e){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}getTokenCache(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}getLogger(){return this.logger}setLogger(e){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}setActiveAccount(e){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}getActiveAccount(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),null}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}getConfiguration(){return this.config}isBrowserEnv(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),!0}getBrowserCrypto(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}getPerformanceClient(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}getRedirectResponse(){return(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)(),{}}async clearCache(e){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}async hydrateCache(e,t){(0,a.blockAPICallsBeforeInitialize)(this.initialized),(0,a.blockNonBrowserEnvironment)()}}},987953:(e,t,r)=>{r.d(t,{N:()=>S});var i=r(285868),o=r(593744),n=r(162989),a=r(808484),s=r(312982),c=r(221678),l=r(207712),h=r(585020),d=r(866520),u=r(268485),g=r(570954);async function p(e,t,r,o,a){if(t.addQueueMeasurement(i.MX.SilentHandlerInitiateAuthRequest,o),!e)throw r.info("Navigate url is empty"),(0,l.bD)(g.emptyNavigateUri);return a?(0,n.T)(v,i.MX.SilentHandlerLoadFrame,r,t,o)(e,a,t,o):(0,n.l)(C,i.MX.SilentHandlerLoadFrameSync,r,t,o)(e)}async function m(e,t,r,i,o){const n=w();if(!n.contentDocument)throw"No document associated with iframe!";return(await(0,u.Bh)(n.contentDocument,e,t,r,i,o)).submit(),n}async function f(e,t,r,a,s,c,h){return a.addQueueMeasurement(i.MX.SilentHandlerMonitorIframeForHash,c),new Promise(((i,n)=>{t<d.YH&&s.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${d.YH}ms). This may result in timeouts.`);const a=window.setTimeout((()=>{window.clearInterval(c),n((0,l.bD)(g.monitorWindowTimeout))}),t),c=window.setInterval((()=>{let t="";const r=e.contentWindow;try{t=r?r.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let n="";r&&(n=h===o.zL.QUERY?r.location.search:r.location.hash),window.clearTimeout(a),window.clearInterval(c),i(n)}),r)})).finally((()=>{(0,n.l)(y,i.MX.RemoveHiddenIframe,s,a,c)(e)}))}function v(e,t,r,o){return r.addQueueMeasurement(i.MX.SilentHandlerLoadFrame,o),new Promise(((r,i)=>{const o=w();window.setTimeout((()=>{o?(o.src=e,r(o)):i("Unable to load iframe")}),t)}))}function C(e){const t=w();return t.src=e,t}function w(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function y(e){document.body===e.parentNode&&document.body.removeChild(e)}var k=r(887440),I=r(453826),T=r(474569),A=r(735198),b=r(279676);class S extends c.v{constructor(e,t,r,i,o,n,a,s,c,l,h){super(e,t,r,i,o,n,s,l,h),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(i.MX.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==o._M.NONE&&t.prompt!==o._M.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${o._M.NONE}`),t.prompt=o._M.NONE):t.prompt=o._M.NONE;const r=await(0,n.T)(this.initializeAuthorizationRequest.bind(this),i.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,h.X8.Silent);return r.platformBroker=(0,A.O4)(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),(0,k.preconnect)(r.authority),this.config.auth.protocolMode===a.e.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const r=this.initializeServerTelemetryManager(this.apiId);try{return t=await(0,n.T)(this.createAuthCodeClient.bind(this),i.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await(0,n.T)(this.silentTokenHelper.bind(this),i.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(o){if(o instanceof s.lR&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),!(t&&o instanceof s.lR&&o.errorCode===h.Q1.INVALID_GRANT_ERROR))throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),await(0,n.T)(this.silentTokenHelper.bind(this),i.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,r=await(0,n.T)(this.getDiscoveredAuthority.bind(this),i.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await(0,n.T)(b.DP,i.MX.GenerateEarKey,this.logger,this.performanceClient,t)(),a={...e,earJwk:o},s=await(0,n.T)(m,i.MX.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,a,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await(0,n.T)(f,i.MX.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(s,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),h=(0,n.l)(I.L,i.MX.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);return(0,n.T)(u.An,i.MX.HandleResponseEar,this.logger,this.performanceClient,t)(a,h,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject((0,l.bD)(g.silentLogoutUnsupported))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(i.MX.SilentIframeClientTokenHelper,r);const o=await(0,n.T)(T.p,i.MX.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),a={...t,codeChallenge:o.challenge},s=await(0,n.T)(u.kM,i.MX.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,a,this.logger,this.performanceClient),c=await(0,n.T)(p,i.MX.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(s,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,h=await(0,n.T)(f,i.MX.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,l),d=(0,n.l)(I.L,i.MX.DeserializeResponse,this.logger,this.performanceClient,r)(h,l,this.logger);return(0,n.T)(u.HT,i.MX.HandleResponseCode,this.logger,this.performanceClient,r)(t,d,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}}}]);
//# sourceMappingURL=vendors~auth-msal-browser.js.map